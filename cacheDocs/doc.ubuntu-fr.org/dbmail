<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr" dir="ltr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Script-Type" content="text/javascript"/>
    <meta http-equiv="Content-Style-Type" content="text/css"/>
    <meta http-equiv="Content-Language" content="fr"/>
    <title>dbmail - Documentation Ubuntu Francophone</title>
    <meta name="Description" content="Documentation francophone pour la distribution Ubuntu" lang="fr" />
    <meta name="language" content="fr-FR" />

    <!--[if IE 8]>
    <meta http-equiv="X-UA-Compatible" content="IE=8" />
    <![endif]-->
        <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2014-06-28T14:14:38+0200"/>
<meta name="keywords" content="serveur,serveurs messagerie,courriel,ubuntu server,brouillon"/>
<link rel="search" type="application/opensearchdescription+xml" href="lib/exe/opensearch.php" title="Documentation Ubuntu Francophone"/>
<link rel="start" href="index.html"/>
<link rel="contents" href="http://doc.ubuntu-fr.org/dbmail?do=index" title="Plan du site"/>
<link rel="alternate" type="application/rss+xml" title="Derniers changements" href="feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Namespace actuel" href="feed.php?mode=list&amp;ns="/>
<link rel="edit" title="Modifier cette page" href="http://doc.ubuntu-fr.org/dbmail?do=edit"/>
<link rel="alternate" type="text/html" title="HTML brut" href="http://doc.ubuntu-fr.org/_export/xhtml/dbmail"/>
<link rel="alternate" type="text/plain" title="Wiki balise" href="http://doc.ubuntu-fr.org/_export/raw/dbmail"/>
<link rel="canonical" href="dbmail"/>
<link rel="stylesheet" type="text/css" href="lib/exe/css.php?t=ubuntu-2010&amp;tseed=4af22dedc19f28c99fa67afabbb173df"/>
<script type="text/javascript">/*<![CDATA[*/var NS='';var JSINFO = {"id":"dbmail","namespace":""};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="lib/exe/js.php?tseed=4af22dedc19f28c99fa67afabbb173df"></script>
    <link rel="shortcut icon" href="http://www-static.ubuntu-fr.org/theme2010/images/commun/ubuntu/icone.png" type="image/x-icon" />
    <link rel="apple-touch-icon" href="http://www-static.ubuntu-fr.org/theme2010/images/commun/ubuntu/touch-ico.png" />

    <link rel="stylesheet" media="screen" type="text/css" title="Design Ubuntu-fr" href="http://www-static.ubuntu-fr.org/theme2010/css/doc.css" />
    <link rel="stylesheet" media="screen" type="text/css" title="Design Ubuntu-fr" href="http://www-static.ubuntu-fr.org/theme2010/css/doc-ubuntu.css" />
    <link rel="stylesheet" media="print" type="text/css" title="Design Ubuntu-fr" href="http://www-static.ubuntu-fr.org/theme2010/css/doc-print.css" />

    <script type="text/javascript">
      var menu_hidden;
      var static_url = "UFR_STATIC";
    </script>
    <script src="http://www-static.ubuntu-fr.org/theme2010/js/menu.js" type="text/javascript"></script>
    <script src="http://www-static.ubuntu-fr.org/theme2010/js/common.js" type="text/javascript"></script>
  </head>
  <body>

    <div id="accessibar">
      <a href="dbmail#main" tabindex="1">Contenu</a> | <a href="dbmail#qsearch__in" tabindex="2">Rechercher</a> | <a href="dbmail#navigation" tabindex="3">Menus</a>
    </div>

    <div id="page">

      <div id="header">

        <div id="logo">
          <h1>Ubuntu-fr</h1>
          <a href="index.html" title="Accueil de la documentation">Communauté francophone d'utilisateurs d'Ubuntu</a>
        </div>

        <form action="http://ubuntu-fr.org/recherche" accept-charset="utf-8" id="search" onsubmit="if (document.getElementById('qsearch__in').value == 'Recherche rapide....') {document.getElementById('qsearch__in').value = '';}">
          <fieldset>
            <label for="qsearch__in">Recherche : </label><input type="text" value="Recherche rapide...." id="qsearch__in" accesskey="f" name="sk_q" alt="[F]" size="34" tabindex="4" />
            <label for="tsearch_field">Chercher dans : </label><select name="sk_engine" tabindex="5" id="tsearch_field" title="Chercher dans">
              <option value="all">Site</option>
              <option selected="selected" value="doc">Documentation</option>
              <option value="forum">Forum</option>
              <option value="planet">Planet</option>
            </select>
            <input type="submit" value="ok" class="button" alt="Lancer la recherche" tabindex="5" />
          </fieldset>
        </form>
        <!--[if lte IE 7]><div class="clear"></div><![endif]-->

        <form action="dbmail" accept-charset="utf-8" id="login_top" method="post">
          <fieldset>
            <label for="u_field">Identifiant : </label><input type="text" value="Identifiant" name="u" id="u_field" size="9" /><label for="p_field">Mot de passe : </label><input type="password" value="Mot de passe" name="p" id="p_field" size="9" alt="Mot de passe" /><input type="submit" value="connexion" id="connect" /> / <a href="http://forum.ubuntu-fr.org/register.php">inscription</a>
          </fieldset>
        </form>
 

      </div>

      <div id="navbar">
          <h2 id="pagetitle"><a href="dbmail" >dbmail</a></h2>
      </div>

      
      <div id="main" class="dokuwiki">

        <div id="hidemenu" title="Masquer le menu"></div>

        <div id="pagerror"></div>
                <div class="notetag">Cette page est en cours de rédaction.<br />
<a href="wiki/participer_wiki">Apportez votre aide…</a>
</div>
<!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table des matières</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="dbmail#pre-requis">Pré-requis</a></div></li>
<li class="level1"><div class="li"><a href="dbmail#postfix">PostFix</a></div></li>
<li class="level1"><div class="li"><a href="dbmail#dbmail_3x">Dbmail 3.x</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="dbmail#dbmail_22_obsolete">Dbmail 2.2 (obsolète)</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="dbmail#configuration">Configuration</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="dbmail#dbmail_30">dbmail 3.0</a></div></li>
<li class="level2"><div class="li"><a href="dbmail#dbmail_22">dbmail 2.2</a></div></li>
<li class="level2"><div class="li"><a href="dbmail#compte_boite_aux_lettres_-_mailbox">Compte Boîte aux Lettres - Mailbox</a></div></li>
<li class="level2"><div class="li"><a href="dbmail#sasl">SASL</a></div></li>
<li class="level2"><div class="li"><a href="dbmail#postfix_sasl">postfix sasl</a></div></li>
<li class="level2"><div class="li"><a href="dbmail#mise_en_place_du_cram-md5">Mise en place du CRAM-MD5</a></div></li>
<li class="level2"><div class="li"><a href="dbmail#statistiques_des_connexions_dbmail_authlog">Statistiques des connexions  &amp; dbmail_authlog</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="dbmail#alias_et_forward">Alias et Forward</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="dbmail#alias">Alias</a></div></li>
<li class="level2"><div class="li"><a href="dbmail#forward">Forward</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="dbmail#notifications">Notifications</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="dbmail#dbmail_auto_notifications">dbmail_auto_notifications</a></div></li>
<li class="level2"><div class="li"><a href="dbmail#dbmail_auto_replies">dbmail_auto_replies</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="dbmail#filtrer_les_headers_dbmail_filters">Filtrer les Headers &amp; dbmail_filters</a></div></li>
<li class="level1"><div class="li"><a href="dbmail#shared_mailboxes">Shared Mailboxes</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="dbmail#dbmail-aclsh">dbmail-acl.sh</a></div></li>
<li class="level2"><div class="li"><a href="dbmail#mailbox">Mailbox</a></div></li>
<li class="level2"><div class="li"><a href="dbmail#users">#Users</a></div></li>
<li class="level2"><div class="li"><a href="dbmail#public">#Public</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="dbmail#mailman">Mailman</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="dbmail#ajouter_les_recipients">Ajouter les Recipients</a></div></li>
<li class="level2"><div class="li"><a href="dbmail#annexe_mailman">Annexe mailman</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="dbmail#web-based_dbmailadmin">Web-based DbmailAdmin</a></div></li>
<li class="level1"><div class="li"><a href="dbmail#pare-feu">Pare-feu</a></div></li>
<li class="level1"><div class="li"><a href="dbmail#auth_basic_apache_sasl_smtp">Auth Basic Apache SASL SMTP</a></div></li>
<li class="level1"><div class="li"><a href="dbmail#auth_digest_apache_dbmail_users">Auth Digest Apache dbmail_users</a></div></li>
<li class="level1"><div class="li"><a href="dbmail#voir_aussi">Voir aussi</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->
<div class="tags"><span>
	<a href="serveur" class="wikilink1" title="serveur" rel="tag">serveur</a>,
	<a href="serveurs_messagerie" class="wikilink1" title="serveurs_messagerie" rel="tag">serveurs messagerie</a>,
	<a href="courriel" class="wikilink1" title="courriel" rel="tag">courriel</a>,
	<a href="ubuntu_server" class="wikilink1" title="ubuntu_server" rel="tag">ubuntu server</a>,
	<a href="brouillon" class="wikilink1" title="brouillon" rel="tag">brouillon</a>
</span></div>
<hr />

<h1 class="sectionedit1" id="dbmailserveur_de_courrier_imap_et_pop">DBMail : serveur de courrier IMAP et POP</h1>
<div class="level1">

<p>
<strong>DBMail</strong> permet de stocker les courriels dans une base de données au lieu du disque, et d&#039;y accéder en IMAP ou POP.
</p>

<p>
Il travaille en conjonction avec <a href="postfix" class="wikilink1" title="postfix">Postfix</a>, l&#039;agent de transfert de courriel (MTA) par défaut d&#039;Ubuntu.
</p>

</div>
<div class='secedit editbutton_section editbutton_1'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[DBMail : serveur de courrier IMAP et POP] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="76-361" /><input type="submit" value="Modifier" class="button" title="DBMail : serveur de courrier IMAP et POP" /></div></form></div>
<h2 class="sectionedit2" id="pre-requis">Pré-requis</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Disposer d&#039;un Nom de Domaine Déposé auprès d&#039;un Registrar et d&#039;un enregistrement MX.</div>
</li>
</ul>
<pre class="code">sudo dig domain.tld &amp;&amp; sudo dig mx domain.tld #doit exister</pre>
<ul>
<li class="level1"><div class="li"> Expérience vivement recommandée en LAMP et SSH, pour une meilleure méthodologie et débogage</div>
</li>
<li class="level1"><div class="li"> Cas particuliers auto-hébergement</div>
</li>
</ul>
<div class="table sectionedit3"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0 leftalign">     </th><th class="col1 centeralign">   Auto-hébergé         </th><th class="col2 leftalign">                   </th><th class="col3 centeralign">   Registrar type                </th><th class="col4 leftalign"> GANDI  </th><th class="col5 centeralign">  Paliatif                       </th><th class="col6 centeralign">  Smtp                                </th><th class="col7"> Imap Pop</th>
	</tr>
	<tr class="row1">
		<th class="col0 centeralign">  Cas   </th><th class="col1 leftalign"> IP fixe  </th><th class="col2 leftalign">dynamique  </th><th class="col3 leftalign"> <abbr title="Domain Name System">DNS</abbr> zone  </th><th class="col4 leftalign"> MX   </th><th class="col5 leftalign"> dyndns no-ip  </th><th class="col6 centeralign" colspan="2">   POSTFIX DBMAIL  </th>
	</tr>
	</thead>
	<tr class="row2">
		<th class="col0 leftalign">1   </th><td class="col1 leftalign">oui  </td><td class="col2 leftalign">x        </td><td class="col3 leftalign"> <a href="http://www.isalo.org/wiki.debian-fr/index.php?title=Configuration_d%27un_serveur_mail_avec_Postfix#Un_exemple_de_configuration_de_DNS_chez_gandi.net" class="urlextern" title="http://www.isalo.org/wiki.debian-fr/index.php?title=Configuration_d%27un_serveur_mail_avec_Postfix#Un_exemple_de_configuration_de_DNS_chez_gandi.net"  rel="nofollow">GANDI</a>  </td><td class="col4"> oui </td><td class="col5"> x </td><td class="col6"> Envoyer ET Recevoir </td><td class="col7">oui </td>
	</tr>
	<tr class="row3">
		<th class="col0 leftalign">2   </th><td class="col1 leftalign">    </td><td class="col2 leftalign">               </td><td class="col3 leftalign"><a href="http://guides.ovh.com/VotreServeurMail" class="urlextern" title="http://guides.ovh.com/VotreServeurMail"  rel="nofollow">OVH</a>   </td><td class="col4 leftalign">     </td><td class="col5 leftalign">              </td><td class="col6"></td><td class="col7"></td>
	</tr>
	<tr class="row4">
		<th class="col0 leftalign">3   </th><td class="col1 leftalign">x   </td><td class="col2 leftalign"> oui      </td><td class="col3"> test.domain.tld </td><td class="col4"> ok.dyndns.org </td><td class="col5"> ok.dyndns.org </td><td class="col6"> Envoyer ET Recevoir </td><td class="col7"> test.domain.tld mail is handled by ok.dyndns.org.</td>
	</tr>
	<tr class="row5">
		<th class="col0 leftalign">4   </th><td class="col1 leftalign">x   </td><td class="col2 leftalign">oui       </td><td class="col3 leftalign">x     </td><td class="col4 leftalign">x    </td><td class="col5 leftalign">ok.dyndns.org     </td><td class="col6 leftalign"> Envoyer Uniquement  </td><td class="col7">ok.dyndns.org has no MX record. voir smtp_generic_maps </td>
	</tr>
	<tr class="row6">
		<th class="col0 leftalign">4   </th><td class="col1 leftalign" colspan="6"> ——————–&gt; dbmail est inutile : Recevoir sur imap.fai.fr imap.gmail.com    </td><td class="col7">canonical_maps relayhost /etc/aliases </td>
	</tr>
	<tr class="row7">
		<th class="col0 leftalign">5   </th><td class="col1 leftalign"> x   </td><td class="col2 leftalign">oui               </td><td class="col3 leftalign"> x    </td><td class="col4 leftalign">x    </td><td class="col5 leftalign"> ok.dyndns.org mxok.dyndns.org  </td><td class="col6">Envoyer ET Recevoir </td><td class="col7">ok.dyndns.org mail is handled by mxok.dyndns.org. </td>
	</tr>
	<tr class="row8">
		<th class="col0 leftalign">6  </th><td class="col1 leftalign">    </td><td class="col2 leftalign">             </td><td class="col3 leftalign">     </td><td class="col4 leftalign">     </td><td class="col5 leftalign">              </td><td class="col6"></td><td class="col7"></td>
	</tr>
</table></div>

<p>
légende;    x=non,        host -t mx domain.tld
</p>
<blockquote><div class="no">
Cas 1,2,3 recommandés</div></blockquote>

</div>
<div class='secedit editbutton_section editbutton_2'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[Pré-requis] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="362-1996" /><input type="submit" value="Modifier" class="button" title="Pré-requis" /></div></form></div>
<h2 class="sectionedit4" id="postfix">PostFix</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> paquets</div>
</li>
</ul>
<pre class="code">sudo apt-get install postfix postfix-cdb postfix-mysql postfix-pcre postfix-ldap postfix-doc pflogsumm
sudo apt-get install libgsasl7 libsasl2-2 libsasl2-modules libsasl2-modules-sql sasl2-bin cyrus-sasl2-dbg cyrus-sasl2-doc
sudo apt-get install php-auth-sasl php5-sasl libapache2-mod-authn-sasl</pre>

</div>

<h4 id="configuration_de_postfix">Configuration de postfix</h4>
<div class="level4">
<pre class="code">sudo dpkg-reconfigure postfix</pre>
<ul>
<li class="level1"><div class="li"> Ajouter à la fin de sudo nano /etc/postfix/master.cf</div>
</li>
</ul>
<pre class="code">dbmail-lmtp     unix    -       -       n       -       -       lmtp</pre>

</div>

<h4 id="mailname_maincf">mailname main.cf</h4>
<div class="level4">
<pre class="code">sudo nano /etc/mailname
domain.tld</pre>
<ul>
<li class="level1"><div class="li"> <em>domain.tld</em> est le domaine en tant que domaine de messagerie</div>
</li>
<li class="level1"><div class="li"><em> smtp.domain.tld</em> est le CNAME ou alias du MX, ou MX lui même.</div>
</li>
<li class="level1"><div class="li"> le mailto: <em>toto@domain.tld</em> est alors potentiellement possible </div>
</li>
</ul>

<p>
NB: valable également pour un <em>sous.domain.tld</em> en tant que domaine de messagerie
</p>
<ul>
<li class="level1"><div class="li"> /etc/hosts</div>
</li>
</ul>
<pre class="code">sudo nano /etc/hosts
127.0.0.1   www.domain.tld smtp.domain.tld dynamic.noip.tld ... local_name localhost
#127.0.1.1   local_name
# The following lines are desirable for IPv6 capable hosts
::1   www.domain.tld smtp.domain.tld dynamic.noip.tld ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters</pre>

<p>
Il n&#039;est pas nécessaire de fixer <em>smtp.domain.tld</em> comme nom local de la machine. (hostname -s)
</p>
<pre class="code">smtp_host_lookup = native, dns</pre>
<ul>
<li class="level1"><div class="li"> man hostname dnsdomainname</div>
</li>
</ul>
<pre class="code">hostname -s   # local_name
ce_que_vous_voulez
hostname -f   # fqdn
www.mydomain.tld
hostname -d   # domaine
mydomain.tld</pre>

</div>

<h4 id="maincf">main.cf</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> méthode <em>virtual</em></div>
</li>
</ul>

<p>
sudo nano /etc/postfix/main.cf
</p>
<pre class="code"># maj 11 03 2013
# Requis
alias_database = hash:/etc/aliases
alias_maps = hash:/etc/aliases
append_dot_mydomain = no
biff = no
readme_directory = no
config_directory = /etc/postfix
recipient_delimiter = +
smtpd_banner = $myhostname ESMTP $mail_name (Ubuntu)
receive_override_options = no_address_mappings

inet_interfaces = all
inet_protocols = ipv4

myhostname = smtp.domain.tld
mydomain = domain.tld
mynetworks = 127.0.0.1 192.168.1.x 11.22.33.44
myorigin = $mydomain
mydestination = localhost 
relay_domains = $mydestination
relay_recipient_maps = mysql:/etc/postfix/dbmail_recipients.cf
relayhost = 
transport_maps = hash:/etc/postfix/transport

# Selon chaque config DNS
smtp_host_lookup = native, dns
smtp_cname_overrides_servername = yes

# Requis Virtual
virtual_mailbox_domains = mysql:/etc/postfix/dbmail_domains.cf
virtual_mailbox_maps = mysql:/etc/postfix/dbmail_mailboxes.cf
virtual_transport = dbmail-lmtp:localhost:24

# Requis SASL
broken_sasl_auth_clients = yes
smtp_sasl_auth_enable = yes
smtp_sasl_mechanism_filter = CRAM-MD5 PLAIN
smtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd
smtp_sasl_security_options = noanonymous
#smtp_sender_dependent_authentication = yes
smtpd_sasl_auth_enable = yes
smtpd_sasl_authenticated_header = no
smtpd_sasl_local_domain = domain.tld list.domain.tld sous.domain.tld domain2.tld2
smtpd_sasl_path = smtpd
smtpd_sasl_security_options = noanonymous
smtpd_sasl_type = cyrus

# Requis STARTTLS/TLS/SSL
smtp_tls_CAfile = /etc/...pem
smtp_tls_CApath = /etc/ssl/certs
smtp_tls_cert_file = /etc/...pem
smtp_tls_key_file = /etc/....pem
#smtp_tls_per_site = hash:/etc/postfix/smtp_tls_per_site
smtp_tls_scert_verifydepth = 2
smtp_tls_security_level = may
smtp_tls_session_cache_database = btree:${data_directory}/smtp_scache
smtp_tls_session_cache_timeout = 900s
smtp_use_tls = yes

smtpd_tls_CAfile = /etc/...pem
smtpd_tls_CApath = /etc/ssl/certs
smtpd_tls_ask_ccert = yes
smtpd_tls_auth_only = yes
smtpd_tls_ccert_verifydepth = 2
smtpd_tls_cert_file = /etc/...pem
smtpd_tls_key_file = /etc/....pem
smtpd_tls_loglevel = 2
smtpd_tls_mandatory_ciphers = medium
smtpd_tls_mandatory_protocols = TLSv1, SSLv3
smtpd_tls_received_header = no
smtpd_tls_session_cache_database = btree:${data_directory}/smtpd_scache
smtpd_tls_session_cache_timeout = 900s
smtpd_use_tls = yes
tls_random_source = dev:/dev/urandom

# Options Restrictions
smtpd_sender_restrictions = permit_sasl_authenticated, permit_mynetworks, reject_non_fqdn_sender,       reject_unknown_sender_domain, permit
smtpd_recipient_restrictions = permit_sasl_authenticated,	permit_tls_clientcerts,	permit_mynetworks,	permit_auth_destination,        reject_non_fqdn_sender,        reject_non_fqdn_recipient,	reject

# Option x509 client
relay_clientcerts = hash:/etc/postfix/clientcerts

# Option Limites 
bounce_queue_lifetime = 36h
maximal_queue_lifetime = 36h
smtp_destination_concurrency_limit = 5
smtp_destination_rate_delay = 1
local_destination_concurrency_limit = 5
default_destination_concurrency_limit = 10
default_destination_recipient_limit = 25
virtual_destination_concurrency_limit = 10
virtual_destination_rate_delay = 1
smtpd_client_connection_count_limit = 4
smtpd_client_connection_rate_limit = 30
smtpd_client_recipient_rate_limit = 30
smtpd_error_sleep_time = 0
smtpd_hard_error_limit = 4
smtpd_recipient_limit = 30

# Option clamsmtpd
content_filter = scan:[127.0.0.1]:10025

# Option dkim
milter_default_action = accept
milter_protocol = 2
non_smtpd_milters = inet:localhost:8891
smtpd_milters = inet:localhost:8891

# Option Debogage Erreur Log
# sudo pflogsumm /var/log/mail.log -d today  --smtpd_stats | more
# master.cf         
# smtp|submission|smtps      inet  ...       smtpd -v 
# smtp      inet  ...       smtp -v 
# postfix restart
# main.cf
# erreurs qui doivent être rapportées au postmaster
notify_classes = bounce, 2bounce, delay, policy, protocol, resource, software
#Ceci garde le message en file d&#039;attente au lieu de le retourner à l&#039;expéditeur
#OK soft_bounce = yes
soft_bounce = no
debug_peer_list = 127.0.0.1 
debug_peer_level = 4
smtpd_tls_loglevel = 3
smtp_tls_loglevel = 3</pre>

<p>
sudo nano /etc/postfix/master.cf
</p>
<pre class="code">#
# Postfix master process configuration file.  For details on the format
# of the file, see the master(5) manual page (command: &quot;man 5 master&quot;).
#
# Do not forget to execute &quot;postfix reload&quot; after editing this file.
#
# ==========================================================================
# service type  private unpriv  chroot  wakeup  maxproc command + args
#               (yes)   (yes)   (yes)   (never) (100)
# ==========================================================================
smtp      inet  n       -       n       -       -       smtpd -v
   -o content_filter=spamassassin:
   -o cleanup_service_name=pre-cleanup
   -o receive_override_options=no_unknown_recipient_checks,no_header_body_checks,no_milters
   -o smtpd_sasl_auth_enable=yes
   -o smtp_connect_timeout=1
   -o smtp_destination_rate_delay=1
submission      inet    n    -    n    -    -    smtpd -v
        -o content_filter=spamassassin:
        -o cleanup_service_name=pre-cleanup
        -o receive_override_options=no_unknown_recipient_checks,no_header_body_checks,no_milters
        -o smtpd_tls_security_level=encrypt
        -o smtpd_sasl_auth_enable=yes
        -o smtpd_client_restrictions=permit_sasl_authenticated,reject
        -o smtp_connect_timeout=1
        -o smtp_destination_rate_delay=1
smtps     inet  n       -       n       -       -       smtpd -v
  -o content_filter=spamassassin:
  -o cleanup_service_name=pre-cleanup
  -o receive_override_options=no_unknown_recipient_checks,no_header_body_checks,no_milters
  -o smtpd_tls_wrappermode=yes
  -o smtpd_sasl_auth_enable=yes
  -o smtpd_client_restrictions=permit_sasl_authenticated,reject
  -o smtp_connect_timeout=1
  -o smtp_destination_rate_delay=1
# -o milter_macro_daemon_name=ORIGINATING
#628       inet  n       -       -       -       -       qmqpd
pickup    fifo  n       -       n       60      1       pickup
  -o cleanup_service_name=pre-cleanup
pre-cleanup unix    n       -       n       -       0       cleanup
 -o virtual_alias_maps= 
cleanup   unix  n       -       n       -       0       cleanup
    -o mime_header_checks= 
    -o nested_header_checks= 
    -o body_checks= 
    -o header_checks= 
qmgr      fifo  n       -       n       300     1       qmgr
#qmgr     fifo  n       -       n       300     1       oqmgr
tlsmgr    unix  -       -       n       1000?   1       tlsmgr -v 
rewrite   unix  -       -       n       -       -       trivial-rewrite
bounce    unix  -       -       n       -       0       bounce
defer     unix  -       -       n       -       0       bounce
trace     unix  -       -       n       -       0       bounce
verify    unix  -       -       n       -       1       verify
flush     unix  n       -       n       1000?   0       flush
proxymap  unix  -       -       n       -       -       proxymap
proxywrite unix -       -       n       -       1       proxymap
smtp      unix  -       -       n       -       -       smtp -v 
direct    unix  -       -       n       -       -       smtp
# When relaying mail as backup MX, disable fallback_relay to avoid MX loops
relay     unix  -       -       n       -       1       smtp
showq     unix  n       -       n       -       -       showq
error     unix  -       -       n       -       -       error
retry     unix  -       -       n       -       -       error
discard   unix  -       -       n       -       -       discard
local     unix  -       n       n       -       -       local
virtual   unix  -       n       n       -       1       virtual
        -o virtual_destination_rate_delay=1
lmtp      unix  -       -       n       -       -       lmtp
anvil     unix  -       -       n       -       1       anvil
scache    unix  -       -       n       -       1       scache
#
# ====================================================================
# Interfaces to non-Postfix software. Be sure to examine the manual
# pages of the non-Postfix software to find out what options it wants.
#
# Many of the following services use the Postfix pipe(8) delivery
# agent.  See the pipe(8) man page for information about ${recipient}
# and other message envelope options.
# ====================================================================
# ...
# ...
#dbmail-smtp     unix    -       n       n       -       -       pipe
#  flags=  user=dbmail argv=/usr/local/sbin/dbmail-smtp -d ${recipient} -r ${sender}
dbmail-lmtp     unix    -       -        n       -       -       lmtp
      -o disable_dns_lookups=yes
# clamav clamsmtpd + spamassassin spamd
scan      unix  -       -       n       -       5      smtp
        -o smtp_send_xforward_command=yes
127.0.0.1:10026 inet  n -       n       -       5      smtpd
        -o content_filter=
        -o receive_override_options=no_unknown_recipient_checks,no_header_body_checks,no_milters
        -o smtpd_helo_restrictions=
        -o smtpd_client_restrictions=
        -o smtpd_sender_restrictions=
        -o smtpd_recipient_restrictions=permit_mynetworks,reject
        -o mynetworks_style=host
        -o smtpd_authorized_xforward_hosts=127.0.0.1 
spamassassin  unix  -   n     n     -   -   pipe
    user=spamassassin    argv=/usr/bin/spamc -f  -e /usr/sbin/sendmail -oi -f ${sender} ${recipient}
mailman unix  -       n       n       -       -       pipe
      flags=FR user=list:list 
      argv=/var/lib/mailman/bin/postfix-to-mailman.py ${nexthop} ${user}</pre>

</div>

<h4 id="dbmail_sql_query">Dbmail sql query</h4>
<div class="level4">

<p>
Création de /etc/postfix/dbmail_domains.cf
</p>
<pre class="code">sudo nano /etc/postfix/dbmail_domains.cf
user     = dbmail
password = password
hosts    = 127.0.0.1
dbname   = dbmail
query    = SELECT DISTINCT 1 FROM dbmail_aliases WHERE SUBSTRING_INDEX(alias, &#039;@&#039;, -1) = &#039;%s&#039;;</pre>

<p>
Création de /etc/postfix/dbmail_mailboxes.cf
</p>
<pre class="code">sudo nano /etc/postfix/dbmail_mailboxes.cf
user     = dbmail
password = password
hosts    = 127.0.0.1
dbname   = dbmail
query    = SELECT 1 FROM dbmail_aliases WHERE alias=&#039;%s&#039;;</pre>

<p>
Création de /etc/postfix/dbmail_recipients.cf
</p>
<pre class="code">sudo nano /etc/postfix/dbmail_recipients.cf
user     = dbmail
password = password
hosts    = 127.0.0.1
dbname   = dbmail
query = SELECT alias FROM dbmail_aliases WHERE alias=&#039;%s&#039;  ; </pre>

</div>

<h4 id="envoyer_directement">Envoyer Directement</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> relayhost=   #aucune valeur</div>
</li>
<li class="level1"><div class="li"> renseigner transport_maps</div>
</li>
</ul>
<ul>
<li class="level1"><div class="li"> transport_maps = hash:/etc/postfix/transport</div>
</li>
</ul>
<pre class="code">sudo nano /etc/postfix/transport
mydomain.tld    :
#mydomain.tld    local:   #méthode non-virtual-sql</pre>
<pre class="code">sudo postmap hash:/etc/postfix/transport </pre>
<ul>
<li class="level1"><div class="li"> /var/log/mail.log</div>
</li>
</ul>
<pre class="code">www postfix/smtp[3965]: 0A7ACA1A90: to=&lt;kim@gmx.com&gt;, relay=host[91.224.146.211]:25, delay=1, delays=0.09/0.01/0.72/0.2, dsn=2.0.0, status=sent (250 2.0.0 Ok: queued as D21C6817BF)</pre>

</div>

<h4 id="envoyer_indirectement_par_relais">Envoyer Indirectement (par relais)</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> relayhost=[smtp.sfr.fr]:587</div>
</li>
<li class="level1"><div class="li"> ou relayhost=   #aucune valeur  et renseigner transport_maps</div>
</li>
</ul>
<ul>
<li class="level1"><div class="li"> si le relais nécessite une <em>authentification</em>, renseigner <em>smtp_sasl_password_maps</em> = hash:/etc/postfix/sasl/sasl_passwd</div>
</li>
</ul>
<pre class="code">sudo nano /etc/postfix/sasl/sasl_passwd
[smtp.sfr.fr]:587 robert.pierre@sfr.fr:mot-de-passe</pre>

<p>
sudo postmap hash:/etc/postfix/sasl/sasl_passwd
</p>
<pre class="code">sudo nano /etc/postfix/transport
#cas 1
#mydomain.tld    local:     #méthode non-virtual-sql
mydomain.tld     :
#cas 2
#gmail.com smtp:[smtp.gmail.com]:587
#yahoo.fr  smtp:[smtp.yahoo.fr]:587
# cas 3
*       smtp:[smtp.sfr.fr]:587</pre>

<p>
sudo postmap hash:/etc/postfix/transport
</p>
<ul>
<li class="level1"><div class="li"> exemples;</div>
</li>
</ul>
<pre class="code">expéditeur -&gt; destinataire (transport)
toto@mydomain.tld envoie un mail vers tata@mydomain.tld  (cas 1)
toto@mydomain.tld envoie un mail vers polo@gmail.com en utilisant le relais [smtp.gmail.com]:587  (cas2)
toto@mydomain.tld envoie un mail vers arthur@orange.fr en utilisant le [smtp.sfr.fr]:587 (cas 3)</pre>
<ul>
<li class="level1"><div class="li"> /var/log/mail.log</div>
</li>
</ul>
<pre class="code">www postfix/smtp[2657]: 60462A2AFF: to=&lt;kim@gmx.com&gt;, relay=smtp.sfr.fr[93.17.128.85]:587, delay=0.5, delays=0.13/0.02/0.22/0.13, dsn=2.0.0, status=sent (250 2.0.0 Ok: queued as B3A817000087)</pre>

</div>

<h5 id="smtp_acces_a_partir_d_un_mua_type_thunderbird">SMTP accès à partir d&#039;un MUA type thunderbird</h5>
<div class="level5">

<p>
D&#039;après le main.cf master.cf;
</p>
<ol>
<li class="level1"><div class="li"> Interdit: depuis l&#039;extérieur, pas d&#039;authentification</div>
</li>
<li class="level1"><div class="li"> Autorisé : en 127.0.0.1, pas d&#039;authentification</div>
</li>
<li class="level1"><div class="li"> filtrage spamd clamsmtpd </div>
</li>
</ol>
<ul>
<li class="level1"><div class="li"> Serveur Sortant: smtp.domain.tld</div>
</li>
<li class="level1"><div class="li"> Port : 25,587,465,5678(option)</div>
</li>
<li class="level1"><div class="li"> Nom utilisateur: toto@domain.tld </div>
</li>
<li class="level1"><div class="li"> Méthode d&#039;authentification: mot de passe normal (plain), mot de passe chiffré (cram-md5)</div>
</li>
<li class="level1"><div class="li"> Sécurité de la connexion : STARTTLS, <abbr title="Transport Layer Security">TLS</abbr>/SSL</div>
</li>
</ul>

</div>

<h5 id="x509_client">x509 client</h5>
<div class="level5">
<ul>
<li class="level1"><div class="li">  <strong>Connexion forte</strong></div>
</li>
</ul>

<p>
a/ Si un certficat x509 client (format .p12) dans le magasin des certificats de thunderbird est associé à toto@domain.tld, cela surcharge ”<em>Anonymous <abbr title="Transport Layer Security">TLS</abbr> connection</em>” par ”<em>Trusted <abbr title="Transport Layer Security">TLS</abbr> connection</em>”, matché par permit_tls_clientcerts=hash:/etc/postfix/clientcerts. Biensûr, lors de la création du certificat client, il faut prévoir CN=toto@domain.tld et ajouter votre CA (Autorité de Certification) sous smtp_tls_CApath smtp_tls_CAfile
</p>
<pre class="code">sudo nano /etc/postfix/clientcerts
A8:B0:66:2B:E8:4D:4E:06:BA:C1:BA:84:2B:61:43:47 toto@domain.tld</pre>

<p>
L&#039;empreinte est en MD5(fingerprint) par défaut
</p>

<p>
b/ Cela ouvre la possibilité d&#039;avoir une exclusivité, un accès restrictif au possesseur du ledit x509 client.
Par exemple en adaptant un port existant ou en ajoutant;
</p>
<pre class="code">5678      inet  n       -       n       -       -       smtpd -v
   -o content_filter=spamassassin:
   -o receive_override_options=no_unknown_recipient_checks,no_header_body_checks,no_milters
   -o smtpd_sasl_auth_enable=no
   -o smtp_sasl_auth_enable=no
   -o smtpd_enforce_tls=yes
   -o smtpd_tls_ask_ccert=yes
   -o smtpd_tls_req_ccert=yes
   -o smtpd_client_restrictions=permit_tls_clientcerts,reject
   -o smtpd_relay_restrictions=permit_tls_clientcerts,reject
   -o smtpd_sender_restrictions=reject_unlisted_sender,permit</pre>

<p>
Au niveau du MUA type thunderbird, on a: 
-nom du serveur SMTP= smtp.domain.tld
-Port= 5678
-Nom utilisateur= non spécifié
-Méthode d&#039;authentification= pas d&#039;authentification
-Sécurité de la connexion= STARTTLS obligatoire
</p>

<p>
<em>telnet avec x509client</em>
</p>
<pre class="code">openssl s_client -connect smtp.domain.tld:5678 -starttls smtp -cert toto@domain.tld-cert.pem -key toto@domain.tld-key.pem
....
Acceptable client certificate</pre>

<p>
Pour le telnet, il faut le format certificat.pem et key.pem au lieu du p12
</p>

<p>
<em>telnet sans x509client</em>
</p>
<pre class="code">openssl s_client -connect smtp.domain.tld:5678 -starttls smtp
...
No client certificate presented</pre>

<p>
La session échoue après le ehlo.
</p>
<ul>
<li class="level1"><div class="li">  <strong>Signature forte</strong></div>
</li>
</ul>

<p>
Pour signer votre mail, il vous faut le format .p12 (pkcs12). La signature sera traduite en pkcs7.
</p>
<ul>
<li class="level1"><div class="li"> <strong>Chiffrement fort</strong></div>
</li>
</ul>

<p>
Pour chiffrer un mail en utilisant une authentification forte, il faut le x509 client du destinataire au format pem, sans sa clef privée. Si Toto veut envoyer un mail chiffré (SMIME pkcs7) à Tata, alors toto doit avoir dans le magasin des certficats x509 thunderbird: toto-cert.p12 + tata-cert.pem
</p>

</div>

<h5 id="service">Service</h5>
<div class="level5">
<pre class="code">sudo postfix &lt;start|stop|reload&gt;</pre>

</div>
<div class='secedit editbutton_section editbutton_4'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[PostFix] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="1997-18935" /><input type="submit" value="Modifier" class="button" title="PostFix" /></div></form></div>
<h1 class="sectionedit5" id="dbmail">Dbmail</h1>
<div class="level1">

</div>
<div class='secedit editbutton_section editbutton_5'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[Dbmail] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="18936-18957" /><input type="submit" value="Modifier" class="button" title="Dbmail" /></div></form></div>
<h2 class="sectionedit6" id="dbmail_3x">Dbmail 3.x</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> gestion et stockage via les tables mysql, postgresql, oracle </div>
</li>
<li class="level1"><div class="li"> adapté à la messagerie de masse et aux méthodes virtuelles de Postfix.</div>
</li>
</ul>

<p>
sudo nano /etc/apt/sources.list
</p>
<pre class="code"># stable all deb
deb http://debian.nfgd.net/debian/ stable main
# sid
deb http://debian.nfgd.net/debian/ sid main
# lucid
deb http://debian.nfgd.net/debian/ lucid main
# ppa Leonel Nunez
deb http://ppa.launchpad.net/leonelnunez/ppa/ubuntu precise main 
deb-src http://ppa.launchpad.net/leonelnunez/ppa/ubuntu precise main </pre>
<pre class="code">sudo apt-get update &amp;&amp; sudo apt-get upgrade</pre>
<pre class="code">sudo apt-get install dbmail</pre>

<p>
<a href="http://www.dbmail.org/index.php?page=download" class="urlextern" title="http://www.dbmail.org/index.php?page=download"  rel="nofollow">Téléchargement</a>
</p>

</div>

<h4 id="build-packages-from-source">build-packages-from-source</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> /etc/apt/sources.list</div>
</li>
</ul>
<pre class="code">deb-src http://debian.nfgd.net/debian unstable main</pre>
<ul>
<li class="level1"><div class="li"> Chacun des appels apt-get va se plaindre de dépendances manquantes (*note). Juste les installer manuellement, et émettre à nouveau la commande.</div>
</li>
</ul>
<pre class="code">sudo apt-get -b source libsieve
sudo dpkg -i libsieve*.deb
sudo apt-get -b source libzdb
sudo dpkg -i libzdb*.deb
sudo apt-get -b source dbmail
sudo dpkg -i dbmail*.deb</pre>

</div>

<h4 id="build-from-tartgz">build-from-tar.tgz</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> Installer les lib-dev relatives à GLIB, GMIME, SIEVE, MHASH, ZDB, LIBEVENT (*note)</div>
</li>
</ul>
<pre class="code">./configure --with-zdb=/usr --with-sieve --with-ldap --localstatedir=/var/run/dbmail --sysconfdir=/etc/dbmail --with-logdir=/var/log/dbmail

 DM_LOGDIR:                 /var/log/dbmail
 DM_CONFDIR:                /etc/dbmail
 DM_STATEDIR:               /var/run/dbmail
 USE_DM_GETOPT:             
 CFLAGS:                    -g -O2 -pthread -I/usr/include/glib-2.0 -I/usr/lib/glib-2.0/include   -D_LARGEFILE64_SOURCE -pthread -I/usr/include/gmime-2.4 -I/usr/include/glib-2.0 -I/usr/lib/glib-2.0/include   -I/usr/include/zdb -W -Wall -Wpointer-arith -Wstrict-prototypes
 GLIB:                      -Wl,--export-dynamic -pthread -lgmodule-2.0 -lrt -lglib-2.0  
 GMIME:                     -pthread -lgmime-2.4 -lgobject-2.0 -lgthread-2.0 -lrt -lglib-2.0  
 SIEVE:                     -lsieve
 LDAP:                      -lldap
 SHARED:                    yes
 STATIC:                    no
 CHECK:                     
 SOCKETS:                   
 MATH:                      -lm
 MHASH:                     -lmhash
 LIBEVENT:                  -levent
 OPENSSL:                   -lssl
 ZDB:                       -lzdb

make all
sudo make install</pre>

<p>
Les fichiers sont copiés par défault dans /usr/local/sbin/ Prévoir un ln -s ou cp pour /usr/sbin
</p>

</div>
<div class='secedit editbutton_section editbutton_6'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[Dbmail 3.x] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="18958-21508" /><input type="submit" value="Modifier" class="button" title="Dbmail 3.x" /></div></form></div>
<h3 class="sectionedit7" id="dbmail_22_obsolete">Dbmail 2.2 (obsolète)</h3>
<div class="level3">

</div>
<div class='secedit editbutton_section editbutton_7'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[Dbmail 2.2 (obsolète)] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="21509-21542" /><input type="submit" value="Modifier" class="button" title="Dbmail 2.2 (obsolète)" /></div></form></div>
<h2 class="sectionedit8" id="configuration">Configuration</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_8'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[Configuration] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="21543-21568" /><input type="submit" value="Modifier" class="button" title="Configuration" /></div></form></div>
<h3 class="sectionedit9" id="dbmail_30">dbmail 3.0</h3>
<div class="level3">

<p>
<a href="http://www.iredmail.org/wiki/index.php?title=Integration/DBMail.iRedMail.with.MySQL.backend/RHEL#Summary" class="urlextern" title="http://www.iredmail.org/wiki/index.php?title=Integration/DBMail.iRedMail.with.MySQL.backend/RHEL#Summary"  rel="nofollow">Complément d&#039;informations</a>
</p>

</div>
<div class='secedit editbutton_section editbutton_9'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[dbmail 3.0] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="21569-21728" /><input type="submit" value="Modifier" class="button" title="dbmail 3.0" /></div></form></div>
<h3 class="sectionedit10" id="dbmail_22">dbmail 2.2</h3>
<div class="level3">

</div>

<h4 id="la_base_de_donnees">la base de données</h4>
<div class="level4">

<p>
Création du schema dbmail
</p>
<pre class="code">mysql -uroot -p
mysql&gt; CREATE schema dbmail;
mysql&gt;ALTER DATABASE  `dbmail` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;</pre>

<p>
Récupération et décompression du modèle de table :
</p>
<pre class="code">cp /usr/share/doc/dbmail-mysql/examples/create_tables.mysql.gz ~/
gzip --decompress ~/create_tables.mysql.gz</pre>

<p>
Création des tables
</p>
<pre class="code">mysql -uroot -p dbmail &lt; ~/create_tables.mysql</pre>

<p>
Création d&#039;un utilisateur dbmail
</p>
<pre class="code">mysql -uroot -p
GRANT ALL ON dbmail.* to dbmail@localhost identified by &#039;password&#039;;</pre>

</div>

<h4 id="dbmail1">dbmail</h4>
<div class="level4">

<p>
Modification des lignes suivantes dans /etc/dbmail/dbmail.conf
</p>
<pre class="code">sudo vim /etc/dbmail/dbmail.conf
driver = mysql
authdriver = sql
host = localhost
sqlsocket = /var/run/mysqld/mysqld.sock
user = dbmail
pass = password
db = dbmail
SIEVE_NOTIFY = no</pre>

<p>
Modification de /etc/default/dbmail pour le démarrage de l&#039;imap et lmtp
</p>
<pre class="code">sudo vim /etc/default/dbmail
START_IMAPD=1
START_LMTPD=1
START_SIEVE=1</pre>

<p>
Redémarrage de dbmail
</p>
<pre class="code">sudo service dbmail restart</pre>

</div>
<div class='secedit editbutton_section editbutton_10'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[dbmail 2.2] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="21729-22769" /><input type="submit" value="Modifier" class="button" title="dbmail 2.2" /></div></form></div>
<h3 class="sectionedit11" id="compte_boite_aux_lettres_-_mailbox">Compte Boîte aux Lettres - Mailbox</h3>
<div class="level3">

<p>
<strong>sudo dbmail-users</strong>
</p>
<ul>
<li class="level1"><div class="li"> -a  <em>ajouter un nouveau Compte</em></div>
</li>
<li class="level1"><div class="li"> -w  <em>mot de passe</em></div>
</li>
<li class="level1"><div class="li"> -p  <em>type_password</em>   md5, plaintext, crypt, md5-hash, md5-digest, crypt-raw, md5-hash-raw, md5-digest-raw, md5-base64, md5-base64-raw </div>
</li>
<li class="level1"><div class="li"> -c  <em>mise à jour du compte</em></div>
</li>
<li class="level1"><div class="li"> -s  <em>créer</em> une adresse mail ou plusieurs alias  -s toto@domain.tld,titi@domain.tld</div>
</li>
<li class="level1"><div class="li"> -S  <em>supprimer</em> une adresse mail ou plusieurs alias</div>
</li>
<li class="level1"><div class="li"> -m  <em>quota</em> -m 50M </div>
</li>
<li class="level1"><div class="li"> -d   <em>supprimer un compte</em></div>
</li>
<li class="level1"><div class="li"> -x toto@domain.tld -t forward@domain2.tld2   <em>ajouter un forward </em></div>
</li>
<li class="level1"><div class="li"> -x toto@domain.tld -T forward@domain2.tld2   <em>supprimer un forward</em></div>
</li>
</ul>

<p>
<strong> Ajouter &amp; Créer un nouveau compte toto@domain.tld avec son adresse mail toto@domain.tld</strong>
</p>
<pre class="code">sudo dbmail-users -a toto@domain.ltd -w mypass -p md5 -s toto@domain.ltd
Adding INBOX for new user... ok.
[toto@domain.tld]
Done</pre>

<p>
Supprimer un compte
</p>
<pre class="code">sudo dbmail-users -d toto@domain.tld</pre>

<p>
<a href="http://www.dbmail.org/dokuwiki/doku.php/manage_users" class="urlextern" title="http://www.dbmail.org/dokuwiki/doku.php/manage_users"  rel="nofollow">http://www.dbmail.org/dokuwiki/doku.php/manage_users</a>
</p>

</div>
<div class='secedit editbutton_section editbutton_11'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[Compte Boîte aux Lettres - Mailbox] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="22770-23799" /><input type="submit" value="Modifier" class="button" title="Compte Boîte aux Lettres - Mailbox" /></div></form></div>
<h3 class="sectionedit12" id="sasl">SASL</h3>
<div class="level3">

<p>
Dbmail utilise saslauthd comme démon d&#039;authentification (sasl authentication server).
Rimap (Requête d&#039;authentification au près du serveur IMAP) est exploité dans ce tuto.
Pam n&#039;est pas vraiment adapté pour la messagerie de masse et il y a toujours moyen de convertir un user unix/pam en virtual/rimap par exemple. Avec les solutions Webmail, ce sentiment est renforcé.
</p>

</div>

<h4 id="convertir_un_utilisateur_unixpam_en_virtualrimap">Convertir un utilisateur Unix/Pam en Virtual/Rimap</h4>
<div class="level4">

<p>
sudo nano /etc/postfix/sender_canonical
</p>
<pre class="code">user_unix   user_virtual@domain.tld
user_unix@domain.tld   user_virtual@domain.tld</pre>
<pre class="code">sudo postmap hash:/etc/postfix/sender_canonical
sudo postconf -e &#039;sender_canonical_maps = hash:/etc/postfix/sender_canonical&#039;
sudo dbmail-users -a user_virtual@domain.tld -s user_virtual@domain.tld -w mot_de_passe</pre>

<p>
user_virtual@domain.tld sert de récipient.
</p>

</div>

<h4 id="etcdefaultsaslauthd">/etc/default/saslauthd</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> avec RIMAP</div>
</li>
</ul>
<pre class="code">START=yes
NAME=&quot;saslauthd&quot;
MECHANISMS=&quot;rimap&quot;
MECH_OPTIONS=&quot;localhost&quot;
THREADS=5
OPTIONS=&quot;-c -m /var/spool/postfix/var/run/saslauthd&quot;</pre>
<ul>
<li class="level1"><div class="li"> Service </div>
</li>
</ul>
<pre class="code">sudo service saslauthd restart|reload</pre>

</div>
<div class='secedit editbutton_section editbutton_12'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[SASL] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="23800-24930" /><input type="submit" value="Modifier" class="button" title="SASL" /></div></form></div>
<h3 class="sectionedit13" id="postfix_sasl">postfix sasl</h3>
<div class="level3">

</div>

<h4 id="maincf1">main.cf</h4>
<div class="level4">

<p>
à titre d&#039;information
</p>

</div>

<h5 id="smtp_sasl_password_maps">smtp_sasl_password_maps</h5>
<div class="level5">

<p>
Sert principalement à s&#039;authentifier auprès d&#039;un relais serveur smtp dans le but de s&#039;en servir comme transporteur.
( voir relayhost, transport_maps )
</p>

<p>
sudo nano /etc/postfix/sasl_passwd
</p>
<pre class="code">[11.22.22.44]:587 compte@fai.fr:mot_de_passe
[smtp.gmail.com]:587 compte@gmail.com:mot_de-passe</pre>
<pre class="code">sudo postmap /etc/postfix/sasl_passwd
sudo postconf -e &#039;smtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd&#039;</pre>

</div>

<h4 id="mastercf">master.cf</h4>
<div class="level4">
<pre class="code">submission      inet    n    -    n    -    -    smtpd
	....
	-o smtpd_sasl_auth_enable=yes
	-o smtpd_client_restrictions=permit_sasl_authenticated,reject</pre>

<p>
Optionnellement, la même chose pour smtp,smtps, si on veut du permit_sasl_authenticated,reject
</p>

</div>
<div class='secedit editbutton_section editbutton_13'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[postfix sasl] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="24931-25736" /><input type="submit" value="Modifier" class="button" title="postfix sasl" /></div></form></div>
<h3 class="sectionedit14" id="mise_en_place_du_cram-md5">Mise en place du CRAM-MD5</h3>
<div class="level3">
<ol>
<li class="level1"><div class="li"> authentification en clair : PLAIN, LOGIN </div>
</li>
<li class="level1"><div class="li"> authentifcation chiffrée : CRAM-MD5, DIGEST-MD5 </div>
</li>
</ol>
<ul>
<li class="level1"><div class="li"> le mech_list n&#039;a aucun rapport avec le type de stockage des mots de passe.</div>
</li>
<li class="level1"><div class="li"> cram-md5 a un stockage <em>plaintext</em> &quot;But remember, that this will work only with &#039;plain&#039; passwords in database.&quot;</div>
</li>
</ul>

<p>
<a href="http://www.postfix.org/SASL_README.html" class="urlextern" title="http://www.postfix.org/SASL_README.html"  rel="nofollow">Source Cyrus SASL Plugins - auxiliary property plugins</a>  &quot;&quot;CRAM-MD5, DIGEST-MD5 and NTLM. These mechanisms send credentials encrypted but their verification process requires the password to be available in plaintext. Consequently passwords cannot (!) be stored in encrypted form&quot;&quot;
</p>
<pre class="code">sudo dbmail-users -c toto@domain.tld -p plaintext -w password</pre>
<ul>
<li class="level1"><div class="li"> /etc/postfix/sasl/smtpd.conf peut être obtenu par lien symbolique </div>
</li>
</ul>
<pre class="code">sudo ln -s /usr/lib/sasl2/smtpd.conf /etc/postfix/sasl/smtpd.conf
sudo ln -s /usr/lib64/sasl2/smtpd.conf /etc/postfix/sasl/smtpd.conf</pre>
<ul>
<li class="level1"><div class="li"> pwcheck_method: saslauthd</div>
</li>
</ul>
<pre class="code">pwcheck_method: saslauthd
mech_list: PLAIN LOGIN</pre>

<p>
Ne pas préciser d&#039;autres mécanismes que mech_list PLAIN ou LOGIN lors de l&#039;utilisation saslauthd. Il ne peut gérer que ces deux mécanismes, et l&#039;authentification échouera si les clients sont autorisés à choisir d&#039;autres mécanismes.
</p>
<ul>
<li class="level1"><div class="li"> pwcheck_method: auxprop</div>
</li>
</ul>
<pre class="code">pwcheck_method: auxprop
mech_list: CRAM-MD5 PLAIN
auxprop_plugin: sql
log_level: 2
sql_engine: mysql
sql_hostnames: 127.0.0.1
sql_user: dbmail
sql_passwd: pass
sql_database: dbmail
sql_verbose: yes
sql_select: SELECT passwd FROM dbmail_users WHERE userid = &#039;%u@%r&#039;</pre>

<p>
NB:  userid = &#039;%u@%r&#039; si vous avez stocké sous la forme toto@domain.tld 
<a href="http://asyd.net/docs/cyrus-options.html" class="urlextern" title="http://asyd.net/docs/cyrus-options.html"  rel="nofollow">Options SASL</a>
</p>
<ul>
<li class="level1"><div class="li"> postfix main.cf</div>
</li>
</ul>
<pre class="code">smtp_sasl_mechanism_filter = cram-md5 plain</pre>
<ul>
<li class="level1"><div class="li"> /var/log/auth.log &amp; smtp_sasl</div>
</li>
</ul>
<pre class="code">postfix/smtpd[23801]: sql plugin create statement from cmusaslsecretCRAM-MD5 toto domain.tld
postfix/smtpd[23801]: sql plugin doing query SELECT passwd FROM dbmail_users WHERE userid=&#039;toto@domain.tld&#039; ;</pre>
<ul>
<li class="level1"><div class="li"> testsaslauthd (login,plain)</div>
</li>
</ul>
<pre class="code">sudo testsaslauthd -f /var/spool/postfix/var/run/saslauthd/mux -u toto@domain.tld -p password
0: OK &quot;Success.&quot;</pre>
<ul>
<li class="level1"><div class="li"> test avec roundcube</div>
</li>
</ul>
<pre class="code">18:49:46 www roundcube: [77EB] C: A0001 ID (&quot;name&quot; &quot;Roundcube Webmail&quot; &quot;version&quot; &quot;0.7.1&quot; &quot;php&quot; &quot;5.3.2-1ubuntu4.14&quot; &quot;os&quot; &quot;Linux&quot; &quot;command&quot; &quot;/roundube/?_task=mail&amp;_action=moveto&quot;)
18:49:46 www roundcube: [77EB] S: * ID (&quot;name&quot; &quot;dbmail&quot; &quot;version&quot; &quot;3.0.1&quot; &quot;os&quot; &quot;Linux&quot; &quot;os-version&quot; &quot;2.6.32-41-generic&quot;)
18:49:46 www roundcube: [77EB] S: A0001 OK ID completed
18:49:46 www roundcube: [77EB] C: A0002 AUTHENTICATE CRAM-MD5
18:49:46 www roundcube: [77EB] S: + MTM0MzA2MjE4Ni4xOTIzMy4yNkAobm9uZSk=
18:49:46 www roundcube: [77EB] C: dG90b0Bkb21haW4udGxkIDI1NmMyNmIxYmY4MjE5YjJlZjUxMTNlNTVjYjAwYmFk
18:49:46 www roundcube: [77EB] S: A0002 OK [CAPABILITY IMAP4rev1 ACL RIGHTS=texk NAMESPACE CHILDREN SORT QUOTA THREAD=ORDEREDSUBJECT UNSELECT IDLE 
STARTTLS ID] User toto@domain.tld authenticated</pre>

</div>
<div class='secedit editbutton_section editbutton_14'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[Mise en place du CRAM-MD5] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="25737-28783" /><input type="submit" value="Modifier" class="button" title="Mise en place du CRAM-MD5" /></div></form></div>
<h3 class="sectionedit15" id="statistiques_des_connexions_dbmail_authlog">Statistiques des connexions  &amp; dbmail_authlog</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> /etc/dbmail/dbmail.conf</div>
</li>
</ul>
<pre class="code">authlog               = yes  </pre>
<ul>
<li class="level1"><div class="li"> Rafraîchir en supprimant les 8000 premières lignes &amp; enregistrements.</div>
</li>
</ul>
<pre class="code">delete from dbmail_authlog where id &lt; 8000;</pre>
<ul>
<li class="level1"><div class="li"> Lister les 10 dernières connexions.</div>
</li>
</ul>
<pre class="code">SELECT * FROM dbmail_authlog order by id desc limit 10;</pre>
<ul>
<li class="level1"><div class="li"> Les traces des 10 derniers mails par date/time.</div>
</li>
</ul>
<pre class="code">SELECT * FROM dbmail_physmessage order by internal_date desc limit 10;</pre>

</div>
<div class='secedit editbutton_section editbutton_15'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[Statistiques des connexions  &amp; dbmail_authlog] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="28784-29300" /><input type="submit" value="Modifier" class="button" title="Statistiques des connexions  &amp; dbmail_authlog" /></div></form></div>
<h2 class="sectionedit16" id="alias_et_forward">Alias et Forward</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_16'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[Alias et Forward] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="29301-29332" /><input type="submit" value="Modifier" class="button" title="Alias et Forward" /></div></form></div>
<h3 class="sectionedit17" id="alias">Alias</h3>
<div class="level3">

<p>
Losque les domaines appartiennent au même mx, il s&#039;agit plutôt d&#039;alias et dérivés. Les domaines partagent également le même démon d&#039;authentification (saslauthd)
</p>
<pre class="code">sudo dbmail-users -c toto@domain.tld -s toto@domain.tld,tata@domain.tld,oto@domain2.tld2,tata@domain3.tld3</pre>
<pre class="code">smtpd_sasl_local_domain = domain.tld domain2.tld2 domain3.tld3</pre>

</div>
<div class='secedit editbutton_section editbutton_17'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[Alias] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="29333-29720" /><input type="submit" value="Modifier" class="button" title="Alias" /></div></form></div>
<h3 class="sectionedit18" id="forward">Forward</h3>
<div class="level3">

<p>
Lorsque les mx sont différents, cela ressemble plutôt à des méthodes de type forward
</p>

</div>

<h4 id="pour_envoyer_reecrire_l_expediteur">Pour envoyer, reécrire l&#039;expéditeur</h4>
<div class="level4">

<p>
pour envoyer des mails, sender_canonical_maps est suffisant
</p>

<p>
sudo nano /etc/postfix/sender_canonical
</p>
<pre class="code">yoko       babar@monmail.com
yoko@domain.tld      babar@monmail.com</pre>
<pre class="code">sudo postmap hash:/etc/postfix/sender_canonical
sudo postconf -e &#039;sender_canonical_maps = hash:/etc/postfix/sender_canonical&#039;</pre>

<p>
test
</p>
<pre class="code">yoko@pc:~$ echo &#039;bonjour&#039; | mail -s &#039;test&#039; toto@sfr.fr</pre>

<p>
yoko devient babar@monmail.com, qui envoie au destinataire final toto@sfr.fr
</p>

</div>

<h4 id="recevoir_et_faire_suivre_automatiquement_le_courrier">Recevoir et Faire Suivre automatiquement le courrier</h4>
<div class="level4">

<p>
le courrier à destination de toto@domain.tld est renvoyé chez casimir@free.fr
</p>
<pre class="code">sudo dbmail-users -x toto@domain.tld -t casimir@free.fr</pre>

</div>

<h4 id="creer_un_clone_de_mailbox_d_un_mx_different">Créer un clone de Mailbox d&#039;un mx différent</h4>
<div class="level4">
<blockquote><div class="no">
sudo apt-get install imapsync</div></blockquote>

<p>
Dans l&#039;exemple qui suit, la boîte aux lettres de gmail est copié sur une boîte aux lettres récemment crée de votre domaine.
</p>
<ul>
<li class="level1"><div class="li"> host1 est la source, host2 est la destination.</div>
</li>
</ul>
<ul>
<li class="level1"><div class="li"> Simuler avec –dry</div>
</li>
</ul>
<pre class="code">imapsync --host1 imap.gmail.com --user1 compte@gmail.com --password1 motdepasse_gmail --port1 993 --ssl1 --authmech1 LOGIN --host2 mail.domain.tld --user2 yoko@domain.tld --password2 motdepasse_yoko --dry</pre>
<ul>
<li class="level1"><div class="li"> Copier réellement</div>
</li>
</ul>
<pre class="code">imapsync --host1 imap.gmail.com --user1 compte@gmail.com --password1 motdepasse_gmail --port1 993 --ssl1 --authmech1 LOGIN --host2 mail.domain.tld --user2 yoko@domain.tld --password2 motdepasse_yoko</pre>

</div>

<h4 id="recevoir_et_rapatrier_du_courrier">Recevoir et Rapatrier du courrier</h4>
<div class="level4">
<blockquote><div class="no">
sudo apt-get install fetchmail</div></blockquote>

<p>
fetchmailconf sert à rien et risque de vous induire en erreurs.
</p>

<p>
Dans l&#039;exemple ci-dessous, le courrier est rapatrié d&#039;un compte gmail
</p>

<p>
sudo nano /etc/fetchmailrc
</p>
<pre class="code"># Read the ISP accounts every 3600 seconds
set syslog 
set daemon 3600 

# Configure the ISP accounts (POP server, users and respective passwords)
poll imap.gmail.com with protocol IMAP: 
user &quot;babar@monmail.com&quot; with pass &quot;motdepasse-de-babar&quot; with ssl with sslcertck is &quot;yoko@domain.tld&quot; here keep
smtphost smtp.domain.tld</pre>

<p>
<a href="http://fetchmail.berlios.de/fetchmail-man.html#5" class="urlextern" title="http://fetchmail.berlios.de/fetchmail-man.html#5"  rel="nofollow">Options Fetchmail</a>
</p>

<p>
Fetchmail relève toutes les heures les mails de babar@monmail.com et les rapatrie directement sur yoko@domain.tld.
</p>
<ul>
<li class="level1"><div class="li"> keep signifie que fetchmail crée une copie du mail sans le détruire sur le serveur distant.</div>
</li>
<li class="level1"><div class="li"> sender_canonical_maps a été défini.</div>
</li>
<li class="level1"><div class="li"> sudo service fetchmail restart # pour relançer le démon.</div>
</li>
</ul>

<p>
Fetchmail fait un doublon, voir inutile,  si vous avez délà roundcube, qui fait déjà du <em>fetch</em>.
</p>
<ul>
<li class="level1"><div class="li"> exemple en modifiant le main.inc.php de roundcube</div>
</li>
</ul>
<pre class="code">$rcmail_config[&#039;default_host&#039;] = array(
        .... 
	&#039;imap.free.fr:143&#039; =&gt; &#039;FREE&#039;,
	&#039;ssl://imap.gmail.com:993&#039; =&gt; &#039;GMAIL&#039;,
	&#039;imap.gmx.com:143&#039; =&gt; &#039;GMX&#039;,
	&#039;ssl://imap.orange.fr:993&#039; =&gt; &#039;ORANGE&#039;,
	&#039;imap.sfr.fr:143&#039; =&gt; &#039;SFR&#039;,
	&#039;ssl://imap.domain.tld:993&#039; =&gt; &#039;mondomaine&#039;,
	&#039;ssl://imap.mail.yahoo.com:993&#039; =&gt; &#039;YAHOO&#039;);</pre>

<p>
<em>Fetchmail</em> peut servir à créer des Shared Mailboxes dbmail complexes, en rapatriant des mailboxes de domaines de mx différents.
</p>

</div>
<div class='secedit editbutton_section editbutton_18'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[Forward] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="29721-32915" /><input type="submit" value="Modifier" class="button" title="Forward" /></div></form></div>
<h2 class="sectionedit19" id="notifications">Notifications</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_19'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[Notifications] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="32916-32943" /><input type="submit" value="Modifier" class="button" title="Notifications" /></div></form></div>
<h3 class="sectionedit20" id="dbmail_auto_notifications">dbmail_auto_notifications</h3>
<div class="level3">
<blockquote><div class="no">
/etc/dbmail/dbmail.conf</div></blockquote>
<pre class="code">AUTO_NOTIFY           = yes  
# Defaults to AUTO_NOTIFY_SUBJECT =&quot;NEW MAIL NOTIFICATION&quot;
# AUTO_NOTIFY_SUBJECT        = 
# Defaults to AUTO_NOTIFY_SENDER &quot;autonotify@dbmail&quot;
AUTO_NOTIFY_SENDER        = webmaster@domain.tld</pre>

<p>
notify_address:Mail-Address, where the notification should go to
</p>
<pre class="code">INSERT INTO dbmail_auto_notifications ( user_idnr, notify_address ) VALUES ( &#039;9&#039;, &#039;admin.perso@fai.fr&#039; );</pre>

<p>
Dès qu&#039;un mail arrive chez modo@domain.tld(user_idnr=&#039;9&#039;), un mail &quot;NEW MAIL NOTIFICATION&quot; est envoyé par webmaster@domain.tld pour admin.perso@fai.fr 
</p>

<p>
Attention, autonotify@dbmail génère une erreur car évidemment le récipient n&#039;est pas connu.
</p>

</div>
<div class='secedit editbutton_section editbutton_20'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[dbmail_auto_notifications] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="32944-33683" /><input type="submit" value="Modifier" class="button" title="dbmail_auto_notifications" /></div></form></div>
<h3 class="sectionedit21" id="dbmail_auto_replies">dbmail_auto_replies</h3>
<div class="level3">

<p>
Chaque utilisateur peut spécifier un message de réponse automatique à tous les messages entrants. 
</p>
<blockquote><div class="no">
/etc/dbmail/dbmail.conf</div></blockquote>

<p>
AUTO_REPLY            = yes
</p>
<pre class="code">INSERT INTO dbmail_auto_replies ( user_idnr, start_date, stop_date, reply_body ) VALUES ( &#039;4&#039;, &#039;2012-10-22 00:00:00&#039;, &#039;2013-01-01 00:00:00&#039;, &#039;Votre mail est bien arrive&#039; );</pre>

</div>
<div class='secedit editbutton_section editbutton_21'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[dbmail_auto_replies] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="33684-34057" /><input type="submit" value="Modifier" class="button" title="dbmail_auto_replies" /></div></form></div>
<h2 class="sectionedit22" id="filtrer_les_headers_dbmail_filters">Filtrer les Headers &amp; dbmail_filters</h2>
<div class="level2">

<p>
dbmail_filters permet principalement de rediriger un mail vers une mailbox en fonction du header.
</p>
<ul>
<li class="level1"><div class="li"> pour lister les identifiants; select user_idnr, userid from dbmail_users;</div>
</li>
<li class="level1"><div class="li"> Pour lister les mailboxes; select name from dbmail_mailboxes where owner_idnr=&#039;25&#039;;</div>
</li>
</ul>
<pre class="code">insert into dbmail_filters ( user_id, headername, headervalue, mailbox) value ( &#039;25&#039;, &#039;From&#039;, &#039;bank@bnp.fr&#039;, &#039;Compta&#039; ); 
insert into dbmail_filters ( user_id, headername, headervalue, mailbox) value ( &#039;46&#039;, &#039;cc&#039;, &#039;compte-fai-fetch@domain.tld&#039;, &#039;inbox/sent&#039; ); </pre>

<p>
dbmail_filters est insensible à la casse de polices, et comprendre user_id comme user_idnr (lapsus avec userid).
</p>
<ul>
<li class="level1"><div class="li"> Annexe Header</div>
</li>
</ul>
<pre class="code">select headername from dbmail_headername order by headername; </pre>

</div>
<div class='secedit editbutton_section editbutton_22'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[Filtrer les Headers &amp; dbmail_filters] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="34058-34861" /><input type="submit" value="Modifier" class="button" title="Filtrer les Headers &amp; dbmail_filters" /></div></form></div>
<h2 class="sectionedit23" id="shared_mailboxes">Shared Mailboxes</h2>
<div class="level2">

<p>
Ces boîtes sont appelées boîtes aux lettres partagées - Elles sont décrites dans la table <em>dbmail_subscription</em>. Les droits d&#039;accès appropriés sont décrits dans la table <em>dbmail_acl</em>.
</p>

<p>
Lister les identifiants et récupérer le user_idnr 
</p>
<pre class="code">select user_idnr,userid,passwd from dbmail_users; 
+-----------+--------------------------------+------------------------------------+
|  user_idnr |    userid                    | passwd                          |
+-----------+--------------------------------+------------------------------------+
|         1 | __@!internal_delivery_user!@__ |                                    |
|         2 | anyone                         |                                    |
|         3 | __public__                     |                                    |
....
sudo dbmail-users -l __public__ | awk -F: &#039;{print$3}&#039;    # renvoit 3</pre>

</div>
<div class='secedit editbutton_section editbutton_23'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[Shared Mailboxes] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="34862-35780" /><input type="submit" value="Modifier" class="button" title="Shared Mailboxes" /></div></form></div>
<h3 class="sectionedit24" id="dbmail-aclsh">dbmail-acl.sh</h3>
<div class="level3">

<p>
<a href="http://linux.bononline.nl/linux/dbmail/src/dbmail-acl.sh" class="urlextern" title="http://linux.bononline.nl/linux/dbmail/src/dbmail-acl.sh"  rel="nofollow">Téléchargement</a>
Ce script permet de créer plus facilement les boîtes aux lettres partagées.
</p>
<pre class="code">mkdir ~/dbmail ; cd ~/dbmail
wget http://linux.bononline.nl/linux/dbmail/src/dbmail-acl.sh
sudo cp /etc/dbmail/dbmail.conf .
sudo chown votre_user:votre_user ./dbmail.conf 
sudo chmod +x dbmail-acl.sh </pre>

<p>
Renseigner la partie
</p>
<pre class="code">DBMAIL[_dbmail_mysqldatabase]=&quot;dbmail&quot;
DBMAIL[_dbmail_mysqluser]=&quot;dbmail&quot;
DBMAIL[_dbmail_mysqlpassword]=&quot;gdhgybvudo&quot;
DBMAIL[_dbmail_mysqlhost]=&quot;localhost&quot;
DBMAIL[_dbmail_conffile]=&quot;/home/votre_user/dbmail/dbmail.conf&quot;
DBMAIL[_dbmail_driver]=&quot;mysql&quot;</pre>

<p>
modifier pour dbmail 3.x à proximité de function get_all_acls() 
</p>
<pre class="code">$MYSQL_CLIENT -N -e &quot;SELECT lookup_flag, read_flag, seen_flag, write_flag, insert_flag, post_flag, create_flag, delete_flag, deleted_flag, expunge_flag, administer_flag FROM dbmail_acl WHERE mailbox_id = $mailbox_idnr and user_id = $user_idnr;&quot;</pre>

<p>
et acl_add()
</p>
<pre class="code"> $MYSQL_CLIENT -e &quot;INSERT INTO dbmail_acl values ($user_idnr, $mailbox_idnr, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1);&quot;</pre>

</div>

<h4 id="utilisation">Utilisation</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> dbmail-acl.sh add|del user owner [mailbox]</div>
</li>
</ul>

<p>
Ajoute ou supprime une mailbox partagée du propriétaire qui peut être accédée par tel utilisateur. La valeur par défaut est la boîte de réception (INBOX)
</p>
<ul>
<li class="level1"><div class="li"> dbmail-acl.sh add|del user owner &#039;*&#039;</div>
</li>
</ul>

<p>
Pour avoir accès à toutes les boîtes de propriétaire, entrez un astérisque ( Recommandé si vous voulez rapatrier un compte au complet ou un compte <abbr title="Fournisseur d&#039;Accès à Internet">FAI</abbr>)
</p>
<ul>
<li class="level1"><div class="li"> dbmail-acl.sh list [command]</div>
</li>
</ul>

<p>
command est acl ou mailbox. La valeur par défaut est acl.
</p>
<ul>
<li class="level1"><div class="li"> dbmail-acl.sh list acl [userid]</div>
</li>
</ul>

<p>
Liste les <abbr title="Access Control List">ACL</abbr> pour tel userid. La valeur par défaut est tous les userid sont sélectionnés.
</p>
<ul>
<li class="level1"><div class="li"> dbmail-acl.sh list mailbox [userid]</div>
</li>
</ul>

<p>
Liste toutes les mailboxes pour tel userid. La valeur par défaut est toutes les mailboxes sont sélectionnées.
</p>

</div>
<div class='secedit editbutton_section editbutton_24'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[dbmail-acl.sh] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="35781-37745" /><input type="submit" value="Modifier" class="button" title="dbmail-acl.sh" /></div></form></div>
<h3 class="sectionedit25" id="mailbox">Mailbox</h3>
<div class="level3">

<p>
Au besoin, si dbmail-acl.sh ne crée pas les mailboxes.
</p>
<ul>
<li class="level1"><div class="li"> création manuelle mailbox anyone</div>
</li>
</ul>
<pre class="code">insert INTO dbmail_mailboxes (owner_idnr, name, seen_flag, answered_flag, deleted_flag, flagged_flag, recent_flag, draft_flag, no_inferiors, no_select, permission, seq ) VALUES ( &#039;2&#039;, &#039;INBOX&#039;, &#039;0&#039;, &#039;0&#039;, &#039;0&#039;, &#039;0&#039;, &#039;0&#039;, &#039;0&#039;, &#039;0&#039;, &#039;0&#039;, &#039;2&#039;, &#039;0&#039; );</pre>
<ul>
<li class="level1"><div class="li"> création manuelle mailbox public</div>
</li>
</ul>
<pre class="code">insert INTO dbmail_mailboxes (owner_idnr, name, seen_flag, answered_flag, deleted_flag, flagged_flag, recent_flag, draft_flag, no_inferiors, no_select, permission, seq ) VALUES ( &#039;3&#039;, &#039;INBOX&#039;, &#039;0&#039;, &#039;0&#039;, &#039;0&#039;, &#039;0&#039;, &#039;0&#039;, &#039;0&#039;, &#039;0&#039;, &#039;0&#039;, &#039;2&#039;, &#039;0&#039; );</pre>

</div>
<div class='secedit editbutton_section editbutton_25'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[Mailbox] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="37746-38418" /><input type="submit" value="Modifier" class="button" title="Mailbox" /></div></form></div>
<h3 class="sectionedit26" id="users">#Users</h3>
<div class="level3">

<p>
en supposant que vous ayez 3 comptes distincts;
</p>
<pre class="code">sudo dbmail-users -a t1@domain.tld -s t1@domain.tld -w t1
sudo dbmail-users -a t2@domain.tld -s t2@domain.tld -w t2
sudo dbmail-users -a t3@domain.tld -s t3@domain.tld -w t3</pre>

<p>
<strong>t1@mdomain.tld partage sa mailbox avec t2@domain.tld et t3@domain.tld</strong>
</p>
<pre class="code">sudo bash ~/dbmail/dbmail-acl.sh add t2@domain.tld t1@mdomain.tld 
Taking default mailbox INBOX
Adding (full) acl rights for 26 to 60.
Adding subscription of 26 to 60.
sudo bash ~/dbmail/dbmail-acl.sh add t3@domain.tld t1@domain.tld 
Taking default mailbox INBOX
Adding (full) acl rights for 27 to 60.
Adding subscription of 27 to 60.
 </pre>

</div>

<h4 id="messagerie_de_t2_domaintld">Messagerie de t2@domain.tld</h4>
<div class="level4">

<p>
La messagerie t1@domain.tld est partagée et incluse dans celle de t2@domain.tld.
</p>

<p>
<a href="http://doc.ubuntu-fr.org/_media/dbmail/dbmail-partage-users.png" class="media" title="dbmail:dbmail-partage-users.png"><img src="http://doc.ubuntu-fr.org/_media/dbmail/dbmail-partage-users.png?w=700&amp;tok=ea323e" class="medialeft" alt="" width="700" /></a>
</p>

</div>
<div class='secedit editbutton_section editbutton_26'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[#Users] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="38419-39272" /><input type="submit" value="Modifier" class="button" title="#Users" /></div></form></div>
<h3 class="sectionedit27" id="public">#Public</h3>
<div class="level3">

<p>
en supposant que vous ayez 1 compte distinct;
</p>
<pre class="code">sudo dbmail-users -a entreprise@domain.tld -s entreprise@domain.tld -w entreprise</pre>
<pre class="code">sudo bash ~/dbmail/dbmail-acl.sh add entreprise@domain.tld __public__ 
Taking default mailbox INBOX
Adding (full) acl rights for 28 to 51.
Adding subscription of 28 to 51.</pre>

<p>
ajouter une adresse mail &#039;project@domain.tld&#039; pour #Public
</p>
<pre class="code">insert into dbmail_aliases ( alias, deliver_to, client_idnr ) value ( &#039;project@domain.tld&#039;, &#039;3&#039;, &#039;0&#039; )</pre>

<p>
<a href="http://doc.ubuntu-fr.org/_media/dbmail/dbmail/dbmail-partage-public.png" class="media" title="dbmail:dbmail:dbmail-partage-public.png"><img src="http://doc.ubuntu-fr.org/_media/dbmail/dbmail/dbmail-partage-public.png?w=700&amp;tok=73b5d5" class="medialeft" alt="" width="700" /></a>
</p>

</div>
<div class='secedit editbutton_section editbutton_27'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[#Public] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="39273-39860" /><input type="submit" value="Modifier" class="button" title="#Public" /></div></form></div>
<h2 class="sectionedit28" id="mailman">Mailman</h2>
<div class="level2">

</div>
<div class='secedit editbutton_section editbutton_28'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[Mailman] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="39861-39880" /><input type="submit" value="Modifier" class="button" title="Mailman" /></div></form></div>
<h3 class="sectionedit29" id="ajouter_les_recipients">Ajouter les Recipients</h3>
<div class="level3">

<p>
C&#039;est l&#039;équivalence de virtual-aliases pour d&#039;autres serveurs imap. Il n&#039;y a pas besoin également de rajouter des aliases dans /etc/aliases. Les récipients des listes se trouvent dans la table dbmail_aliases 
</p>

<p>
sudo nano dbmail-add-list
</p>
<pre class="code">#!/bin/bash
#14/07/2012
# sudo bash dbmail-addl-list &lt;list_name&gt;
#DOMAINNAME est le domaine de messagerie

if [ &quot;x$1&quot; == &quot;x&quot; ]; then
echo &quot;No maillist specified&quot;
echo &quot;Usage: dbmail-add-list &lt;list_name&gt;&quot;
exit 1
fi

DOMAINNAME=&quot;@list.domain.tld&quot;
#DOMAINNAME=&quot;@domain.tld&quot; si vous n&#039;avez pas beaucoup de listes.

MAILLIST=$1

echo &quot;dbmail-users -x $MAILLIST$DOMAINNAME -t \&quot;|/usr/lib/mailman/mail/mailman post $MAILLIST\&quot;&quot;
dbmail-users -x $MAILLIST$DOMAINNAME -t &quot;|/usr/lib/mailman/mail/mailman post $MAILLIST&quot;

for i in admin bounces confirm join leave owner request subscribe unsubscribe;
do
echo &quot;dbmail-users -x $MAILLIST-$i$DOMAINNAME -t \&quot;|/usr/lib/mailman/mail/mailman $i $MAILLIST\&quot;&quot;
dbmail-users -x $MAILLIST-$i$DOMAINNAME -t &quot;|/usr/lib/mailman/mail/mailman $i $MAILLIST&quot;
done </pre>

</div>

<h4 id="exemple_pour_la_liste_pub">exemple pour la liste &quot;pub&quot;</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> Création<pre class="code">sudo newlist pub</pre>
</div>
</li>
<li class="level1"><div class="li"> Ajouter les Récipients</div>
</li>
</ul>

<p>
sudo bash /home/…/dbmail-add-list pub
</p>
<pre class="code">dbmail-users -x pub@list.domain.tld -t &quot;|/usr/lib/mailman/mail/mailman post pub&quot;
[|/usr/lib/mailman/mail/mailman post pub]
Done
dbmail-users -x pub-admin@list.domain.tld -t &quot;|/usr/lib/mailman/mail/mailman admin pub&quot;
[|/usr/lib/mailman/mail/mailman admin pub]
Done
...
.......
dbmail-users -x pub-subscribe@list.domain.tld -t &quot;|/usr/lib/mailman/mail/mailman subscribe pub&quot;
[|/usr/lib/mailman/mail/mailman subscribe pub]
Done
dbmail-users -x pub-unsubscribe@list.domain.tld -t &quot;|/usr/lib/mailman/mail/mailman unsubscribe pub&quot;
[|/usr/lib/mailman/mail/mailman unsubscribe pub]
Done</pre>
<ul>
<li class="level1"><div class="li"> Lister les listes</div>
</li>
</ul>
<pre class="code">sudo list_lists 
  2 listes correspondantes trouvées 
     Mailman 
      Pub </pre>
<ul>
<li class="level1"><div class="li">  Supprimer une liste</div>
</li>
</ul>
<pre class="code">sudo rmlist pub </pre>

</div>
<div class='secedit editbutton_section editbutton_29'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[Ajouter les Recipients] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="39881-41867" /><input type="submit" value="Modifier" class="button" title="Ajouter les Recipients" /></div></form></div>
<h3 class="sectionedit30" id="annexe_mailman">Annexe mailman</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> master.cf</div>
</li>
</ul>
<pre class="code">mailman unix  -       n       n       -       -       pipe
      flags=FR user=list:list 
      argv=/var/lib/mailman/bin/postfix-to-mailman.py ${nexthop} ${user}</pre>
<ul>
<li class="level1"><div class="li"> transport_maps</div>
</li>
</ul>
<pre class="code">list.domain.tld	   mailman:</pre>
<ul>
<li class="level1"><div class="li"> check permissions</div>
</li>
</ul>
<pre class="code">sudo check_perms;  sudo check_perms -f  # pour fixer les problèmes</pre>
<ul>
<li class="level1"><div class="li"> Problème éventuel de Redirection  entre la web_page_url de la liste et et du hostname (<abbr title="Graphical User Interface">GUI</abbr> MAILMAN &amp; Apache)</div>
</li>
</ul>
<pre class="code">sudo withlist -l -a -r fix_url </pre>

<p>
<a href="http://wiki.list.org/display/DOC/4.27+Securing+Mailman%27s+web+GUI+by+using+Secure+HTTP-SSL" class="urlextern" title="http://wiki.list.org/display/DOC/4.27+Securing+Mailman%27s+web+GUI+by+using+Secure+HTTP-SSL"  rel="nofollow">source</a>
</p>

</div>
<div class='secedit editbutton_section editbutton_30'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[Annexe mailman] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="41868-42517" /><input type="submit" value="Modifier" class="button" title="Annexe mailman" /></div></form></div>
<h2 class="sectionedit31" id="web-based_dbmailadmin">Web-based DbmailAdmin</h2>
<div class="level2">

<p>
 Les interfaces graphiques à base de LAMP ou équivalent, pas obligatoires pour manager son dbmail.
</p>
<ol>
<li class="level1"><div class="li"> <a href="http://code.google.com/p/simple-dbmail-admin/" class="urlextern" title="http://code.google.com/p/simple-dbmail-admin/"  rel="nofollow">Simple-dbmail-admin </a> nouveau projet 06/2012</div>
</li>
<li class="level1"><div class="li"> <a href="http://dbmailadmin.org/" class="urlextern" title="http://dbmailadmin.org/"  rel="nofollow">Web DbmailAdmin </a></div>
</li>
</ol>

</div>
<div class='secedit editbutton_section editbutton_31'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[Web-based DbmailAdmin] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="42518-42800" /><input type="submit" value="Modifier" class="button" title="Web-based DbmailAdmin" /></div></form></div>
<h2 class="sectionedit32" id="pare-feu">Pare-feu</h2>
<div class="level2">

<p>
Ne pas oublier d&#039;ouvrir les ports du pare-feu
</p>

<p>
Exemple avec shorewall : 
</p>
<pre class="code">sudo vim /etc/shorewall/rules
IMAP/ACCEPT          net             $FW
SMTP/ACCEPT          net             $FW</pre>

<p>
redémarrage du pare-feu
</p>
<pre class="code">sudo /etc/init.d/shorewall restart</pre>

</div>
<div class='secedit editbutton_section editbutton_32'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[Pare-feu] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="42801-43075" /><input type="submit" value="Modifier" class="button" title="Pare-feu" /></div></form></div>
<h2 class="sectionedit33" id="auth_basic_apache_sasl_smtp">Auth Basic Apache SASL SMTP</h2>
<div class="level2">

<p>
Juste un extra de configuration, qui exploite le SASL pour une authentification basique, sur une page http, grace au module libapache2-mod-authn-sasl, qui supporte seulement le sasldb
</p>
<ul>
<li class="level1"><div class="li"> Ajouter sasldb à MECHANISMS dans le /etc/default/saslauthd</div>
</li>
</ul>
<pre class="code">MECHANISMS=&quot;rimap sasldb&quot;</pre>

<p>
/etc/postfix/sasl/smtpd.conf
</p>
<pre class="code">pwcheck_method: auxprop saslauthd 
mech_list: CRAM-MD5 PLAIN LOGIN
saslauthd_path: /var/spool/postfix/var/run/saslauthd/mux
sasldb_path: /var/spool/postfix/var/run/saslauthd/sasldb
auxprop_plugin: sql sasldb
log_level: 7
sql_engine: mysql
sql_hostnames: 127.0.0.1
sql_user: dbmail
sql_passwd: pass
sql_database: databasename
sql_verbose: yes
sql_select: SELECT passwd FROM dbmail_users WHERE userid=&#039;%u@%r&#039; </pre>
<ul>
<li class="level1"><div class="li"> Virtualhost apache</div>
</li>
</ul>
<pre class="code">#requis saslauthd + sasldb

Alias /example1  &quot;/...&quot;
&lt;Directory &quot;/...&quot;&gt;
...
        AuthType Basic
        AuthName &quot;Restricted to Staff users&quot;
        AuthBasicProvider sasl
        AuthBasicAuthoritative On
        AuthSaslPwcheckMethod sasldb
        AuthSaslRealm domain.tld
        AuthSaslDbPath /var/spool/postfix/var/run/saslauthd/sasldb
        AuthSaslServiceName smtp
        Require user toto@domain.tld  
&lt;/Directory&gt;</pre>
<pre class="code">sudo ln -s /etc/sasldb /var/spool/postfix/var/run/saslauthd/sasldb
#creation de toto@domain.tld
sudo saslpasswd2  -f /etc/sasldb2 toto@domain.tld
#listing de la database
sudo sasldblistusers2 -f /etc/sasldb</pre>

<p>
login: toto@domain.tld ; mot-de-passe: totopass ; url http:../exemple1
</p>

</div>
<div class='secedit editbutton_section editbutton_33'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[Auth Basic Apache SASL SMTP] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="43076-44619" /><input type="submit" value="Modifier" class="button" title="Auth Basic Apache SASL SMTP" /></div></form></div>
<h2 class="sectionedit34" id="auth_digest_apache_dbmail_users">Auth Digest Apache dbmail_users</h2>
<div class="level2">

<p>
Dans l&#039;exemple ci-dessous, le SASL n&#039;est pas utilisé. Une requête sql est directement invoquée pour dbmail_users, permettant une authentification <em>Digest</em> http. 
</p>

<p>
Virtualhost avec mod_auth_digest, mod_dbd
</p>
<pre class="code">DBDriver mysql
DBDParams &quot;host=127.0.0.1 port=3306 dbname=dbmail3 user=dbmail3 pass=motdepasse&quot;
DBDMin  1
DBDKeep 2
DBDMax  3
DBDExptime 240

Alias /example2 &quot;/...&quot;
&lt;Directory &quot;/...&quot;&gt;
   Options Indexes FollowSymLinks Multiviews
   AllowOverride None
   Order allow,deny
   Allow from all
AuthType Digest
AuthDigestAlgorithm MD5
AuthName &quot;hello&quot;
AuthDigestProvider dbd
Require valid-user
# passwd a été stocké en plaintext
AuthDBDUserRealmQuery &quot;SELECT md5(concat(userid,&#039;:hello:&#039;,passwd)) from dbmail3.dbmail_users WHERE userid = %s&quot;
&lt;/Directory&gt;</pre>

</div>
<div class='secedit editbutton_section editbutton_34'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[Auth Digest Apache dbmail_users] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="44620-45441" /><input type="submit" value="Modifier" class="button" title="Auth Digest Apache dbmail_users" /></div></form></div>
<h2 class="sectionedit35" id="voir_aussi">Voir aussi</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <strong>(en)</strong> <a href="http://www.dbmail.org/dokuwiki/doku.php/setup_postfix/" class="urlextern" title="http://www.dbmail.org/dokuwiki/doku.php/setup_postfix/"  rel="nofollow">le tutoriel officiel de DBMail</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://dbmail.org/dokuwiki/doku.php" class="urlextern" title="http://dbmail.org/dokuwiki/doku.php"  rel="nofollow">Wiki dbmail</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://www.mail-archive.com/dbmail%40dbmail.org/" class="urlextern" title="http://www.mail-archive.com/dbmail%40dbmail.org/"  rel="nofollow">Archive 1 Dbmail </a></div>
</li>
<li class="level1"><div class="li"> <a href="http://www.gossamer-threads.com/lists/dbmail/users/" class="urlextern" title="http://www.gossamer-threads.com/lists/dbmail/users/"  rel="nofollow">Archive 2 Dbmail</a></div>
</li>
</ul>

<p>
—-
</p>

<p>
<em>Contributeurs : <a href="http://doc.ubuntu-fr.org/utilisateurs/flavea" class="wikilink2" title="utilisateurs:flavea" rel="nofollow">Flavea</a>. Titouan</em>
</p>

</div>
<div class='secedit editbutton_section editbutton_35'><form class="button btn_secedit" method="post" action="dbmail"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1403957678" /><input type="hidden" name="summary" value="[Voir aussi] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="45442-" /><input type="submit" value="Modifier" class="button" title="Voir aussi" /></div></form></div>
<!-- cachefile /srv/www/doc.ubuntu-fr.org/htdocs/data/cache/7/70ac2e8ebd810b175787cfacb3c92391.xhtml used -->

        <br style="clear:both;" />
        <div id="pageinfo">
            <!--  |  | -->
            <!-- ?tpl_pageinfo()? -->
            <br />
            Le contenu de ce wiki est sous licence : <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" rel="license" target="_blank">CC BY-SA v3.0</a>
        </div> 
      </div>

      
      <div id="navigation">

        <ul>
          <li class="menu"><a href="http://www.ubuntu-fr.org" class="title" id="menu-accueil"><span>Accueil</span></a></li>
          <li class="menu" id="active">
            <a href="index.html"  class="title" id="menu-doc"><span>Documentation</span></a>
            <ul>
              <li id="navWiki" class="cat">
                <h2>Actions</h2>
                <ul>
                  <li><a href="http://doc.ubuntu-fr.org/dbmail?do=index"  class="action index" accesskey="x" rel="nofollow" title="Plan du site [X]">Plan du site</a></li>
                  <li><a href="http://doc.ubuntu-fr.org/dbmail?do=edit&amp;rev=0"  class="action edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]">Modifier cette page</a></li>
                  <li><a href="http://doc.ubuntu-fr.org/dbmail?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]">Anciennes révisions</a></li>
                  <li></li>
                  <li><a href="http://doc.ubuntu-fr.org/dbmail?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Derniers changements [R]">Derniers changements</a></li>
                  <li><a href="http://doc.ubuntu-fr.org/dbmail?do=backlink"  class="action backlink" rel="nofollow" title="Liens vers cette page">Liens vers cette page</a></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </li>
              <li id="navDivers" class="cat">
                <h2>Divers</h2>
                <ul>
                  <li><bdi><a href="wiki/participer_wiki" class="wikilink1" title="wiki:participer_wiki">Participer à la documentation</a></bdi></li>
                  <li><bdi><a href="documentation_hors_ligne" class="wikilink1" title="documentation_hors_ligne">Documentation hors ligne</a></bdi></li>
                  <li><a href="http://www.ubuntu-fr.org/telechargement" title="T&eacute;l&eacute;charger Ubuntu">T&eacute;l&eacute;charger Ubuntu</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li class="menu"><a href="http://forum.ubuntu-fr.org"  class="title" id="menu-forum"><span>Forum</span></a></li>
          <li class="menu"><a href="http://planet.ubuntu-fr.org"  class="title" id="menu-planet"><span>Planet</span></a></li>
        </ul>

      </div>
      <div id="references-ufr">
        <ul id="legal-ufr">
          <li><a href="http://www.ubuntu-fr.org/contacts">Contact</a></li>
        </ul>

        <ul id="sponsors-ufr">
          <li><a href="http://www.dokuwiki.org/dokuwiki" id="dokuwiki">Propulsé par Dokuwiki</a></li>
        </ul>
      </div>

    </div>
    <!-- $Id$ -->

    <!-- Piwik Image Tracker -->
    <!-- img src="http://piwik.infra.ubuntu-fr.org/piwik.php?idsite=2&amp;rec=1" style="border:0" alt="" /-->
    <!-- End Piwik -->

  </body>
</html>
