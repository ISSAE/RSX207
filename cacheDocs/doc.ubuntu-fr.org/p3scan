<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr" dir="ltr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Script-Type" content="text/javascript"/>
    <meta http-equiv="Content-Style-Type" content="text/css"/>
    <meta http-equiv="Content-Language" content="fr"/>
    <title>p3scan - Documentation Ubuntu Francophone</title>
    <meta name="Description" content="Documentation francophone pour la distribution Ubuntu" lang="fr" />
    <meta name="language" content="fr-FR" />

    <!--[if IE 8]>
    <meta http-equiv="X-UA-Compatible" content="IE=8" />
    <![endif]-->
        <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2010-02-06T23:55:49+0100"/>
<meta name="keywords" content="feisty,antivirus,brouillon"/>
<link rel="search" type="application/opensearchdescription+xml" href="lib/exe/opensearch.php" title="Documentation Ubuntu Francophone"/>
<link rel="start" href="index.html"/>
<link rel="contents" href="http://doc.ubuntu-fr.org/p3scan?do=index" title="Plan du site"/>
<link rel="alternate" type="application/rss+xml" title="Derniers changements" href="feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Namespace actuel" href="feed.php?mode=list&amp;ns="/>
<link rel="edit" title="Modifier cette page" href="http://doc.ubuntu-fr.org/p3scan?do=edit"/>
<link rel="alternate" type="text/html" title="HTML brut" href="http://doc.ubuntu-fr.org/_export/xhtml/p3scan"/>
<link rel="alternate" type="text/plain" title="Wiki balise" href="http://doc.ubuntu-fr.org/_export/raw/p3scan"/>
<link rel="canonical" href="p3scan"/>
<link rel="stylesheet" type="text/css" href="lib/exe/css.php?t=ubuntu-2010&amp;tseed=4af22dedc19f28c99fa67afabbb173df"/>
<script type="text/javascript">/*<![CDATA[*/var NS='';var JSINFO = {"id":"p3scan","namespace":""};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="lib/exe/js.php?tseed=4af22dedc19f28c99fa67afabbb173df"></script>
    <link rel="shortcut icon" href="http://www-static.ubuntu-fr.org/theme2010/images/commun/ubuntu/icone.png" type="image/x-icon" />
    <link rel="apple-touch-icon" href="http://www-static.ubuntu-fr.org/theme2010/images/commun/ubuntu/touch-ico.png" />

    <link rel="stylesheet" media="screen" type="text/css" title="Design Ubuntu-fr" href="http://www-static.ubuntu-fr.org/theme2010/css/doc.css" />
    <link rel="stylesheet" media="screen" type="text/css" title="Design Ubuntu-fr" href="http://www-static.ubuntu-fr.org/theme2010/css/doc-ubuntu.css" />
    <link rel="stylesheet" media="print" type="text/css" title="Design Ubuntu-fr" href="http://www-static.ubuntu-fr.org/theme2010/css/doc-print.css" />

    <script type="text/javascript">
      var menu_hidden;
      var static_url = "UFR_STATIC";
    </script>
    <script src="http://www-static.ubuntu-fr.org/theme2010/js/menu.js" type="text/javascript"></script>
    <script src="http://www-static.ubuntu-fr.org/theme2010/js/common.js" type="text/javascript"></script>
  </head>
  <body>

    <div id="accessibar">
      <a href="p3scan#main" tabindex="1">Contenu</a> | <a href="p3scan#qsearch__in" tabindex="2">Rechercher</a> | <a href="p3scan#navigation" tabindex="3">Menus</a>
    </div>

    <div id="page">

      <div id="header">

        <div id="logo">
          <h1>Ubuntu-fr</h1>
          <a href="index.html" title="Accueil de la documentation">Communauté francophone d'utilisateurs d'Ubuntu</a>
        </div>

        <form action="http://ubuntu-fr.org/recherche" accept-charset="utf-8" id="search" onsubmit="if (document.getElementById('qsearch__in').value == 'Recherche rapide....') {document.getElementById('qsearch__in').value = '';}">
          <fieldset>
            <label for="qsearch__in">Recherche : </label><input type="text" value="Recherche rapide...." id="qsearch__in" accesskey="f" name="sk_q" alt="[F]" size="34" tabindex="4" />
            <label for="tsearch_field">Chercher dans : </label><select name="sk_engine" tabindex="5" id="tsearch_field" title="Chercher dans">
              <option value="all">Site</option>
              <option selected="selected" value="doc">Documentation</option>
              <option value="forum">Forum</option>
              <option value="planet">Planet</option>
            </select>
            <input type="submit" value="ok" class="button" alt="Lancer la recherche" tabindex="5" />
          </fieldset>
        </form>
        <!--[if lte IE 7]><div class="clear"></div><![endif]-->

        <form action="p3scan" accept-charset="utf-8" id="login_top" method="post">
          <fieldset>
            <label for="u_field">Identifiant : </label><input type="text" value="Identifiant" name="u" id="u_field" size="9" /><label for="p_field">Mot de passe : </label><input type="password" value="Mot de passe" name="p" id="p_field" size="9" alt="Mot de passe" /><input type="submit" value="connexion" id="connect" /> / <a href="http://forum.ubuntu-fr.org/register.php">inscription</a>
          </fieldset>
        </form>
 

      </div>

      <div id="navbar">
          <h2 id="pagetitle"><a href="p3scan" >p3scan</a></h2>
      </div>

      
      <div id="main" class="dokuwiki">

        <div id="hidemenu" title="Masquer le menu"></div>

        <div id="pagerror"></div>
                <div class="notetag">Selon les <a href="tags">tags</a> présents sur cette page, celle-ci est ancienne et ne contient plus d'informations sur une des  <a href="versions">versions supportées d'Ubuntu</a>.<br />
Cette page est en cours de rédaction.<br />
<a href="wiki/participer_wiki">Apportez votre aide…</a>
</div>
<!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table des matières</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="p3scan#interet">Intérêt ?</a></div></li>
<li class="level1"><div class="li"><a href="p3scan#fonctionnement">Fonctionnement</a></div></li>
<li class="level1"><div class="li"><a href="p3scan#pre-requis">Pré-requis</a></div></li>
<li class="level1"><div class="li"><a href="p3scan#installer_un_antivirus">Installer un antivirus</a></div></li>
<li class="level1"><div class="li"><a href="p3scan#installer_un_p3scan">Installer un P3scan</a></div></li>
<li class="level1"><div class="li"><a href="p3scan#configuration_de_p3scan">Configuration de P3scan</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="p3scan#configuration_commune">Configuration commune</a></div></li>
<li class="level2"><div class="li"><a href="p3scan#exemple_avec_clamav">Exemple avec Clamav</a></div></li>
<li class="level2"><div class="li"><a href="p3scan#exemple_avec_clamav-daemon">Exemple avec Clamav-daemon</a></div></li>
<li class="level2"><div class="li"><a href="p3scan#exemple_pour_f-prot_antivirus">Exemple pour F-Prot Antivirus :</a></div></li>
<li class="level2"><div class="li"><a href="p3scan#exemple_de_filtrage_de_spam">Exemple de filtrage de spam</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="p3scan#configuration_du_pare-feu">Configuration du pare-feu</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="p3scan#avec_iptables">Avec Iptables</a></div></li>
<li class="level2"><div class="li"><a href="p3scan#avec_shorewall">Avec Shorewall</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="p3scan#test_de_fonctionnement">Test de fonctionnement</a></div></li>
<li class="level1"><div class="li"><a href="p3scan#ressources_externes">Ressources externes</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->
<div class="tags"><span>
	<a href="feisty" class="wikilink1" title="feisty" rel="tag">feisty</a>,
	<a href="antivirus" class="wikilink1" title="antivirus" rel="tag">antivirus</a>,
	<a href="brouillon" class="wikilink1" title="brouillon" rel="tag">brouillon</a>
</span></div>
<hr />

<h1 class="sectionedit1" id="p3scan">P3scan</h1>
<div class="level1">

<p>
P3scan permet de scanner a l&#039;aide d&#039;un antivirus les messages entrants 
d&#039;un client email. Il est en outre possible de l&#039;utiliser avec un client antispam <em>(tel spamassassin)</em>.
</p>

</div>
<div class='secedit editbutton_section editbutton_1'><form class="button btn_secedit" method="post" action="p3scan"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1265496949" /><input type="hidden" name="summary" value="[P3scan] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="43-243" /><input type="submit" value="Modifier" class="button" title="P3scan" /></div></form></div>
<h2 class="sectionedit2" id="interet">Intérêt ?</h2>
<div class="level2">

<p>
Si vous utilisez conjointement <a href="thunderbird" class="wikilink1" title="thunderbird">Thunderbird</a> sous Ubuntu et Windows, que vous ne voulez pas infecter d&#039;autres ordinateurs en renvoyant des messages reçus, ou tout simplement si vous êtes parano. De plus cela ne touche en rien votre configuration de client email et est valable pour tous les utilisateurs du système sans qu&#039;ils ne le sachent. C&#039;est pourquoi il peut être très utile pour un réseau domestique.
</p>

</div>
<div class='secedit editbutton_section editbutton_2'><form class="button btn_secedit" method="post" action="p3scan"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1265496949" /><input type="hidden" name="summary" value="[Intérêt ?] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="244-686" /><input type="submit" value="Modifier" class="button" title="Intérêt ?" /></div></form></div>
<h2 class="sectionedit3" id="fonctionnement">Fonctionnement</h2>
<div class="level2">

<p>
P3scan va s&#039;intercaler entre le client (<em>par exemple <a href="thunderbird" class="wikilink1" title="thunderbird">Thunderbird</a></em>) et le serveur (<em>par exemple pop.free.fr</em>). Il se fait passer du coté client pour le serveur et du coté serveur pour le client. Ainsi il peut traiter les mails  de manière transparente pour le serveur et le client (aucun des deux ne se rend compte qu&#039;il y a P3scan entre les deux). 
Explication simple :
</p>
<ul>
<li class="level1"><div class="li"> Le client demande au serveur les mails</div>
</li>
<li class="level1"><div class="li"> Grace au pare-feu, on renvoie tout ce qui rentre du port pop3 vers le port où attend p3scan.</div>
</li>
<li class="level1"><div class="li"> P3scan se fait alors passer d&#039;un coté pour le serveur et de l&#039;autre pour le client.</div>
</li>
<li class="level1"><div class="li"> Il sauvegarde dans un dossier sur votre disque les messages pour les traiter avec l&#039;antivirus.</div>
</li>
<li class="level1"><div class="li"> Si aucun message n&#039;est infecté alors il renvoie les messages au travers du port pop3 vers votre client.</div>
</li>
<li class="level1"><div class="li"> Si un message est infecté, il remplace le corps du message par un message d&#039;information et le renvoie.</div>
</li>
</ul>

</div>
<div class='secedit editbutton_section editbutton_3'><form class="button btn_secedit" method="post" action="p3scan"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1265496949" /><input type="hidden" name="summary" value="[Fonctionnement] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="687-1643" /><input type="submit" value="Modifier" class="button" title="Fonctionnement" /></div></form></div>
<h2 class="sectionedit4" id="pre-requis">Pré-requis</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Disposer des <a href="sudo" class="wikilink1" title="sudo">droits d&#039;administration</a> ;</div>
</li>
<li class="level1"><div class="li"> Disposer d&#039;une connexion à Internet configurée et activée :</div>
</li>
<li class="level1"><div class="li"> Avoir activé l&#039;accès aux <a href="depots#universe_et_multiverse" class="wikilink1" title="depots">dépôts Universe</a>.</div>
</li>
</ul>

</div>
<div class='secedit editbutton_section editbutton_4'><form class="button btn_secedit" method="post" action="p3scan"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1265496949" /><input type="hidden" name="summary" value="[Pré-requis] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="1644-1873" /><input type="submit" value="Modifier" class="button" title="Pré-requis" /></div></form></div>
<h2 class="sectionedit5" id="installer_un_antivirus">Installer un antivirus</h2>
<div class="level2">

<p>
<a href="clamav" class="wikilink1" title="clamav">Installer Clamav</a>.
<a href="http://doc.ubuntu-fr.org/_detail/icons/iconnote.png?id=p3scan" class="media" title="icons:iconnote.png"><img src="http://doc.ubuntu-fr.org/_media/icons/iconnote.png" class="medialeft" alt="" /></a>
</p>
<blockquote><div class="no">
D&#039;autres antivirus sont supportés par P3scan.</div></blockquote>

</div>
<div class='secedit editbutton_section editbutton_5'><form class="button btn_secedit" method="post" action="p3scan"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1265496949" /><input type="hidden" name="summary" value="[Installer un antivirus] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="1874-2012" /><input type="submit" value="Modifier" class="button" title="Installer un antivirus" /></div></form></div>
<h2 class="sectionedit6" id="installer_un_p3scan">Installer un P3scan</h2>
<div class="level2">

<p>
<a href="tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">Installez le paquet</a> <strong>p3scan</strong>. <br/>

</p>

</div>
<div class='secedit editbutton_section editbutton_6'><form class="button btn_secedit" method="post" action="p3scan"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1265496949" /><input type="hidden" name="summary" value="[Installer un P3scan] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="2013-2123" /><input type="submit" value="Modifier" class="button" title="Installer un P3scan" /></div></form></div>
<h2 class="sectionedit7" id="configuration_de_p3scan">Configuration de P3scan</h2>
<div class="level2">

<p>
<a href="tutoriel/comment_editer_un_fichier" class="wikilink1" title="tutoriel:comment_editer_un_fichier">éditer le fichier</a> /etc/p3scan/p3scan.conf.
</p>

</div>
<div class='secedit editbutton_section editbutton_7'><form class="button btn_secedit" method="post" action="p3scan"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1265496949" /><input type="hidden" name="summary" value="[Configuration de P3scan] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="2124-2249" /><input type="submit" value="Modifier" class="button" title="Configuration de P3scan" /></div></form></div>
<h3 class="sectionedit8" id="configuration_commune">Configuration commune</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> <strong>Explication simple du fichier de configuration :</strong></div>
</li>
</ul>
<div class="table sectionedit9"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0 centeralign" colspan="2">    Pour la configuration du réseau                                         </th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0 centeralign">  pidfile       </td><td class="col1 centeralign">  Endroit où inscrire le fichier indiquant le fonctionnement du programme      </td>
	</tr>
	<tr class="row2">
		<td class="col0 centeralign">  maxchilds     </td><td class="col1 centeralign">  Connexion maximum du programme (10 scans à la fois)               </td>
	</tr>
	<tr class="row3">
		<td class="col0 centeralign">  ip            </td><td class="col1 centeralign">  Adresse réseau sur laquelle attendre le mail                                  </td>
	</tr>
	<tr class="row4">
		<td class="col0 centeralign">  port          </td><td class="col1 centeralign">  Port où le mail doit arriver au programme                           </td>
	</tr>
	<tr class="row5">
		<th class="col0 centeralign" colspan="2">    Pour la configuration du  système                                           </th>
	</tr>
	<tr class="row6">
		<td class="col0 centeralign">  user        </td><td class="col1 centeralign">  Nom que le démon utilise pour travailler   (utile pour les   permissions)                            </td>
	</tr>
	<tr class="row7">
		<td class="col0 centeralign">  notifydir   </td><td class="col1 centeralign">  Répertoire où le programme inscrit les notifications et repertoire temporaire de travail                       </td>
	</tr>
	<tr class="row8">
		<td class="col0 centeralign">  virusdir    </td><td class="col1 centeralign">  Répertoire de sauvegarde des fichiers infectés         </td>
	</tr>
	<tr class="row9">
		<td class="col0 centeralign">  justdelete  </td><td class="col1 centeralign">  Effacement du fichier infecté sans sauvegarde          </td>
	</tr>
	<tr class="row10">
		<th class="col0 centeralign" colspan="2">    Pour la configuration de l&#039;antivirus                                      </th>
	</tr>
	<tr class="row11">
		<td class="col0 rightalign">  scannertype </td><td class="col1 centeralign">  Type de programme antivirus                            </td>
	</tr>
	<tr class="row12">
		<td class="col0 centeralign">  scanner     </td><td class="col1 centeralign">  Endroit où se situe l&#039;exécutable de l&#039;antivirus                              </td>
	</tr>
	<tr class="row13">
		<td class="col0 centeralign">  viruscode   </td><td class="col1 centeralign">  Expression du résultat du scan                                       </td>
	</tr>
	<tr class="row14">
		<td class="col0 rightalign">  virusregexp </td><td class="col1 centeralign">  Nom du virus à inclure dans la notification                                         </td>
	</tr>
	<tr class="row15">
		<td class="col0 centeralign">  demime      </td><td class="col1 centeralign">  Scanner en fonction du type de fichier (zip,jpg,…) et pas tel que recu par le client  </td>
	</tr>
	<tr class="row16">
		<th class="col0 centeralign" colspan="2">    Pour la configuration de l&#039;antispam                                        </th>
	</tr>
	<tr class="row17">
		<td class="col0 centeralign">  checkspam   </td><td class="col1 centeralign">  Vérifier le spam                                     </td>
	</tr>
	<tr class="row18">
		<td class="col0 centeralign">  spamcheck   </td><td class="col1 centeralign">  Endroit où se situe l&#039;exécutable de l&#039;antipsam                               </td>
	</tr>
	<tr class="row19">
		<th class="col0 centeralign" colspan="2">    Pour la configuration des notifications dans le mail                                  </th>
	</tr>
	<tr class="row20">
		<td class="col0 centeralign">  template    </td><td class="col1 centeralign">  Fichier à renvoyer à la place du fichier infecté       </td>
	</tr>
	<tr class="row21">
		<td class="col0 centeralign">  subject     </td><td class="col1 centeralign">  Sujet du message à la place du fichier infecté         </td>
	</tr>
	<tr class="row22">
		<td class="col0 centeralign">  notify      </td><td class="col1 centeralign">  Notification dans le message avec l&#039;option justdelete  </td>
	</tr>
</table></div>
<ul>
<li class="level1"><div class="li"> <strong>Exemple concret :</strong></div>
</li>
</ul>
<pre class="file">pidfile = /var/run/p3scan.pid
maxchilds = 10
ip = 0.0.0.0
port = 8110
user = p3scan
notifydir = /var/spool/p3scan/notify
virusdir = /var/spool/p3scan
justdelete
template = /etc/p3scan/p3scan-fr.mail
subject = [virus] dans un message pour vous:
notify = Pour information, le message a été détruit.</pre>

</div>
<div class='secedit editbutton_section editbutton_8'><form class="button btn_secedit" method="post" action="p3scan"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1265496949" /><input type="hidden" name="summary" value="[Configuration commune] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="2250-4904" /><input type="submit" value="Modifier" class="button" title="Configuration commune" /></div></form></div>
<h3 class="sectionedit10" id="exemple_avec_clamav">Exemple avec Clamav</h3>
<div class="level3">
<pre class="file">scannertype = basic
scanner = /usr/bin/clamscan --no-summary -i
virusregexp = .*: (.*) FOUND</pre>

</div>
<div class='secedit editbutton_section editbutton_10'><form class="button btn_secedit" method="post" action="p3scan"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1265496949" /><input type="hidden" name="summary" value="[Exemple avec Clamav] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="4905-5044" /><input type="submit" value="Modifier" class="button" title="Exemple avec Clamav" /></div></form></div>
<h3 class="sectionedit11" id="exemple_avec_clamav-daemon">Exemple avec Clamav-daemon</h3>
<div class="level3">

<p>
<a href="tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">Installez le paquet</a> <strong>clamav-daemon</strong>. <br/>

</p>
<pre class="file">scannertype = basic
scanner = /usr/bin/clamdscan --no-summary -i
virusregexp = .*: (.*) FOUND</pre>

<p>
Vous devez ajouter clamav au groupe p3scan pour pouvoir lire dans les fichiers temporaires de P3scan :
</p>
<pre class="code">sudo adduser clamav p3scan</pre>

<p>
<a href="http://doc.ubuntu-fr.org/_detail/icons/iconnote.png?id=p3scan" class="media" title="icons:iconnote.png"><img src="http://doc.ubuntu-fr.org/_media/icons/iconnote.png" class="medialeft" alt="" /></a>
</p>
<blockquote><div class="no">
Avec cette méthode, le scan des mails est légèrement plus rapide.</div></blockquote>

</div>
<div class='secedit editbutton_section editbutton_11'><form class="button btn_secedit" method="post" action="p3scan"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1265496949" /><input type="hidden" name="summary" value="[Exemple avec Clamav-daemon] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="5045-5517" /><input type="submit" value="Modifier" class="button" title="Exemple avec Clamav-daemon" /></div></form></div>
<h3 class="sectionedit12" id="exemple_pour_f-prot_antivirus">Exemple pour F-Prot Antivirus :</h3>
<div class="level3">
<pre class="file">scannertype = basic
scanner = /usr/bin/f-prot -archive -ai
viruscode = 3,8
virusregexp = (?=Infection\:)[[:space:]]*(.*)$
demime</pre>

</div>
<div class='secedit editbutton_section editbutton_12'><form class="button btn_secedit" method="post" action="p3scan"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1265496949" /><input type="hidden" name="summary" value="[Exemple pour F-Prot Antivirus :] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="5518-5706" /><input type="submit" value="Modifier" class="button" title="Exemple pour F-Prot Antivirus :" /></div></form></div>
<h3 class="sectionedit13" id="exemple_de_filtrage_de_spam">Exemple de filtrage de spam</h3>
<div class="level3">
<pre class="file">checkspam
spamcheck = /usr/bin/spamc     ## avec le démon spamassassin</pre>

<p>
<a href="http://doc.ubuntu-fr.org/_detail/icons/iconnote.png?id=p3scan" class="media" title="icons:iconnote.png"><img src="http://doc.ubuntu-fr.org/_media/icons/iconnote.png" class="medialeft" alt="" /></a>
</p>
<blockquote><div class="no">
<strong>Le fichier de configuration est bien détaillé, d&#039;autres exemples sont indiqués</strong>.</div></blockquote>

</div>
<div class='secedit editbutton_section editbutton_13'><form class="button btn_secedit" method="post" action="p3scan"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1265496949" /><input type="hidden" name="summary" value="[Exemple de filtrage de spam] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="5707-5954" /><input type="submit" value="Modifier" class="button" title="Exemple de filtrage de spam" /></div></form></div>
<h2 class="sectionedit14" id="configuration_du_pare-feu">Configuration du pare-feu</h2>
<div class="level2">

<p>
<em>Pour de plus amples informations sur le pare feu par défaut, je vous renvoie sur la page <a href="iptables" class="wikilink1" title="iptables">iptables</a></em>
</p>
<blockquote><div class="no">
<strong>Pour que p3scan puisse fonctionner, il faut rediriger les mails entrants sur le port 110 <em>(port par défaut)</em> vers le port ou p3scan attend.</strong></div></blockquote>

<p>
Ça c&#039;est très bien mais comment fait-on ? Ma messagerie ne fonctionne plus maintenant!!!!!!!!!!!
</p>

</div>
<div class='secedit editbutton_section editbutton_14'><form class="button btn_secedit" method="post" action="p3scan"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1265496949" /><input type="hidden" name="summary" value="[Configuration du pare-feu] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="5955-6358" /><input type="submit" value="Modifier" class="button" title="Configuration du pare-feu" /></div></form></div>
<h3 class="sectionedit15" id="avec_iptables">Avec Iptables</h3>
<div class="level3">
<pre class="code">sudo iptables -t nat -A OUTPUT  -p tcp --dport pop3 -m owner --uid-owner &lt;UID&gt; -j ACCEPT
sudo iptables -t nat -A OUTPUT  -p tcp --dport pop3 -j REDIRECT --to 8110</pre>

<p>
En mettant l&#039;UID que votre système a attribué à P3scan, pour l&#039;obtenir :
</p>
<pre class="code">sudo id p3scan</pre>

<p>
<br/>

Pour ceux qui utiliseraient encore <em>Firestarter</em>, pour la persistance des règles, il suffit de copier les 2 règles iptables dans le fichier user-pre de <em>Firestarter</em>. Faites au préalable les tests à l&#039;aide de <em>telnet</em> décrit plus bas. 
</p>
<pre class="code">sudo vi /etc/firestarter/user-pre</pre>

<p>
Pour obtenir le contenu suivant :<br/>

iptables -t nat -A OUTPUT  -p tcp –dport pop3 -m owner –uid-owner &lt;UID&gt; -j ACCEPT<br/>

iptables -t nat -A OUTPUT  -p tcp –dport pop3 -j REDIRECT –to 8110
</p>

</div>
<div class='secedit editbutton_section editbutton_15'><form class="button btn_secedit" method="post" action="p3scan"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1265496949" /><input type="hidden" name="summary" value="[Avec Iptables] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="6359-7160" /><input type="submit" value="Modifier" class="button" title="Avec Iptables" /></div></form></div>
<h3 class="sectionedit16" id="avec_shorewall">Avec Shorewall</h3>
<div class="level3">

<p>
<em><a href="shorewall" class="wikilink1" title="shorewall">Shorewall</a> est un pare-feu basé sur <a href="iptables" class="wikilink1" title="iptables">iptables</a> , seul la manière de le paramétrer diffère.</em>  <br/>

</p>

<p>
<a href="tutoriel/comment_editer_un_fichier" class="wikilink1" title="tutoriel:comment_editer_un_fichier">éditer le fichier</a> /etc/shorewall/rules :
</p>
<pre class="code">REDIRECT fw 8110 tcp pop3 - - - !p3scan</pre>

</div>
<div class='secedit editbutton_section editbutton_16'><form class="button btn_secedit" method="post" action="p3scan"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1265496949" /><input type="hidden" name="summary" value="[Avec Shorewall] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="7161-7440" /><input type="submit" value="Modifier" class="button" title="Avec Shorewall" /></div></form></div>
<h2 class="sectionedit17" id="test_de_fonctionnement">Test de fonctionnement</h2>
<div class="level2">

<p>
<em>Pour cela on va utiliser une <a href="http://doc.ubuntu-fr.org/console/commandes_de_base" class="wikilink2" title="console:commandes_de_base" rel="nofollow">console</a> telnet qui est un protocole de communication entre internet et son ordinateur dépourvu d&#039;interface graphique.</em>
</p>
<ol>
<li class="level1"><div class="li"> On demande une connexion telnet au serveur de messagerie sur le port 110 </div>
</li>
<li class="level1"><div class="li"> On indique son login et son mot de passe.</div>
</li>
<li class="level1"><div class="li"> On recherche ses message.</div>
</li>
<li class="level1"><div class="li"> On télécharge le premier message.</div>
</li>
</ol>
<pre class="code">telnet pop.votrefournisseur.fr 110
user votrelogindemessagerie
pass votremotdepassedemessagerie
list
retr 1</pre>

<p>
Si tous se passe bien vous devriez avoir en reponse quelque chose comme :
</p>
<pre class="code">retr 1
+OK P3Scan&#039;ing...</pre>

<p>
pour quitter : 
</p>
<pre class="code">quit</pre>

</div>
<div class='secedit editbutton_section editbutton_17'><form class="button btn_secedit" method="post" action="p3scan"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1265496949" /><input type="hidden" name="summary" value="[Test de fonctionnement] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="7441-8127" /><input type="submit" value="Modifier" class="button" title="Test de fonctionnement" /></div></form></div>
<h2 class="sectionedit18" id="ressources_externes">Ressources externes</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="http://p3scan.sourceforge.net/" class="urlextern" title="http://p3scan.sourceforge.net/"  rel="nofollow">Site officiel de P3scan</a>.</div>
</li>
<li class="level1"><div class="li"> <a href="http://irp.nain-t.net/doku.php/100iproute:040_le_proxy" class="urlextern" title="http://irp.nain-t.net/doku.php/100iproute:040_le_proxy"  rel="nofollow">http://irp.nain-t.net/doku.php/100iproute:040_le_proxy</a>.</div>
</li>
</ul>
<hr />

<p>
<em>Contributeurs : <a href="http://doc.ubuntu-fr.org/utilisateurs/coolaman" class="wikilink2" title="utilisateurs:coolaman" rel="nofollow">coolaman</a></em>
</p>

</div>
<div class='secedit editbutton_section editbutton_18'><form class="button btn_secedit" method="post" action="p3scan"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1265496949" /><input type="hidden" name="summary" value="[Ressources externes] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="8128-" /><input type="submit" value="Modifier" class="button" title="Ressources externes" /></div></form></div>
<!-- cachefile /srv/www/doc.ubuntu-fr.org/htdocs/data/cache/e/e50f2c6d65b65c85f82cd761add90430.xhtml used -->

        <br style="clear:both;" />
        <div id="pageinfo">
            <!--  |  | -->
            <!-- ?tpl_pageinfo()? -->
            <br />
            Le contenu de ce wiki est sous licence : <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" rel="license" target="_blank">CC BY-SA v3.0</a>
        </div> 
      </div>

      
      <div id="navigation">

        <ul>
          <li class="menu"><a href="http://www.ubuntu-fr.org" class="title" id="menu-accueil"><span>Accueil</span></a></li>
          <li class="menu" id="active">
            <a href="index.html"  class="title" id="menu-doc"><span>Documentation</span></a>
            <ul>
              <li id="navWiki" class="cat">
                <h2>Actions</h2>
                <ul>
                  <li><a href="http://doc.ubuntu-fr.org/p3scan?do=index"  class="action index" accesskey="x" rel="nofollow" title="Plan du site [X]">Plan du site</a></li>
                  <li><a href="http://doc.ubuntu-fr.org/p3scan?do=edit&amp;rev=0"  class="action edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]">Modifier cette page</a></li>
                  <li><a href="http://doc.ubuntu-fr.org/p3scan?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]">Anciennes révisions</a></li>
                  <li></li>
                  <li><a href="http://doc.ubuntu-fr.org/p3scan?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Derniers changements [R]">Derniers changements</a></li>
                  <li><a href="http://doc.ubuntu-fr.org/p3scan?do=backlink"  class="action backlink" rel="nofollow" title="Liens vers cette page">Liens vers cette page</a></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </li>
              <li id="navDivers" class="cat">
                <h2>Divers</h2>
                <ul>
                  <li><bdi><a href="wiki/participer_wiki" class="wikilink1" title="wiki:participer_wiki">Participer à la documentation</a></bdi></li>
                  <li><bdi><a href="documentation_hors_ligne" class="wikilink1" title="documentation_hors_ligne">Documentation hors ligne</a></bdi></li>
                  <li><a href="http://www.ubuntu-fr.org/telechargement" title="T&eacute;l&eacute;charger Ubuntu">T&eacute;l&eacute;charger Ubuntu</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li class="menu"><a href="http://forum.ubuntu-fr.org"  class="title" id="menu-forum"><span>Forum</span></a></li>
          <li class="menu"><a href="http://planet.ubuntu-fr.org"  class="title" id="menu-planet"><span>Planet</span></a></li>
        </ul>

      </div>
      <div id="references-ufr">
        <ul id="legal-ufr">
          <li><a href="http://www.ubuntu-fr.org/contacts">Contact</a></li>
        </ul>

        <ul id="sponsors-ufr">
          <li><a href="http://www.dokuwiki.org/dokuwiki" id="dokuwiki">Propulsé par Dokuwiki</a></li>
        </ul>
      </div>

    </div>
    <!-- $Id$ -->

    <!-- Piwik Image Tracker -->
    <!-- img src="http://piwik.infra.ubuntu-fr.org/piwik.php?idsite=2&amp;rec=1" style="border:0" alt="" /-->
    <!-- End Piwik -->

  </body>
</html>
