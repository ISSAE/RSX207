<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr" dir="ltr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Script-Type" content="text/javascript"/>
    <meta http-equiv="Content-Style-Type" content="text/css"/>
    <meta http-equiv="Content-Language" content="fr"/>
    <title>utilisateurs:lmrv:openldap - Documentation Ubuntu Francophone</title>
    <meta name="Description" content="Documentation francophone pour la distribution Ubuntu" lang="fr" />
    <meta name="language" content="fr-FR" />

    <!--[if IE 8]>
    <meta http-equiv="X-UA-Compatible" content="IE=8" />
    <![endif]-->
        <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2012-09-08T08:30:52+0200"/>
<meta name="keywords" content="lucid,oneiric,reseau,brouillon"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../lib/exe/opensearch.php" title="Documentation Ubuntu Francophone"/>
<link rel="start" href="../../index.html"/>
<link rel="contents" href="http://doc.ubuntu-fr.org/utilisateurs/lmrv/openldap?do=index" title="Plan du site"/>
<link rel="alternate" type="application/rss+xml" title="Derniers changements" href="../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Namespace actuel" href="http://doc.ubuntu-fr.org/feed.php?mode=list&amp;ns=utilisateurs:lmrv"/>
<link rel="alternate" type="text/html" title="HTML brut" href="http://doc.ubuntu-fr.org/_export/xhtml/utilisateurs/lmrv/openldap"/>
<link rel="alternate" type="text/plain" title="Wiki balise" href="http://doc.ubuntu-fr.org/_export/raw/utilisateurs/lmrv/openldap"/>
<link rel="canonical" href="openldap"/>
<link rel="stylesheet" type="text/css" href="../../lib/exe/css.php?t=ubuntu-2010&amp;tseed=4af22dedc19f28c99fa67afabbb173df"/>
<script type="text/javascript">/*<![CDATA[*/var NS='utilisateurs:lmrv';var JSINFO = {"id":"utilisateurs:lmrv:openldap","namespace":"utilisateurs:lmrv"};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../lib/exe/js.php?tseed=4af22dedc19f28c99fa67afabbb173df"></script>
    <link rel="shortcut icon" href="http://www-static.ubuntu-fr.org/theme2010/images/commun/ubuntu/icone.png" type="image/x-icon" />
    <link rel="apple-touch-icon" href="http://www-static.ubuntu-fr.org/theme2010/images/commun/ubuntu/touch-ico.png" />

    <link rel="stylesheet" media="screen" type="text/css" title="Design Ubuntu-fr" href="http://www-static.ubuntu-fr.org/theme2010/css/doc.css" />
    <link rel="stylesheet" media="screen" type="text/css" title="Design Ubuntu-fr" href="http://www-static.ubuntu-fr.org/theme2010/css/doc-ubuntu.css" />
    <link rel="stylesheet" media="print" type="text/css" title="Design Ubuntu-fr" href="http://www-static.ubuntu-fr.org/theme2010/css/doc-print.css" />

    <script type="text/javascript">
      var menu_hidden;
      var static_url = "UFR_STATIC";
    </script>
    <script src="http://www-static.ubuntu-fr.org/theme2010/js/menu.js" type="text/javascript"></script>
    <script src="http://www-static.ubuntu-fr.org/theme2010/js/common.js" type="text/javascript"></script>
  </head>
  <body>

    <div id="accessibar">
      <a href="openldap#main" tabindex="1">Contenu</a> | <a href="openldap#qsearch__in" tabindex="2">Rechercher</a> | <a href="openldap#navigation" tabindex="3">Menus</a>
    </div>

    <div id="page">

      <div id="header">

        <div id="logo">
          <h1>Ubuntu-fr</h1>
          <a href="../../index.html" title="Accueil de la documentation">Communauté francophone d'utilisateurs d'Ubuntu</a>
        </div>

        <form action="http://ubuntu-fr.org/recherche" accept-charset="utf-8" id="search" onsubmit="if (document.getElementById('qsearch__in').value == 'Recherche rapide....') {document.getElementById('qsearch__in').value = '';}">
          <fieldset>
            <label for="qsearch__in">Recherche : </label><input type="text" value="Recherche rapide...." id="qsearch__in" accesskey="f" name="sk_q" alt="[F]" size="34" tabindex="4" />
            <label for="tsearch_field">Chercher dans : </label><select name="sk_engine" tabindex="5" id="tsearch_field" title="Chercher dans">
              <option value="all">Site</option>
              <option selected="selected" value="doc">Documentation</option>
              <option value="forum">Forum</option>
              <option value="planet">Planet</option>
            </select>
            <input type="submit" value="ok" class="button" alt="Lancer la recherche" tabindex="5" />
          </fieldset>
        </form>
        <!--[if lte IE 7]><div class="clear"></div><![endif]-->

        <form action="openldap" accept-charset="utf-8" id="login_top" method="post">
          <fieldset>
            <label for="u_field">Identifiant : </label><input type="text" value="Identifiant" name="u" id="u_field" size="9" /><label for="p_field">Mot de passe : </label><input type="password" value="Mot de passe" name="p" id="p_field" size="9" alt="Mot de passe" /><input type="submit" value="connexion" id="connect" /> / <a href="http://forum.ubuntu-fr.org/register.php">inscription</a>
          </fieldset>
        </form>
 

      </div>

      <div id="navbar">
          <h2 id="pagetitle"><a href="openldap" >utilisateurs:lmrv:openldap</a></h2>
      </div>

      
      <div id="main" class="dokuwiki">

        <div id="hidemenu" title="Masquer le menu"></div>

        <div id="pagerror"></div>
                <!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table des matières</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="openldap#pre-requis">Pré-requis</a></div></li>
<li class="level1"><div class="li"><a href="openldap#installation">Installation</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="openldap#l_arbre_de_configuration_cn_config">L&#039;arbre de configuration cn=config</a></div></li>
<li class="level2"><div class="li"><a href="openldap#tests_de_bon_fonctionnement">Tests de bon fonctionnement</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="openldap#peupler_la_base">Peupler la base</a></div></li>
<li class="level1"><div class="li"><a href="openldap#securiser_le_serveur">Sécuriser le serveur</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="openldap#generation_des_certificats_auto-signes">Génération des certificats auto-signés</a></div></li>
<li class="level2"><div class="li"><a href="openldap#application_du_certificat_au_serveur">Application du certificat au serveur</a></div></li>
<li class="level2"><div class="li"><a href="openldap#verifications">Vérifications</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="openldap#authentification_des_postes_clients_par_ldap">Authentification des postes clients par LDAP</a></div></li>
<li class="level1"><div class="li"><a href="openldap#erreurs_connues">Erreurs connues</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="openldap#indexation_de_la_base">Indexation de la base</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="openldap#interfaces_graphiques_et_outils_d_administration">Interfaces graphiques et outils d&#039;administration</a></div></li>
<li class="level1"><div class="li"><a href="openldap#voir_aussi">Voir aussi</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->
<div class="tags"><span>
	<a href="../../lucid" class="wikilink1" title="lucid" rel="tag">Lucid</a>,
	<a href="../../oneiric" class="wikilink1" title="oneiric" rel="tag">Oneiric</a>,
	<a href="../../reseau" class="wikilink1" title="reseau" rel="tag">Reseau</a>,
	<a href="../../brouillon" class="wikilink1" title="brouillon" rel="tag">BROUILLON</a>
</span></div>
<hr />

<h1 class="sectionedit1" id="openldap">OpenLDAP</h1>
<div class="level1">

<p>
OpenLDAP est une implémentation libre du protocole <abbr title="Lightweight Directory Access Protocol">LDAP</abbr>  <a href="http://fr.wikipedia.org/wiki/Lightweight Directory Access Protocol" class="interwiki iw_wpfr" title="http://fr.wikipedia.org/wiki/Lightweight Directory Access Protocol">Lightweight Directory Access Protocol</a>.
</p>

<p>
<abbr title="Lightweight Directory Access Protocol">LDAP</abbr> est un protocole <abbr title="Transmission Control Protocol">TCP</abbr>/IP, version simplifiée du protocole OSI X.500.
Il permet d&#039;accéder à un annuaire.
</p>

<p>
Un annuaire peut contenir par exemple :
</p>
<ul>
<li class="level1"><div class="li"> des adresses mails</div>
</li>
<li class="level1"><div class="li"> des liens</div>
</li>
<li class="level1"><div class="li"> des comptes utilisateurs</div>
</li>
<li class="level1"><div class="li"> en règle générale toute données majoritairement servies en lecture seule  </div>
</li>
</ul>

<p>
et peut être utilisé par :
</p>
<ul>
<li class="level1"><div class="li"> le système d&#039;exploitation pour l&#039;authentification de ses utilisateurs,</div>
</li>
<li class="level1"><div class="li"> par des applications web</div>
</li>
<li class="level1"><div class="li"> par un MUA (Thunderbird par exemple) pour son carnet d&#039;adresse</div>
</li>
<li class="level1"><div class="li"> etc.</div>
</li>
</ul>

<p>
La version actuelle du protocole est la version LDAPv3.
Les versions récentes d&#039;OpenLDAP intègrent la configuration directement dans leur base de données, permettant ainsi les changements à chaud.
</p>

<p>
 Voici certains concepts et mots clefs qui seront utilisés plus bas :
</p>
<ul>
<li class="level1"><div class="li"> Un annuaire <abbr title="Lightweight Directory Access Protocol">LDAP</abbr> est un arbre de données hiérarchique (appelé DIT pour Directory Information Tree)</div>
</li>
<li class="level1"><div class="li"> Une entrée de cet arbre est composé d&#039;attributs</div>
</li>
<li class="level1"><div class="li"> Un attribut est composé d&#039;un type (un nom ou une description) et d&#039;une ou plusieurs valeurs</div>
</li>
<li class="level1"><div class="li"> Chaque attribut doit être défini dans au moins une classe d&#039;objets pour pouvoir être utilisé</div>
</li>
<li class="level1"><div class="li"> Les attributs et les classes d&#039;objets sont définis dans des schémas</div>
</li>
<li class="level1"><div class="li"> Chaque entrée dispose d&#039;une identifier unique, appelé &quot;Distinguished Name&quot; (noté DN ou dn).</div>
</li>
</ul>

<p>
Les termes objets, conteneurs et nœuds ont des connotations spéciales, mais sont identiques au terme entrée, qu&#039;il faut privilégier. 
</p>

<p>
OpenLDAP utilise pour ses interactions avec l&#039;administrateur, ou éventuellement pour échanger avec d&#039;autres serveurs <abbr title="Lightweight Directory Access Protocol">LDAP</abbr>, le format de fichier LDIF (<abbr title="Lightweight Directory Access Protocol">LDAP</abbr> Data Interchange Format). Toute information contenue dans le DIT peut être décrite dans ce format.
Il est, de ce fait, incontournable pour l&#039;administrateur.
</p>

<p>
Un fichier LDIF ressemble à l&#039;exemple ci-dessous :
</p>
<pre class="file">dn: cn=David Vincent,dc=ubuntu-fr,dc=lan
  cn: David Vincent
  givenName: David
  sn: Vincent
  telephoneNumber: +0033 20 99 88 77
  mail: david.vincent@ubuntu-fr.lan
  manager: cn=Will Smith,dc=ubuntu-fr,dc=lan
  objectClass: inetOrgPerson
  objectClass: organizationalPerson
  objectClass: person
  objectClass: top</pre>

<p>
On peut, à l&#039;aide de simples fichiers textes LDIF, totalement interagir avec le serveur OpenLDAP, et ajouter, modifier ou supprimer des entrées, de la configuration du serveur ou de l&#039;annuaire en lui-même.
</p>

<p>
D&#039;autres implémentations de <abbr title="Lightweight Directory Access Protocol">LDAP</abbr> peuvent être intéressantes à tester, comme 389 Directory Server (Red Hat), qui vient avec sa console d&#039;administration multi-plateforme. 389DS permet notamment la synchronisation avec un serveur Microsoft Active Directory, et la configuration du serveur en mode graphique. L&#039;installation et la configuration sont très bien documentées (en anglais).
</p>

</div>

<h2 class="sectionedit2" id="pre-requis">Pré-requis</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Disposer des <a href="../../sudo" class="wikilink1" title="sudo">droits d&#039;administration</a>.</div>
</li>
<li class="level1"><div class="li"> Disposer d&#039;une connexion à Internet configurée et activée.</div>
</li>
</ul>

<p>
L&#039;installation du paquet slapd mettra en place une configuration fonctionnelle, avec notamment l&#039;instance de base de données pour stocker nos données. Le suffixe utilisé pour cette instance est déterminé par le nom de domaine de la machine locale. Si le suffixe désiré n&#039;est pas le suffixe <abbr title="Domain Name System">DNS</abbr> de la machine, il faut alors le changer dans le fichier /etc/hosts. Dans tous les cas, le suffixe peut être changé après l&#039;installation, en saisissant dans un <a href="../../terminal" class="wikilink1" title="terminal">terminal</a> la <a href="../../commande_shell" class="wikilink1" title="commande_shell">commande</a> suivante :
</p>
<pre class="code bash">dpkg-reconfigure slapd</pre>

<p>
Dans notre cas, le serveur répondra au suffixe ubuntu-fr.lan, configurez le fichier /etc/hosts comme suit :
</p>
<pre class="file">127.0.1.1       ldap01.ubuntu-fr.lan	ldap01</pre>

<p>
<p><div class="noteimportant">Le tiret de ubuntu-fr devrait ne pas plaire à l&#039;installeur. Il devrait vous afficher un message d&#039;erreur, que vous pouvez ignorer, le service fonctionnera quand même.
</div></p>
</p>

</div>

<h2 class="sectionedit3" id="installation">Installation</h2>
<div class="level2">

<p>
Installez le daemon du serveur OpenLDAP, <strong><a href="apt://slapd" class="interwiki iw_apt" title="apt://slapd">slapd</a></strong> ainsi que les scripts d&#039;administration <strong><a href="apt://ldap-utils" class="interwiki iw_apt" title="apt://ldap-utils">ldap-utils</a></strong> couramment utilisés.
</p>

<p>
Deux bases de données vont être automatiquement créés pendant le processus d&#039;installation : la base contenant l&#039;arbre de configuration, et une seconde contenant l&#039;arbre de données du serveur.
</p>

<p>
Pendant l&#039;installation, un mot de passe est demandé pour le &quot;rootDN&quot;. Cet utilisateur dispose de tous les droits sur l&#039;arbre de données, et uniquement sur l&#039;arbre de données, puisqu&#039;il n&#039;existe pas dans l&#039;arbre de configuration. Son DN est par défaut : <em>cn=admin,dc=ubuntu-fr,dc=lan</em>). Vous utiliserez par la suite ce DN pour vous connecter en tant qu&#039;administrateur de l&#039;arbre de données.
</p>

<p>
Les schémas classiques (cosine, nis, inetorgperson) sont pré-configurés par défaut, de même que le schéma &quot;core&quot;, un prérequis pour tous les autres schémas.
</p>

</div>

<h3 class="sectionedit4" id="l_arbre_de_configuration_cn_config">L&#039;arbre de configuration cn=config</h3>
<div class="level3">

<p>
Contrairement aux versions précédentes, la partie configuration d&#039;openldap ne se situe plus dans des fichiers, mais directement dans une base de données distincte des enregistrements du serveur : l&#039;arbre cn=config. Cet arbre peut être modifié à chaud, sans avoir à redémarrer le service pour prendre en compte les changements, ce qui peut être un avantage, mais qui, en cas d&#039;erreurs de configuration, peut tout simplement empêcher le redémarrage du service.
</p>

<p>
L&#039;interaction avec l&#039;arbre de configuration, se fait bien entendu avec les scripts ldap et les fichiers ldif.
</p>

<p>
Il n&#039;y a pas de compte d&#039;administration &quot;rootDN&quot; pour l&#039;arbre de configuration. Il faut donc s&#039;authentifier d&#039;une manière externe pour y accéder.
</p>

</div>

<h3 class="sectionedit5" id="tests_de_bon_fonctionnement">Tests de bon fonctionnement</h3>
<div class="level3">

<p>
Le bon fonctionnement du serveur peut être testé à l&#039;aide de ces deux commandes :
</p>
<pre class="code bash"><span class="kw2">sudo</span> ldapsearch <span class="re5">-Q</span> <span class="re5">-LLL</span> <span class="re5">-Y</span> EXTERNAL <span class="re5">-H</span> ldapi:<span class="sy0">///</span> <span class="re5">-b</span> <span class="re2">cn</span>=config dn</pre>

<p>
devrait répondre :
</p>
<pre class="code bash">dn: <span class="re2">cn</span>=config
&nbsp;
dn: <span class="re2">cn</span>=module<span class="br0">&#123;</span><span class="nu0">0</span><span class="br0">&#125;</span>,<span class="re2">cn</span>=config
&nbsp;
dn: <span class="re2">cn</span>=schema,<span class="re2">cn</span>=config
&nbsp;
dn: <span class="re2">cn</span>=<span class="br0">&#123;</span><span class="nu0">0</span><span class="br0">&#125;</span>core,<span class="re2">cn</span>=schema,<span class="re2">cn</span>=config
&nbsp;
dn: <span class="re2">cn</span>=<span class="br0">&#123;</span><span class="nu0">1</span><span class="br0">&#125;</span>cosine,<span class="re2">cn</span>=schema,<span class="re2">cn</span>=config
&nbsp;
dn: <span class="re2">cn</span>=<span class="br0">&#123;</span><span class="nu0">2</span><span class="br0">&#125;</span>nis,<span class="re2">cn</span>=schema,<span class="re2">cn</span>=config
&nbsp;
dn: <span class="re2">cn</span>=<span class="br0">&#123;</span><span class="nu0">3</span><span class="br0">&#125;</span>inetorgperson,<span class="re2">cn</span>=schema,<span class="re2">cn</span>=config
&nbsp;
dn: <span class="re2">olcBackend</span>=<span class="br0">&#123;</span><span class="nu0">0</span><span class="br0">&#125;</span>hdb,<span class="re2">cn</span>=config
&nbsp;
dn: <span class="re2">olcDatabase</span>=<span class="br0">&#123;</span>-<span class="nu0">1</span><span class="br0">&#125;</span>frontend,<span class="re2">cn</span>=config
&nbsp;
dn: <span class="re2">olcDatabase</span>=<span class="br0">&#123;</span><span class="nu0">0</span><span class="br0">&#125;</span>config,<span class="re2">cn</span>=config
&nbsp;
dn: <span class="re2">olcDatabase</span>=<span class="br0">&#123;</span><span class="nu0">1</span><span class="br0">&#125;</span>hdb,<span class="re2">cn</span>=config</pre>

<p>
et
</p>
<pre class="code bash">ldapsearch <span class="re5">-x</span> <span class="re5">-LLL</span> <span class="re5">-H</span> ldap:<span class="sy0">///</span> <span class="re5">-b</span> <span class="re2">dc</span>=ubuntu-fr,<span class="re2">dc</span>=lan dn</pre>

<p>
répondra :
</p>
<pre class="code bash">dn: <span class="re2">dc</span>=ubuntu-fr,<span class="re2">dc</span>=lan
&nbsp;
dn: <span class="re2">cn</span>=admin,<span class="re2">dc</span>=ubuntu-fr,<span class="re2">dc</span>=lan</pre>

<p>
Les options de la commande ldapsearch permettent :
</p>
<ol>
<li class="level1"><div class="li">x : de ne pas utiliser la méthode d&#039;authentification SASL, qui est la valeur par défaut.</div>
</li>
<li class="level2"><div class="li">LLL: de désactiver l&#039;impression LDIF des informations de schéma.</div>
</li>
</ol>

</div>

<h2 class="sectionedit6" id="peupler_la_base">Peupler la base</h2>
<div class="level2">

<p>
Il est temps d&#039;ajouter du contenu dans l&#039;annuaire.
</p>

<p>
Vous pouvez ajouter :
</p>
<ul>
<li class="level1"><div class="li"> un noeud &quot;People&quot;, pour contenir les utilisateurs</div>
</li>
<li class="level1"><div class="li"> un noeud &quot;Groups&quot;, pour contenir les groupes d&#039;utilisateurs</div>
</li>
</ul>

<p>
pour organiser le contenu de votre annuaire.
</p>

<p>
Ces deux noeuds seront du type organizationalUnit (ou).
</p>

<p>
Pour cela, créez un fichier ou-base.ldif contenant :
</p>
<pre class="file">dn: ou=People,dc=ubuntu-fr,dc=lan
objectClass: organizationalUnit
ou: People

dn: ou=Groups,dc=ubuntu-fr,dc=lan
objectClass: organizationalUnit
ou: Groups</pre>

<p>
puis ajouter ces deux OU à l&#039;aide de la commande ldapadd :
</p>
<pre class="code bash">ldapadd <span class="re5">-x</span> <span class="re5">-D</span> <span class="re2">cn</span>=admin,<span class="re2">dc</span>=ubuntu-fr,<span class="re2">dc</span>=lan <span class="re5">-W</span> <span class="re5">-f</span> ou-base.ldif
&nbsp;
Enter LDAP Password: <span class="sy0">********</span>
adding new entry <span class="st0">&quot;ou=People,dc=ubuntu-fr,dc=lan&quot;</span>
&nbsp;
adding new entry <span class="st0">&quot;ou=Groups,dc=ubuntu-fr,dc=lan&quot;</span></pre>

<p>
Vous pouvez vérifier que ce contenu est bien ajouté dans la base avec la commande ldapsearch vue précédemment.
</p>

<p>
Maintenant que vous disposez de conteneurs, vous pouvez y ajouter des utilisateurs et des groupes, de la même façon que vous avez utilisé des UO.
</p>

<p>
Créez le fichier users.ldif :
</p>
<pre class="file">dn: cn=contributeurs,ou=Groups,dc=ubuntu-fr,dc=lan
objectClass: posixGroup
cn: contributeurs
gidNumber: 5000

dn: uid=mickael,ou=People,dc=ubuntu-fr,dc=lan
objectClass: inetOrgPerson
objectClass: posixAccount
objectClass: shadowAccount
uid: Mickael
sn: Vendetta
givenName: Mickael
cn: Vendetta
displayName: Mickael Vendetta
uidNumber: 10000
gidNumber: 5000
userPassword: secret
gecos: Mickael Vendetta
loginShell: /bin/bash
homeDirectory: /home/mickael.vendetta</pre>

<p>
De la même façon que ci-dessus, ajoutez le contenu de ce fichier au serveur :
</p>
<pre class="code bash">ldapadd <span class="re5">-x</span> <span class="re5">-D</span> <span class="re2">cn</span>=admin,<span class="re2">dc</span>=ubuntu-fr,<span class="re2">dc</span>=lan <span class="re5">-W</span> <span class="re5">-f</span> users.ldif
&nbsp;
Enter LDAP Password: <span class="sy0">********</span>
adding new entry <span class="st0">&quot;cn=contributeurs,ou=Groups,dc=ubuntu-fr,dc=lan&quot;</span>
&nbsp;
adding new entry <span class="st0">&quot;uid=mickael,ou=People,dc=ubuntu-fr,dc=lan&quot;</span></pre>

<p>
<p><div class="noteclassic">A propos des UID et des GID
Les UID et GID utilisés dans l&#039;annuaire <abbr title="Lightweight Directory Access Protocol">LDAP</abbr> ne doivent pas être identiques au UID et GID de l&#039;ordinateur local. C&#039;est pourquoi il est préférable d&#039;utiliser des valeurs commençant par exemple à 5000.
Par la suite, les utilisateurs ou les groupes <abbr title="Lightweight Directory Access Protocol">LDAP</abbr> pourront également être facilement identifiés par la valeur très élevée de leur UID/GID.

</div></p>
</p>

<p>
L&#039;utilisateur créé ci-dessus implémente les objectClass posixAccount et shadowAccount. En effet, si l&#039;objectClass shadowAccount n&#039;est pas implémenté, le système distant ne pourra pas connecter l&#039;utilisateur. 
</p>

</div>

<h2 class="sectionedit7" id="securiser_le_serveur">Sécuriser le serveur</h2>
<div class="level2">

<p>
Un client peut se connecter de 3 façons sur le serveur :
</p>
<ul>
<li class="level1"><div class="li"> en clair, sur le port 389, ce qui n&#039;est pas raisonnable lors du transfert de mot de passe ou de données sensibles</div>
</li>
<li class="level1"><div class="li"> en chiffré, sur le port 636, méthode qui est dépréciée</div>
</li>
<li class="level1"><div class="li"> en chiffré, sur le port 389, avec le STARTTLS, qui permet le passage en mode crypté de la session à n&#039;importe quel moment. Un des avantages certain de cette méthode est de n&#039;ouvrir qu&#039;un seul port, le 389, pour toutes les connexions, cryptée ou non.</div>
</li>
</ul>

<p>
<abbr title="Transport Layer Security">TLS</abbr> nécessite un certificat pour le serveur, signé par une autorité de certification. Faire signer son certificat par une autorité à un coût, il est alors possible de créer sa propre autorité de certification (CA), et de signer soit même ses certificats. Le revers de la médaille (et de la gratuité), sera d&#039;obligatoirement déployer sur chaque client le certificat de la CA.
</p>

<p>
Il faut donc être conscient de deux choses lors de la mise en place de <abbr title="Transport Layer Security">TLS</abbr> :
</p>
<ul>
<li class="level1"><div class="li"> le certificat de la CA doit être présent sur tous les clients,</div>
</li>
<li class="level1"><div class="li"> le FQDN utilisé à la génération du certificat doit impérativement être celui que les clients utiliseront lors des accès au serveur, sinon le certificat du serveur ne sera pas reconnu. </div>
</li>
</ul>

</div>

<h3 class="sectionedit8" id="generation_des_certificats_auto-signes">Génération des certificats auto-signés</h3>
<div class="level3">

<p>
Utilisez les utilitaires certtool pour accomplir cette tâche :
</p>
<pre class="code bash"><span class="kw2">sudo</span> <span class="kw2">apt-get install</span> gnutls-bin ssl-cert</pre>

</div>

<h4 id="la_clef_de_l_autorite_de_certification">La clef de l&#039;autorité de certification</h4>
<div class="level4">

<p>
Créez la clef privée pour l&#039;autorité de certification :
</p>
<pre class="code bash"><span class="kw2">sudo</span> <span class="kw2">sh</span> <span class="re5">-c</span> <span class="st0">&quot;certtool --generate-privkey &gt; /etc/ssl/private/cakey.pem&quot;</span></pre>

<p>
<p><div class="noteimportant">Ce fichier est critique d&#039;un point de vue sécurité.
En effet, tout certificat généré par lui sera automatiquement valide pour tous vos clients, et vous en aurez peut être besoin pour créer d&#039;autres certificats pour d&#039;autres services dans le futur, sans devoir redéployer sur chaque client une seconde autorité de certification.
Il s&#039;agit donc de le sauvegarder et le conserver en lieu sûr !
</div></p>
Créez ensuite un fichier modèle pour définir la CA : /etc/ssl/ca.info
</p>
<pre class="file">cn = Ubuntu FR
ca
cert_signing_key</pre>

<p>
Ce fichier sera réutilisé par les utilitaires certtool.
</p>

<p>
Créez le certificat auto-signé de la CA
</p>
<pre class="code bash"><span class="kw2">sudo</span> certtool <span class="re5">--generate-self-signed</span> \
  <span class="re5">--load-privkey</span> <span class="sy0">/</span>etc<span class="sy0">/</span>ssl<span class="sy0">/</span>private<span class="sy0">/</span>cakey.pem \ 
  <span class="re5">--template</span> <span class="sy0">/</span>etc<span class="sy0">/</span>ssl<span class="sy0">/</span>ca.info \
  <span class="re5">--outfile</span> <span class="sy0">/</span>etc<span class="sy0">/</span>ssl<span class="sy0">/</span>certs<span class="sy0">/</span>cacert.pem</pre>

<p>
Ce fichier cacert.pem est le fichier à déployer sur l&#039;ensemble des clients du serveur. Vous pouvez retrouver ce fichier nommé cacert.asc selon la distribution linux du client.
</p>

</div>

<h4 id="la_clef_privee_du_serveur">La clef privée du serveur</h4>
<div class="level4">

<p>
Il faut générer pour chaque serveur une clef et la signer avec la clef de la CA.
</p>

<p>
Créez une clef privée :
</p>
<pre class="code bash"><span class="kw2">sudo</span> certtool <span class="re5">--generate-privkey</span> \
  <span class="re5">--bits</span> <span class="nu0">1024</span> \
  <span class="re5">--outfile</span> <span class="sy0">/</span>etc<span class="sy0">/</span>ssl<span class="sy0">/</span>private<span class="sy0">/</span>ldap01_slapd_key.pem</pre>

<p>
<p><div class="notetip">Remplacer ldap01 par le nom de votre serveur.
Il est recommandé de nommer les certificats avec les noms des hôtes pour lesquels ils sont destinés et leur fonction pour les reconnaître plus facilement.
</div></p>
</p>

<p>
A la manière de la CA, vous allez maintenant créer un fichier info qui contiendra les informations propres à ce certificat :
Fichier : /etc/ssl/ldap01.info 
</p>
<pre class="file">organization = Ubuntu-fr
cn = ldap01.ubuntu-fr.lan
tls_www_server
encryption_key
signing_key
expiration_days = 3650</pre>
<ul>
<li class="level1"><div class="li"> La ligne cn, doit contenir le nom du serveur qui sera utilisé par les clients, le plus simple étant le nom <abbr title="Domain Name System">DNS</abbr>.</div>
</li>
<li class="level1"><div class="li"> La ligne expiration_days est réglée pour 10 ans, vous pouvez l&#039;ajuster à vos besoins.</div>
</li>
</ul>

<p>
Créez maintenant le certificat du serveur :
</p>
<pre class="code bash"><span class="kw2">sudo</span> certtool <span class="re5">--generate-certificate</span> \
  <span class="re5">--load-privkey</span> <span class="sy0">/</span>etc<span class="sy0">/</span>ssl<span class="sy0">/</span>private<span class="sy0">/</span>ldap01_slapd_key.pem \
  <span class="re5">--load-ca-certificate</span> <span class="sy0">/</span>etc<span class="sy0">/</span>ssl<span class="sy0">/</span>certs<span class="sy0">/</span>cacert.pem \
  <span class="re5">--load-ca-privkey</span> <span class="sy0">/</span>etc<span class="sy0">/</span>ssl<span class="sy0">/</span>private<span class="sy0">/</span>cakey.pem \
  <span class="re5">--template</span> <span class="sy0">/</span>etc<span class="sy0">/</span>ssl<span class="sy0">/</span>ldap01.info \
  <span class="re5">--outfile</span> <span class="sy0">/</span>etc<span class="sy0">/</span>ssl<span class="sy0">/</span>certs<span class="sy0">/</span>ldap01_slapd_cert.pem</pre>

</div>

<h3 class="sectionedit9" id="application_du_certificat_au_serveur">Application du certificat au serveur</h3>
<div class="level3">

<p>
Pour appliquer ce certificat au serveur, créez un fichier ldif /etc/ssl/certinfo.ldif. Cette fois-ci, c&#039;est la base de configuration du serveur qui est visée.
</p>
<pre class="file">dn: cn=config
add: olcTLSCACertificateFile
olcTLSCACertificateFile: /etc/ssl/certs/cacert.pem
-
add: olcTLSCertificateFile
olcTLSCertificateFile: /etc/ssl/certs/ldap01_slapd_cert.pem
-
add: olcTLSCertificateKeyFile
olcTLSCertificateKeyFile: /etc/ssl/private/ldap01_slapd_key.pem</pre>

<p>
et appliquez ces changements :
</p>
<pre class="code bash"><span class="kw2">sudo</span> ldapmodify <span class="re5">-Y</span> EXTERNAL <span class="re5">-H</span> ldapi:<span class="sy0">///</span> <span class="re5">-f</span> <span class="sy0">/</span>etc<span class="sy0">/</span>ssl<span class="sy0">/</span>certinfo.ldif</pre>

<p>
Pour accéder au serveur en <abbr title="Transport Layer Security">TLS</abbr>, et contrairement à ce que l&#039;on peut penser, il n&#039;y a pas besoin d&#039;utiliser le protocole ldaps:, mais bien uniquement ldap:.
</p>

<p>
Reste à appliquer les permissions adéquates sur les fichiers sensibles et redémarrer le service :
</p>
<pre class="code bash"><span class="kw2">sudo</span> adduser openldap ssl-cert
<span class="kw2">sudo</span> <span class="kw2">chgrp</span> ssl-cert <span class="sy0">/</span>etc<span class="sy0">/</span>ssl<span class="sy0">/</span>private<span class="sy0">/</span>ldap01_slapd_key.pem
<span class="kw2">sudo</span> <span class="kw2">chmod</span> g+r <span class="sy0">/</span>etc<span class="sy0">/</span>ssl<span class="sy0">/</span>private<span class="sy0">/</span>ldap01_slapd_key.pem
<span class="kw2">sudo</span> <span class="kw2">chmod</span> o-r <span class="sy0">/</span>etc<span class="sy0">/</span>ssl<span class="sy0">/</span>private<span class="sy0">/</span>ldap01_slapd_key.pem
<span class="kw2">sudo</span> service slapd restart</pre>

<p>
Vérifiez les logs (/var/log/syslog) pour voir si le service à correctement démarré.
</p>

</div>

<h3 class="sectionedit10" id="verifications">Vérifications</h3>
<div class="level3">

<p>
Pour se connecter au serveur <abbr title="Lightweight Directory Access Protocol">LDAP</abbr> en <abbr title="Transport Layer Security">TLS</abbr>, ajoutez l&#039;option -ZZ aux commandes ldap, pour forcer la connexion en <abbr title="Transport Layer Security">TLS</abbr>.
</p>

<p>
A ce stade, si vous tapez notre commande :
</p>
<pre class="code bash">ldapsearch <span class="re5">-ZZ</span> <span class="re5">-x</span> <span class="re5">-LLL</span> <span class="re5">-H</span> ldap:<span class="sy0">///</span> <span class="re5">-b</span> <span class="re2">dc</span>=ubuntu-fr,<span class="re2">dc</span>=lan dn</pre>

<p>
vous obtiendrez un message d&#039;erreur inconnue.
</p>

<p>
Il faut configurer le client ldap pour qu&#039;il utilise le certificat de notre CA. Le fichier /etc/ldap/ldap.conf doit maintenant ressembler à ceci :
</p>
<pre class="file">#
# LDAP Defaults
#

BASE     dc=ubuntu-fr,dc=lan
URI        ldap://ldap01.ubuntu-fr.lan

SIZELIMIT    12
TIMELIMIT   15
DEREF         NEVER

TLS_CA_CERT    /etc/ssl/certs/cacert.pem</pre>

<p>
et vérifier la présence de ce fichier dans votre répertoire :
</p>
<pre class="code bash"><span class="kw2">ls</span> <span class="sy0">/</span>etc<span class="sy0">/</span>ssl<span class="sy0">/</span>certs<span class="sy0">/</span>cacert.pem</pre>

</div>

<h2 class="sectionedit11" id="authentification_des_postes_clients_par_ldap">Authentification des postes clients par LDAP</h2>
<div class="level2">

<p>
Pour utiliser l&#039;authentification <abbr title="Lightweight Directory Access Protocol">LDAP</abbr> sur les postes clients, il faut configurer pam et nsswitch. Les distributions actuelles prennent en charge la configuration automatique de ces deux services.
</p>

<p>
<p><div class="noteclassic">Avant de pouvoir utiliser le service <abbr title="Lightweight Directory Access Protocol">LDAP</abbr>, le fichier /etc/ldap/ldap.conf doit avoir été configuré sur le client comme vu précédemment, et le certificat de la CA copié en local.
</div></p>
</p>

<p>
Le méta-package ldap-auth-client va installer les packages nécessaires à notre configuration. Il est également fortement conseillé de conserver le service nscd démarré.
</p>
<pre class="code bash"><span class="kw2">sudo</span> <span class="kw2">apt-get install</span> ldap-auth-client nscd
<span class="kw2">sudo</span> auth-client-config <span class="re5">-t</span> nss <span class="re5">-p</span> lac_ldap</pre>

<p>
On peut vérifier que le client reconnaît maintenant nos utilisateurs <abbr title="Lightweight Directory Access Protocol">LDAP</abbr> avec la commande :
</p>
<pre class="code bash"><span class="kw2">getent</span> <span class="kw2">passwd</span></pre>

<p>
qui doit laisser apparaître notre nouvel utilisateur.
</p>

<p>
Pour utiliser l&#039;authentification <abbr title="Lightweight Directory Access Protocol">LDAP</abbr> dans sa version sécurisée, il faut modifier le fichier /etc/ldap.conf, cette fois-ci, qui a été créé pendant l&#039;installation du métapackage ldap-auth-client.
Décommentez les lignes :
</p>
<pre class="file">ssl start_tls
tls_cacertdir /etc/ssl/certs/</pre>

<p>
Un reboot du poste client devrait permettre l&#039;authentification des nouveaux utilisateurs.
<p><div class="notetip">Chez RedHat, c&#039;est le programme system-config-auth qui permet la configuration automatique de l&#039;authentification. Il faut également modifier les fichiers /etc/openldap/ldap.conf et le fichier /etc/ldap.conf (à vérifier) comme expliqué ci-dessus.
</div></p>
</p>

</div>

<h2 class="sectionedit12" id="erreurs_connues">Erreurs connues</h2>
<div class="level2">

</div>

<h3 class="sectionedit13" id="indexation_de_la_base">Indexation de la base</h3>
<div class="level3">

<p>
Dans le log /etc/log/syslog, des messages relatifs à l&#039;indexation <abbr title="Lightweight Directory Access Protocol">LDAP</abbr> apparaissent.
Par défaut, le serveur n&#039;indexe que les objectClass et les cn. 
</p>

<p>
Créer le fichier indexchanges.ldif suivant :
</p>
<pre class="file">dn: olcDatabase={1}hdb,cn=config
changetype: modify
replace: olcDbIndex
olcDbIndex: uid,uidNumber,gidNumber,memberUid,uniqueMember,objectClass,cn eq</pre>

<p>
Et appliquer les changements à notre base :
</p>
<pre class="code bash"><span class="kw2">sudo</span> ldapmodify <span class="re5">-f</span> indexchanges.ldif <span class="re5">-Y</span> EXTERNAL <span class="re5">-H</span> ldapi:<span class="sy0">///</span></pre>

</div>

<h2 class="sectionedit14" id="interfaces_graphiques_et_outils_d_administration">Interfaces graphiques et outils d&#039;administration</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="http://directory.apache.org/studio/" class="urlextern" title="http://directory.apache.org/studio/"  rel="nofollow">http://directory.apache.org/studio/</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://jxplorer.org/" class="urlextern" title="http://jxplorer.org/"  rel="nofollow">JXplorer</a> : un client en Java, peu ergonomique mais fonctionnel.</div>
</li>
<li class="level1"><div class="li"> <a href="http://phpldapadmin.sourceforge.net/PhpLdapAdmin" class="urlextern" title="http://phpldapadmin.sourceforge.net/PhpLdapAdmin"  rel="nofollow">http://phpldapadmin.sourceforge.net/PhpLdapAdmin</a> : un client en php.</div>
</li>
</ul>

</div>

<h2 class="sectionedit15" id="voir_aussi">Voir aussi</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <strong>(en)</strong> <a href="http://www.openldap.org" class="urlextern" title="http://www.openldap.org"  rel="nofollow">Site officiel du serveur OpenLDAP</a></div>
</li>
</ul>

<p>
—-
<em>Contributeurs principaux : <a href="http://doc.ubuntu-fr.org/utilisateurs/lmrv" class="wikilink1" title="utilisateurs:lmrv">lmrv</a>, </em>
</p>

<p>
<em>Basé sur <a href="https://help.ubuntu.com/12.04/serverguide/openldap-server.html" class="urlextern" title="https://help.ubuntu.com/12.04/serverguide/openldap-server.html"  rel="nofollow">Ubuntu Server Guide &gt; OpenLDAP Server</a>.</em>
</p>

</div>

<!-- no cachefile used, but created /srv/www/doc.ubuntu-fr.org/htdocs/data/cache/c/c14422a4a7f5714b9d73e7ce6e6ce7ea.xhtml -->

        <br style="clear:both;" />
        <div id="pageinfo">
            <!--  |  | -->
            <!-- ?tpl_pageinfo()? -->
            <br />
            Le contenu de ce wiki est sous licence : <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" rel="license" target="_blank">CC BY-SA v3.0</a>
        </div> 
      </div>

      
      <div id="navigation">

        <ul>
          <li class="menu"><a href="http://www.ubuntu-fr.org" class="title" id="menu-accueil"><span>Accueil</span></a></li>
          <li class="menu" id="active">
            <a href="../../index.html"  class="title" id="menu-doc"><span>Documentation</span></a>
            <ul>
              <li id="navWiki" class="cat">
                <h2>Actions</h2>
                <ul>
                  <li><a href="http://doc.ubuntu-fr.org/utilisateurs/lmrv/openldap?do=index"  class="action index" accesskey="x" rel="nofollow" title="Plan du site [X]">Plan du site</a></li>
                  <li><a href="http://doc.ubuntu-fr.org/utilisateurs/lmrv/openldap?do=edit&amp;rev=0"  class="action source" accesskey="v" rel="nofollow" title="Afficher le texte source [V]">Afficher le texte source</a></li>
                  <li><a href="http://doc.ubuntu-fr.org/utilisateurs/lmrv/openldap?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]">Anciennes révisions</a></li>
                  <li></li>
                  <li><a href="http://doc.ubuntu-fr.org/utilisateurs/lmrv/openldap?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Derniers changements [R]">Derniers changements</a></li>
                  <li><a href="http://doc.ubuntu-fr.org/utilisateurs/lmrv/openldap?do=backlink"  class="action backlink" rel="nofollow" title="Liens vers cette page">Liens vers cette page</a></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </li>
              <li id="navDivers" class="cat">
                <h2>Divers</h2>
                <ul>
                  <li><bdi><a href="../../wiki/participer_wiki" class="wikilink1" title="wiki:participer_wiki">Participer à la documentation</a></bdi></li>
                  <li><bdi><a href="../../documentation_hors_ligne" class="wikilink1" title="documentation_hors_ligne">Documentation hors ligne</a></bdi></li>
                  <li><a href="http://www.ubuntu-fr.org/telechargement" title="T&eacute;l&eacute;charger Ubuntu">T&eacute;l&eacute;charger Ubuntu</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li class="menu"><a href="http://forum.ubuntu-fr.org"  class="title" id="menu-forum"><span>Forum</span></a></li>
          <li class="menu"><a href="http://planet.ubuntu-fr.org"  class="title" id="menu-planet"><span>Planet</span></a></li>
        </ul>

      </div>
      <div id="references-ufr">
        <ul id="legal-ufr">
          <li><a href="http://www.ubuntu-fr.org/contacts">Contact</a></li>
        </ul>

        <ul id="sponsors-ufr">
          <li><a href="http://www.dokuwiki.org/dokuwiki" id="dokuwiki">Propulsé par Dokuwiki</a></li>
        </ul>
      </div>

    </div>
    <!-- $Id$ -->

    <!-- Piwik Image Tracker -->
    <!-- img src="http://piwik.infra.ubuntu-fr.org/piwik.php?idsite=2&amp;rec=1" style="border:0" alt="" /-->
    <!-- End Piwik -->

  </body>
</html>
