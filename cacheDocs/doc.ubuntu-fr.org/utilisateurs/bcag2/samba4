<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr" dir="ltr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Script-Type" content="text/javascript"/>
    <meta http-equiv="Content-Style-Type" content="text/css"/>
    <meta http-equiv="Content-Language" content="fr"/>
    <title>utilisateurs:bcag2:samba4 - Documentation Ubuntu Francophone</title>
    <meta name="Description" content="Documentation francophone pour la distribution Ubuntu" lang="fr" />
    <meta name="language" content="fr-FR" />

    <!--[if IE 8]>
    <meta http-equiv="X-UA-Compatible" content="IE=8" />
    <![endif]-->
        <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2014-03-04T10:42:40+0100"/>
<meta name="keywords" content="utilisateurs,bcag2,samba4"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../lib/exe/opensearch.php" title="Documentation Ubuntu Francophone"/>
<link rel="start" href="../../index.html"/>
<link rel="contents" href="http://doc.ubuntu-fr.org/utilisateurs/bcag2/samba4?do=index" title="Plan du site"/>
<link rel="alternate" type="application/rss+xml" title="Derniers changements" href="../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Namespace actuel" href="http://doc.ubuntu-fr.org/feed.php?mode=list&amp;ns=utilisateurs:bcag2"/>
<link rel="alternate" type="text/html" title="HTML brut" href="http://doc.ubuntu-fr.org/_export/xhtml/utilisateurs/bcag2/samba4"/>
<link rel="alternate" type="text/plain" title="Wiki balise" href="http://doc.ubuntu-fr.org/_export/raw/utilisateurs/bcag2/samba4"/>
<link rel="canonical" href="samba4"/>
<link rel="stylesheet" type="text/css" href="../../lib/exe/css.php?t=ubuntu-2010&amp;tseed=4af22dedc19f28c99fa67afabbb173df"/>
<script type="text/javascript">/*<![CDATA[*/var NS='utilisateurs:bcag2';var JSINFO = {"id":"utilisateurs:bcag2:samba4","namespace":"utilisateurs:bcag2"};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../lib/exe/js.php?tseed=4af22dedc19f28c99fa67afabbb173df"></script>
    <link rel="shortcut icon" href="http://www-static.ubuntu-fr.org/theme2010/images/commun/ubuntu/icone.png" type="image/x-icon" />
    <link rel="apple-touch-icon" href="http://www-static.ubuntu-fr.org/theme2010/images/commun/ubuntu/touch-ico.png" />

    <link rel="stylesheet" media="screen" type="text/css" title="Design Ubuntu-fr" href="http://www-static.ubuntu-fr.org/theme2010/css/doc.css" />
    <link rel="stylesheet" media="screen" type="text/css" title="Design Ubuntu-fr" href="http://www-static.ubuntu-fr.org/theme2010/css/doc-ubuntu.css" />
    <link rel="stylesheet" media="print" type="text/css" title="Design Ubuntu-fr" href="http://www-static.ubuntu-fr.org/theme2010/css/doc-print.css" />

    <script type="text/javascript">
      var menu_hidden;
      var static_url = "UFR_STATIC";
    </script>
    <script src="http://www-static.ubuntu-fr.org/theme2010/js/menu.js" type="text/javascript"></script>
    <script src="http://www-static.ubuntu-fr.org/theme2010/js/common.js" type="text/javascript"></script>
  </head>
  <body>

    <div id="accessibar">
      <a href="samba4#main" tabindex="1">Contenu</a> | <a href="samba4#qsearch__in" tabindex="2">Rechercher</a> | <a href="samba4#navigation" tabindex="3">Menus</a>
    </div>

    <div id="page">

      <div id="header">

        <div id="logo">
          <h1>Ubuntu-fr</h1>
          <a href="../../index.html" title="Accueil de la documentation">Communauté francophone d'utilisateurs d'Ubuntu</a>
        </div>

        <form action="http://ubuntu-fr.org/recherche" accept-charset="utf-8" id="search" onsubmit="if (document.getElementById('qsearch__in').value == 'Recherche rapide....') {document.getElementById('qsearch__in').value = '';}">
          <fieldset>
            <label for="qsearch__in">Recherche : </label><input type="text" value="Recherche rapide...." id="qsearch__in" accesskey="f" name="sk_q" alt="[F]" size="34" tabindex="4" />
            <label for="tsearch_field">Chercher dans : </label><select name="sk_engine" tabindex="5" id="tsearch_field" title="Chercher dans">
              <option value="all">Site</option>
              <option selected="selected" value="doc">Documentation</option>
              <option value="forum">Forum</option>
              <option value="planet">Planet</option>
            </select>
            <input type="submit" value="ok" class="button" alt="Lancer la recherche" tabindex="5" />
          </fieldset>
        </form>
        <!--[if lte IE 7]><div class="clear"></div><![endif]-->

        <form action="samba4" accept-charset="utf-8" id="login_top" method="post">
          <fieldset>
            <label for="u_field">Identifiant : </label><input type="text" value="Identifiant" name="u" id="u_field" size="9" /><label for="p_field">Mot de passe : </label><input type="password" value="Mot de passe" name="p" id="p_field" size="9" alt="Mot de passe" /><input type="submit" value="connexion" id="connect" /> / <a href="http://forum.ubuntu-fr.org/register.php">inscription</a>
          </fieldset>
        </form>
 

      </div>

      <div id="navbar">
          <h2 id="pagetitle"><a href="samba4" >utilisateurs:bcag2:samba4</a></h2>
      </div>

      
      <div id="main" class="dokuwiki">

        <div id="hidemenu" title="Masquer le menu"></div>

        <div id="pagerror"></div>
                <!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table des matières</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="samba4#introduction">Introduction</a></div></li>
<li class="level1"><div class="li"><a href="samba4#versions">Versions</a></div></li>
<li class="level1"><div class="li"><a href="samba4#installation_de_samba">Installation de Samba</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="samba4#differentes_possibilites_d_installation">Différentes possibilités d&#039;installation</a></div></li>
<li class="level2"><div class="li"><a href="samba4#chemins_path">Chemins (path)</a></div></li>
<li class="level2"><div class="li"><a href="samba4#informations_du_serveur">Informations du serveur</a></div></li>
<li class="level2"><div class="li"><a href="samba4#initialisation_de_samba_configurer_un_nouveau_domaine">Initialisation de Samba (configurer un nouveau domaine)</a></div></li>
<li class="level2"><div class="li"><a href="samba4#mise_a_jour_depuis_un_domaine_samba_de_type_nt4_vers_un_ad">Mise à jour depuis un domaine Samba de type NT4 vers un AD</a></div></li>
<li class="level2"><div class="li"><a href="samba4#demarrer_votre_ad_dc_samba">Démarrer votre AD DC Samba</a></div></li>
<li class="level2"><div class="li"><a href="samba4#test_de_connexion_a_votre_controleur_de_domaine_ad_samba">Test de connexion a votre contrôleur de domaine AD Samba</a></div></li>
<li class="level2"><div class="li"><a href="samba4#configuration_du_serveur_dns">Configuration du serveur DNS</a></div></li>
<li class="level2"><div class="li"><a href="samba4#configuration_de_kerberos">Configuration de Kerberos</a></div></li>
<li class="level2"><div class="li"><a href="samba4#configuration_ntp">Configuration NTP</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="samba4#informations_optionnelles_et_complementaires">Informations optionnelles et complémentaires</a></div></li>
<li class="level1"><div class="li"><a href="samba4#remonter_vos_succesechecs">Remonter vos succès/échecs</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="samba_4_-_le_controleur_de_domaine_active_directory">samba (4) - le  contrôleur de domaine Active Directory</h1>
<div class="level1">

<p>
Cette page est le brouillon de la page <a href="http://doc.ubuntu-fr.org/samba-active-directory" class="wikilink1" title="samba-active-directory">samba-active-directory</a><br/>

et n&#039;a plus lieu d&#039;être modifiée
ce documents a été rédigé à partir de plusieurs sources parmi :
</p>
<ul>
<li class="level1"><div class="li"> wiki Samba : <a href="http://wiki.samba.org/index.php/Samba_AD_DC_HOWTO" class="urlextern" title="http://wiki.samba.org/index.php/Samba_AD_DC_HOWTO"  rel="nofollow">http://wiki.samba.org/index.php/Samba_AD_DC_HOWTO</a></div>
</li>
<li class="level1"><div class="li"> articles dans linux pratique n°79 de sept/oct 2013 (pages 68 à 73) et linux pratique n°80 de nov/déc (pages 70 à 76)</div>
</li>
</ul>

<p>
<p><div class="noteclassic"> ajoutez vos retours d&#039;expérience, notamment chapitre 5 
</div></p>
</p>

</div>

<h2 class="sectionedit2" id="introduction">Introduction</h2>
<div class="level2">

<p>
Le projet Samba est surtout connut pour le partage de fichier.<br/>

Samba 4 est une ré-écriture complète initiée en 2003 dans l&#039;objectif de créer, en plus du partage de fichier, d&#039;un contrôle de domaine libre.<br/>
Il est agrémenté, en natif, d&#039;un serveur <a href="../../dns" class="wikilink1" title="dns">DNS</a>, <a href="../../openldap-server" class="wikilink1" title="openldap-server">LDAP</a>, <a href="http://fr.wikipedia.org/wiki/Kerberos_%28protocole%29" class="urlextern" title="http://fr.wikipedia.org/wiki/Kerberos_%28protocole%29"  rel="nofollow">Kerberos</a>, <a href="http://fr.wikipedia.org/wiki/Remote_procedure_call" class="urlextern" title="http://fr.wikipedia.org/wiki/Remote_procedure_call"  rel="nofollow">RPC</a> et <a href="http://fr.wikipedia.org/wiki/Server_Message_Block" class="urlextern" title="http://fr.wikipedia.org/wiki/Server_Message_Block"  rel="nofollow">SMB 3.0</a>. 
<p><div class="noteimportant">Cette documentation s&#039;adresse principalement à des administrateurs réseau pour la mise en place d&#039;un serveur de contrôle de domaine et requiert notamment de bonnes notions sur le <abbr title="Domain Name System">DNS</abbr>
</div></p>
Ce document explique comment configurer Samba comme contrôleur de domaine (DC) compatible avec l&#039;Active Directory (AD) de Microsoft ©, notamment pour l&#039;utilisation de connexion de domaine de machines clientes tournants sous Microsoft Windows. En abréviation, nous utiliserons AD DC (Active Directory Domain Controler)
Si vous réalisez une mise à niveau de votre AD DC, merci de consulter la procédure de mise à niveau de votre distribution ou reportez vous au guide mise à niveau d&#039;une version source.
</p>

</div>

<h2 class="sectionedit3" id="versions">Versions</h2>
<div class="level2">

<p>
Samba 4, depuis sa version 4.1 sortie fin 2013, est la version stable actuelle.
Retrouver la liste des versions est leur support sur <a href="https://wiki.samba.org/index.php/Samba_Release_Planning#Current_Stable_Release" class="urlextern" title="https://wiki.samba.org/index.php/Samba_Release_Planning#Current_Stable_Release"  rel="nofollow">Planing (roadmap) Versions Stables</a><br/>

Samba est développé en continu. Ce guide est fréquemment mis à jour pour correspondre aux évolutions. Merci de vous référer <a href="http://www.samba.org/samba/history/" class="urlextern" title="http://www.samba.org/samba/history/"  rel="nofollow">à l&#039;historique des versions stables de Samba</a> pour plus d&#039;informations.
Prenez connaissance de la release notes de la version que vous avez installée. Elle peut contenir des informations importantes non contenues dans ce guide.
Vous pouvez vérifier d&#039;éventuelle installation précédente de samba en tapant :
</p>
<pre class="code">dpkg -l samba</pre>

<p>
 se reporter à la page <a href="http://doc.ubuntu-fr.org/dpkg" class="wikilink1" title="dpkg">dpkg</a> pour plus d&#039;informations
</p>

</div>

<h2 class="sectionedit4" id="installation_de_samba">Installation de Samba</h2>
<div class="level2">

</div>

<h3 class="sectionedit5" id="differentes_possibilites_d_installation">Différentes possibilités d&#039;installation</h3>
<div class="level3">

<p>
Avant d&#039;installer Samba 4, il est nécessaire de disposer d&#039;autres paquets.
Voici la ligne proposée sur <a href="https://wiki.samba.org/index.php/Samba_4/OS_Requirements#Debian_or_Ubuntu" class="urlextern" title="https://wiki.samba.org/index.php/Samba_4/OS_Requirements#Debian_or_Ubuntu"  rel="nofollow">wiki.samba.org/index.php/Samba_4/OS_Requirements</a>
</p>
<pre class="code">sudo apt-get install build-essential libacl1-dev libattr1-dev \
   libblkid-dev libgnutls-dev libreadline-dev python-dev \
   python-dnspython gdb pkg-config libpopt-dev libldap2-dev \
   dnsutils libbsd-dev attr krb5-user docbook-xsl libcups2-dev acl</pre>

<p>
Par ailleurs, il est nécessaire d&#039;activer les <a href="../../acl" class="wikilink1" title="acl">ACL</a> et les attributs étendus (usr_xattr), exemple de <a href="../../mount_fstab" class="wikilink1" title="mount_fstab">fstab</a> :
</p>
<pre class="code">UUID=243eb5b....... / ext4 default,acl,user_xattr,barrier=1   0   1</pre>

<p>
Vous disposez de deux possibilités pour installer Samba :
</p>

</div>

<h4 id="installation_avec_votre_gestionnaire_de_paquet">Installation avec votre gestionnaire de paquet</h4>
<div class="level4">

<p>
Cette solution, si elle a l&#039;avantage d&#039;être très simple, a l&#039;inconvénient d&#039;installer une version qui peut être ancienne, ce qui peut être gênant alors que le logiciel évolue rapidement. Ainsi, pour Precise (LTS 12.04), seule une version alpha est proposée pour test. <br/>

A partir de Trusty (LTS 14.04), l&#039;installation de Samba correspondra à la version stable 4.1.3 en lieu et place de la version 3.x actuelle.
</p>

</div>

<h4 id="compiler_samba_vous-meme_a_partir_des_sources">Compiler Samba vous-même à partir des sources</h4>
<div class="level4">

<p>
Cette solution est préconisée pour disposer de la dernière version de Samba4, notamment si vous souhaitez mettre en place un serveur en production sous Precise (LTS12.04). 
N&#039;hésitez pas à vous reporter à la page suivante : <a href="https://wiki.samba.org/index.php/Build_Samba" class="urlextern" title="https://wiki.samba.org/index.php/Build_Samba"  rel="nofollow">https://wiki.samba.org/index.php/Build_Samba</a>
</p>
<pre class="code">wget http://www.samba.org/samba/stable/samba-4.1.4.tar.gz
tar xvzf samba-4.1.4.tar.gz
cd samba-4.1.4
./configure
make &amp;&amp; make install
</pre>

<p>
en résumé, les lignes ci-dessus permettent de télécharger, décompresser, compiler puis lancer l&#039;installation.<br/>

Nota : utiliser la dernière version si correction de sécurité, sinon, n&#039;hésitez pas à prendre la version n-1 si la dernière version est trop fraîche !
<br/>

Il peut être utile (voir indispensable) d&#039;installer les &quot;samba-tool&quot; :
</p>
<pre class="code"> sudo apt-get install samba4-common-bin </pre>

</div>

<h3 class="sectionedit6" id="chemins_path">Chemins (path)</h3>
<div class="level3">

<p>
Soyez prudent quand vous exécutez une commande Samba si vous avez déjà une version antérieure de Samba installée. Pour éviter d&#039;exécuter une mauvaise version, vous devez définir les chemins des répertoires /usr/local/samba/bin/ et /usr/local/samba/sbin/ au tout début de votre <a href="http://doc.ubuntu-fr.org/variables_d_environnement" class="wikilink1" title="variables_d_environnement">variable</a> $PATH !<br/>

</p>
<pre class="code"> export PATH=/usr/local/samba/bin:/usr/local/samba/sbin:$PATH</pre>

<p>
Vous pouvez voir la version de Samba que vous utilisez en exécutant :
</p>
<pre class="code"> samba -V</pre>

</div>

<h3 class="sectionedit7" id="informations_du_serveur">Informations du serveur</h3>
<div class="level3">

<p>
Pour le reste de ce guide, nous utiliserons les paramètres suivants pour le serveur<br/>

répertoire d&#039;installation: /usr/local/samba/ <br/>

nom du serveur:        DC1 <br/>

nom de domaine <abbr title="Domain Name System">DNS</abbr>:        samdom.example.com<br/>

nom de &quot;royaume&quot; ou realm: SANDOM.EXAMPLE.COM (comme le nom de domaine, mais en MAJUSCULE)<br/>

nom de domaine NT4 :       samdom <br/>

adresse IP :             192.168.1.1 <br/>

rôle du serveur :            DC (contrôleur de domaine) <br/>

</p>

</div>

<h3 class="sectionedit8" id="initialisation_de_samba_configurer_un_nouveau_domaine">Initialisation de Samba (configurer un nouveau domaine)</h3>
<div class="level3">

<p>
Cette initialisation crée une base de donnée. Cette opération est nécessaire lors de la configuration d&#039;un nouveau contrôleur de domaine. Si vous souhaitez configurer le serveur Samba comme un contrôleur de domaine additionnel dans un domaine existant, référez-vous au guide <a href="https://wiki.samba.org/index.php/Samba4/HOWTO/Join_a_domain_as_a_DC" class="urlextern" title="https://wiki.samba.org/index.php/Samba4/HOWTO/Join_a_domain_as_a_DC"  rel="nofollow">Joining a Windows Domain Controller as an additional DC in a Domain</a>.<br/>

Cette étape doit être réalisée par un utilisateur ayant les droits d&#039;écriture sur le répertoire d&#039;installation. Dans le cas contraire, cela générera des erreurs de permissions.
Pour lancer cette configuration, exécuter :
</p>
<pre class="code"> sudo /usr/local/samba/bin/ samba-tool domain provision --use-rfc2307 --interactive</pre>

<p>
Cela lance l&#039;outil de configuration qui est interactif. Cette interactivité n&#039;étant pas vrai pour certain paramètres, il est recommandé d&#039;exécuter 
</p>
<pre class="code">samba-tool domain provision --help </pre>

<p>
afin d&#039;avoir un aperçu des options complémentaires.
L&#039;option –use-rfc2307 active les attributs posix de l&#039;AD de Samba. Cela crée aussi les informations NIS dans l&#039;AD, ce qui vous permet d&#039;administrer les UIDs/GIDs et autres paramètres UNIX (dans la table &quot;Unix attributes&quot; de l&#039;ADUC…Active Directory Users and Computers). Il est plus simple de l&#039;activer durant cette initialisation (Provisioning), plutôt que par la suite. De plus, même si vous n&#039;en avez pas (encore) besoin, ça n&#039;impacte pas votre installation.
Notes importantes sur cette initialisation :
</p>
<ul>
<li class="level1"><div class="li"> La commande d&#039;initialisation utilise le serveur <abbr title="Domain Name System">DNS</abbr> interne de Samba par défaut. Si vous souhaitez utiliser Bind comme serveur <abbr title="Domain Name System">DNS</abbr> d&#039;arrière-plan, ajouter –dns-backend=BIND9_DLZ dans les options de commande. Cette décision est réversible. Vous pouvez changer de serveur arrière-plan à tout moment.</div>
</li>
<li class="level1"><div class="li"> Si vous ré-exécutez cette initialisation (provisioning), il est nécessaire de supprimer le fichier : <pre class="code">/usr/local/samba/etc/smb.conf </pre>

<p>
 et éventuellement la base si elle a été généré, par : 
</p>
<pre class="code">rm -rf /usr/local/samba/private/*</pre>
</div>
</li>
<li class="level1"><div class="li"> Le mot de passe d&#039;administration doit correspondre aux règles établies, à savoir : au moins une majuscule, un chiffre et 8 caractères de long. Si vous ne spécifiez pas un mot de passe correspondant à ces critères, le script de configuration échouera et vous devrez recommencer avec un mot de passe correcte après avoir supprimé le contenu des répertoires suivants: <pre class="code">remove /usr/local/samba/private/ et /usr/local/samba/etc/</pre>
</div>
</li>
<li class="level1"><div class="li"> Si votre site web est exemple.fr, le domaine de votre AD devrait être un sous-domaine, tel que sousdomain.exemple.fr (ou ad.exemple.fr…). Évitez d&#039;utiliser exemple.fr en interne.</div>
</li>
</ul>

</div>

<h3 class="sectionedit9" id="mise_a_jour_depuis_un_domaine_samba_de_type_nt4_vers_un_ad">Mise à jour depuis un domaine Samba de type NT4 vers un AD</h3>
<div class="level3">

<p>
Si vous prévoyez la migration depuis un domain Samba NT4 existant vers un domaine Samba AD, reportez-vous à Classicupgrade HowTo (<a href="http://wiki.samba.org/index.php/Samba4/samba-tool/domain/classicupgrade/HOWTO" class="urlextern" title="http://wiki.samba.org/index.php/Samba4/samba-tool/domain/classicupgrade/HOWTO"  rel="nofollow">http://wiki.samba.org/index.php/Samba4/samba-tool/domain/classicupgrade/HOWTO</a>)
</p>

</div>

<h3 class="sectionedit10" id="demarrer_votre_ad_dc_samba">Démarrer votre AD DC Samba</h3>
<div class="level3">

<p>
Note: si vous des services smbd, nmbd ou winbind d&#039;une précédente installation, il est nécessaire de les arrêter avant de démarrer samba
Si vous prévoyez d&#039;utiliser samba comme serveur de production, tapez simplement :
</p>
<pre class="code"> /usr/local/samba/sbin/samba</pre>

<p>
Cela démarre samba en mode &#039;standard&#039;, ce qui est préconise en mode production.<br/>

Pour le démarrage automatique au démarrage du serveur, Samba ne dispose pas encore de scripts d&#039;initialisation pour ubuntu, mais il y a des exemples de scripts sur la <a href="https://wiki.samba.org/index.php/Samba4/InitScript" class="urlextern" title="https://wiki.samba.org/index.php/Samba4/InitScript"  rel="nofollow"> page Init-Script</a> de Samba4.
Si vous exécutez samba a des fin de développement, exécuter :
</p>
<pre class="code"> /usr/local/samba/sbin/samba -i -M single</pre>

<p>
Cela démarrera Samba avec tous les messages log vers stdout, limite a un seul processus. Ce mode permet un débogage de Samba avec gdb :
</p>
<pre class="code"> gdb --args /usr/local/samba/sbin/samba -i -M single</pre>

</div>

<h3 class="sectionedit11" id="test_de_connexion_a_votre_controleur_de_domaine_ad_samba">Test de connexion a votre contrôleur de domaine AD Samba</h3>
<div class="level3">

<p>
Vérifiez tout d&#039;abord que vous avez la bonne version de smbclient en tapant :
</p>
<pre class="code"> /usr/local/samba/bin/smbclient --version</pre>

<p>
Cela doit retourner un version commençant par &quot;Version 4.x&quot;
Exécutez ensuite la ligne suivante pour lister les partages définis sur votre serveur:
</p>
<pre class="code"> /usr/local/samba/bin/smbclient -L localhost -U%

       Sharename       Type      Comment
       ---------       ----      -------
       netlogon        Disk
       sysvol          Disk
       IPC$            IPC       IPC Service (Samba 4.x.y)</pre>

<p>
le retour doit être similaire aux informations ci-dessus. Les partages netlogon et sysvol sont par défaut sur un serveur Active Directory et crée dans votre fichier de configuration smb.conf lors de la configuration initiale (provisioning) ou mise a jour.
Si la commande échoue, redémarrer samba :
</p>
<pre class="code"> killall samba
 /usr/local/samba/sbin/samba</pre>

<p>
Pour vérifier que l&#039;authentification fonctionne, vous devez essayer de vous connecter au partage netlogon en utilisant le compte Administrateur crée durant le configuration initial (provisioning). Le retour doit être similaire aux informations ci-dessous:
</p>
<pre class="code"> smbclient //localhost/netlogon -UAdministrator% -c &#039;ls&#039;

Domain=[SAMDOM] OS=[Unix] Server=[Samba 4.x.y]
  .                                   D        0  Tue Dec 11 20:00:00 2012
  ..                                  D        0  Tue Dec 11 20:00:00 2012</pre>

</div>

<h3 class="sectionedit12" id="configuration_du_serveur_dns">Configuration du serveur DNS</h3>
<div class="level3">

<p>
Une configuration fonctionnelle du <a href="../../dns" class="wikilink1" title="dns">DNS</a> est essentielle pour assurer le bon fonctionnement de Samba et de l&#039;AD. Sans les bons paramètres, Kerberos ne fonctionnera pas, entraînant le non-fonctionnement de services de base! Une configuration hâtive, non fonctionnelle, vous fera perdre du temps pour définir la cause des dysfonctionnement du <abbr title="Domain Name System">DNS</abbr>. Pour gérer les paramètres <abbr title="Domain Name System">DNS</abbr>, vous pouvez utilisez l&#039;utilitaire samba-tool (voire l&#039;outil MMC <abbr title="Domain Name System">DNS</abbr> de Windows). Pour plus d&#039;information, consulter <a href="https://wiki.samba.org/index.php/DNS_Administration" class="urlextern" title="https://wiki.samba.org/index.php/DNS_Administration"  rel="nofollow">DNS Administration </a> et <a href="https://wiki.samba.org/index.php/Samba_AD_management_from_windows" class="urlextern" title="https://wiki.samba.org/index.php/Samba_AD_management_from_windows"  rel="nofollow"> administrer Samba AD depuis windows </a>
</p>

</div>

<h4 id="dns_backends">DNS Backends</h4>
<div class="level4">

<p>
Pour plus d&#039;information sur la configuration du serveur <abbr title="Domain Name System">DNS</abbr> et trouver celle qui répond à vos besoins, consultez la page <a href="https://wiki.samba.org/index.php/DNS#Which_DNS_backend_should_I_choose.3F" class="urlextern" title="https://wiki.samba.org/index.php/DNS#Which_DNS_backend_should_I_choose.3F"  rel="nofollow"> DNS</a><br/>

Lors de l&#039;initialisation, il vous est proposé quatre choix comme &quot;<abbr title="Domain Name System">DNS</abbr> Backend&quot; : SAMBA_INTERNAL (par défaut), BIND9_FLATFILE (obsolète?), BIND9_DLZ (si vous mettez en place un serveur <abbr title="Domain Name System">DNS</abbr> avec BIND), NONE (si, c&#039;est possible!).
</p>

</div>

<h5 id="serveur_dns_interne_a_samba_samba_internal">Serveur DNS interne à samba (SAMBA_INTERNAL)</h5>
<div class="level5">

<p>
Par défaut, Samba utilise son propre serveur <abbr title="Domain Name System">DNS</abbr> interne et aucune configuration supplémentaire n&#039;est nécessaire.<br/>

Il est souvent nécessaire de définir le serveur <abbr title="Domain Name System">DNS</abbr> vers lequel renvoyer les demandes qui ne sont pas du ressort du <abbr title="Domain Name System">DNS</abbr> interne, pour cela ajouter :
</p>
<pre class="code"> dns forwarder = {adresse IP du serveur DNS vers lequel transmettre}</pre>

<p>
 dans votre fichier smb.con puis redémarrer Samba.<br/>

Nota : cette ligne peut avoir été renseignée durant l&#039;initialisation (provisioning) !
</p>

<p>
Pour que le serveur <abbr title="Domain Name System">DNS</abbr> interne puisse fonctionner, le port 53 udp/tcp ne doit pas être utilisé par d&#039;autres programmes (tel qu&#039;un autre serveur <abbr title="Domain Name System">DNS</abbr>, Dnsmasq, etc…). Vous aurez des erreurs dans le logfile si Samba ne peut utiliser le port 53, telle que :
</p>
<pre class="code"> Failed to bind to 0.0.0.0:53 TCP - NT_STATUS_ADDRESS_ALREADY_ASSOCIATED </pre>

<p>
Pour vérifier quel programme est sur le port 53, exécuter avec les droit d&#039;administrateur :
</p>
<pre class="code"> netstat -tunpe | grep &quot;:53&quot; </pre>

</div>

<h5 id="interfacage_avec_un_serveur_bind_bind9_dlz">Interfaçage avec un serveur BIND (BIND9_DLZ)</h5>
<div class="level5">

<p>
Si vous choisissez <a href="http://bind-dlz.sourceforge.net/" class="urlextern" title="http://bind-dlz.sourceforge.net/"  rel="nofollow">BIND9_DLZ</a> lors de votre initialisation (provisioning), référez-vous au wiki <a href="http://wiki.samba.org/index.php/Samba_AD_DC_HOWTO#BIND_as_DNS_backend" class="urlextern" title="http://wiki.samba.org/index.php/Samba_AD_DC_HOWTO#BIND_as_DNS_backend"  rel="nofollow">the Bind as DNS backend HowTo</a> pour connaître les instructions à suivre. Vous trouverez aussi plus d&#039;informations sur le wiki pour la configuration de BIND en général et comment le configurer pour l&#039;utiliser avec Samba AD. Si vous avez initialiser avec le <abbr title="Domain Name System">DNS</abbr> interne, vous pouvez <a href="http://wiki.samba.org/index.php/DNS#Changing_from_Internal_DNS_to_BIND" class="urlextern" title="http://wiki.samba.org/index.php/DNS#Changing_from_Internal_DNS_to_BIND"  rel="nofollow">basculer vers BIND</a> lorsque cela est nécessaire. 
</p>

</div>

<h4 id="configuration_du_fichieretcresolvconf">Configuration du fichier /etc/resolv.conf</h4>
<div class="level4">

<p>
Pour résoudre les recherches local de <abbr title="Domain Name System">DNS</abbr>, il est nécessaire de modifier le fichier /etc/resolv.conf. L&#039;exemple suivant doit être suffisant pour résoudre le <abbr title="Domain Name System">DNS</abbr> correctement (adapter au domaine et adresse IP dans votre environnement): 
</p>
<pre class="code">domain samdom.example.com
nameserver 192.168.1.1</pre>

</div>

<h4 id="tests_du_serveur_dns">Tests du serveur DNS</h4>
<div class="level4">

</div>

<h3 class="sectionedit13" id="configuration_de_kerberos">Configuration de Kerberos</h3>
<div class="level3">

<p>
Si vous ne connaissez pas le fonctionnement de Kerberos, voici un lien pour vous éclairer :<br/>
<a href="http://irp.nain-t.net/doku.php/320kerberos:start" class="urlextern" title="http://irp.nain-t.net/doku.php/320kerberos:start"  rel="nofollow">http://irp.nain-t.net/doku.php/320kerberos:start</a><br/>

La configuration de Kerberos se trouve dans le fichier krb5.conf. Ce fichier doit être déposé dans le répertoire /etc<br/>

Lors de l&#039;initialisation, ce fichier est créé et déposé dans /usr/loca/samba/share/setup/krb5.conf. Son contenu par défaut est :
</p>
<pre class="code">[libdefaults]
        default_realm = ${REALM}
        dns_lookup_realm = false
        dns_lookup_kdc = true</pre>

<p>
Note : si vous avez oublié votre nom de &quot;royaume&quot;, exécutez 
</p>
<pre class="code">/usr/local/samba/bin/samba-tool testparm --suppress-prompt | grep realm</pre>

</div>

<h4 id="tests_de_kerberos">Tests de Kerberos</h4>
<div class="level4">

<p>
Le test le plus simple est d&#039;utiliser la commande <em>kinit</em> comme cela:
</p>
<pre class="code"> kinit administrateur@SAMDOM.EXAMPLE.COM </pre>

<p>
Note: vous devez saisir le nom de &quot;royaume&quot; en <strong>lettres majuscules !</strong>
</p>

<p>
Note: selon la distribution, kinit peut juste retourner un prompt, mais sous certaines distributions le retour est du type 
</p>
<pre class="code">Warning: Your password will expire in x days on ...  </pre>

<p>
(Attention: votre mot de passe expirera dans x jours, le… )
</p>

<p>
Pour vérifier quelle version de Kerberos est utilisée, et qu&#039;elle vous retourne un ticket, taper :
</p>
<pre class="code">klist
Ticket cache: FILE:/tmp/krb5cc_1000
Default principal: administrator@SAMDOM.EXAMPLE.COM
 
Valid starting     Expires            Service principal
02/10/13 19:39:48  02/11/13 19:39:46  krbtgt/SAMDOM.EXAMPLE.COM@SAMDOM.EXAMPLE.COM</pre>

<p>
Si ni <em>kinit</em> ni <em>klist</em> n&#039;existe sur votre système, référez-vous à la page <a href="http://wiki.samba.org/index.php/Samba_4_OS_Requirements" class="urlextern" title="http://wiki.samba.org/index.php/Samba_4_OS_Requirements"  rel="nofollow">Samba_4_OS_Requirements</a> ou au début de ce document.
</p>

<p>
Vous pouvez aussi tester Kerberos à partir d&#039;un poste client, mais vous devez tout d&#039;abord configurer le fichier krb5.conf and resolve.conf du poste client comme illustré ci-dessus.
</p>

<p>
Note: Si vous utilisez un poste client derrière un serveur <abbr title="Network Address Translation">NAT</abbr> vous devez ajouter la ligne suivante dans le fichier krb5.conf du contrôleur de domaine: 
</p>
<pre class="code">[kdc]
        check-ticket-addresses = false</pre>

<p>
Note: Si l&#039;initialisation (provisionning) génère un mot de passe et que vous le perdez, vous pouvez utilisez <em>samba-tool user setpassword administrator</em> en administrateur pour le réinitialiser.
</p>

</div>

<h3 class="sectionedit14" id="configuration_ntp">Configuration NTP</h3>
<div class="level3">

<p>
Active Directory nécessite une synchronisation de temps précise entre les postes clients et le(s) DC(s). Il est vivement recommandé de mettre en œuvre le protocole <a href="../../ntp" class="wikilink1" title="ntp">NTP</a> ou tout autre solution de synchronisation. La page <a href="https://wiki.samba.org/index.php/Configure_NTP" class="urlextern" title="https://wiki.samba.org/index.php/Configure_NTP"  rel="nofollow">Configure NTP</a> donne les indications de configuration du <abbr title="Network Time Protocol">NTP</abbr> avec la stratégie (policy) <a href="https://fr.wikipedia.org/wiki/SELinux" class="urlextern" title="https://fr.wikipedia.org/wiki/SELinux"  rel="nofollow">SELinux</a>. 
</p>

</div>

<h2 class="sectionedit15" id="informations_optionnelles_et_complementaires">Informations optionnelles et complémentaires</h2>
<div class="level2">

<p>
Le wiki Samba (en anglais) met à disposition de nombreuses documentations complémentaires <br/>

pour l&#039;administration de votre DC : 
<a href="https://wiki.samba.org/index.php/Backup_and_Recovery" class="urlextern" title="https://wiki.samba.org/index.php/Backup_and_Recovery"  rel="nofollow">Sauvegarde et restauration</a>
<a href="https://wiki.samba.org/index.php/Setup_and_configure_file_shares" class="urlextern" title="https://wiki.samba.org/index.php/Setup_and_configure_file_shares"  rel="nofollow">Configuration des partages de fichiers</a>
…<br/>

pour les tâches &quot;quotidiennes&quot; :
<a href="https://wiki.samba.org/index.php/Configuring_a_windows_client_for_AD" class="urlextern" title="https://wiki.samba.org/index.php/Configuring_a_windows_client_for_AD"  rel="nofollow"> Configurer un client windows</a>
<a href="https://wiki.samba.org/index.php/Samba_AD_management_from_windows" class="urlextern" title="https://wiki.samba.org/index.php/Samba_AD_management_from_windows"  rel="nofollow"> Gérer Samba AD depuis windows</a>
…<br/>

et aussi
<a href="https://wiki.samba.org/index.php/Authenticating_other_services_against_AD" class="urlextern" title="https://wiki.samba.org/index.php/Authenticating_other_services_against_AD"  rel="nofollow"> Authentifier d&#039;autres services avec l&#039;AD</a> notamment Apache, SSH,…
</p>

<p>
Des réflexions sur <a href="https://fr.wikipedia.org/wiki/SELinux" class="urlextern" title="https://fr.wikipedia.org/wiki/SELinux"  rel="nofollow"> SELinux</a> et les permissions de contrôle d&#039;accès pouvant prévenir des connexions utilisant l&#039;AD, sont disponibles sur la page <a href="https://wiki.samba.org/index.php/Samba_AD_DC_access_control_settings" class="urlextern" title="https://wiki.samba.org/index.php/Samba_AD_DC_access_control_settings"  rel="nofollow"> Paramétrages contrôle d&#039;accès Samba AD DC</a>.
</p>

<p>
Reportez-vous la <a href="https://wiki.samba.org/index.php/Samba" class="urlextern" title="https://wiki.samba.org/index.php/Samba"  rel="nofollow"> documentations utilisateur du wiki samba</a> pour plus d&#039;informations et tutoriels.
</p>

</div>

<h2 class="sectionedit16" id="remonter_vos_succesechecs">Remonter vos succès/échecs</h2>
<div class="level2">

<p>
<em>Contributeur principal :</em> <a href="http://doc.ubuntu-fr.org/utilisateurs/bcag2" class="wikilink1" title="utilisateurs:bcag2">bcag2</a>
</p>

</div>

<!-- cachefile /srv/www/doc.ubuntu-fr.org/htdocs/data/cache/a/aba446ecf09110ee061dd3023221c340.xhtml used -->

        <br style="clear:both;" />
        <div id="pageinfo">
            <!--  |  | -->
            <!-- ?tpl_pageinfo()? -->
            <br />
            Le contenu de ce wiki est sous licence : <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" rel="license" target="_blank">CC BY-SA v3.0</a>
        </div> 
      </div>

      
      <div id="navigation">

        <ul>
          <li class="menu"><a href="http://www.ubuntu-fr.org" class="title" id="menu-accueil"><span>Accueil</span></a></li>
          <li class="menu" id="active">
            <a href="../../index.html"  class="title" id="menu-doc"><span>Documentation</span></a>
            <ul>
              <li id="navWiki" class="cat">
                <h2>Actions</h2>
                <ul>
                  <li><a href="http://doc.ubuntu-fr.org/utilisateurs/bcag2/samba4?do=index"  class="action index" accesskey="x" rel="nofollow" title="Plan du site [X]">Plan du site</a></li>
                  <li><a href="http://doc.ubuntu-fr.org/utilisateurs/bcag2/samba4?do=edit&amp;rev=0"  class="action source" accesskey="v" rel="nofollow" title="Afficher le texte source [V]">Afficher le texte source</a></li>
                  <li><a href="http://doc.ubuntu-fr.org/utilisateurs/bcag2/samba4?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]">Anciennes révisions</a></li>
                  <li></li>
                  <li><a href="http://doc.ubuntu-fr.org/utilisateurs/bcag2/samba4?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Derniers changements [R]">Derniers changements</a></li>
                  <li><a href="http://doc.ubuntu-fr.org/utilisateurs/bcag2/samba4?do=backlink"  class="action backlink" rel="nofollow" title="Liens vers cette page">Liens vers cette page</a></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </li>
              <li id="navDivers" class="cat">
                <h2>Divers</h2>
                <ul>
                  <li><bdi><a href="../../wiki/participer_wiki" class="wikilink1" title="wiki:participer_wiki">Participer à la documentation</a></bdi></li>
                  <li><bdi><a href="../../documentation_hors_ligne" class="wikilink1" title="documentation_hors_ligne">Documentation hors ligne</a></bdi></li>
                  <li><a href="http://www.ubuntu-fr.org/telechargement" title="T&eacute;l&eacute;charger Ubuntu">T&eacute;l&eacute;charger Ubuntu</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li class="menu"><a href="http://forum.ubuntu-fr.org"  class="title" id="menu-forum"><span>Forum</span></a></li>
          <li class="menu"><a href="http://planet.ubuntu-fr.org"  class="title" id="menu-planet"><span>Planet</span></a></li>
        </ul>

      </div>
      <div id="references-ufr">
        <ul id="legal-ufr">
          <li><a href="http://www.ubuntu-fr.org/contacts">Contact</a></li>
        </ul>

        <ul id="sponsors-ufr">
          <li><a href="http://www.dokuwiki.org/dokuwiki" id="dokuwiki">Propulsé par Dokuwiki</a></li>
        </ul>
      </div>

    </div>
    <!-- $Id$ -->

    <!-- Piwik Image Tracker -->
    <!-- img src="http://piwik.infra.ubuntu-fr.org/piwik.php?idsite=2&amp;rec=1" style="border:0" alt="" /-->
    <!-- End Piwik -->

  </body>
</html>
