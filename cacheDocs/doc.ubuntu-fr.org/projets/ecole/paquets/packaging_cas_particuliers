<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr" dir="ltr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Script-Type" content="text/javascript"/>
    <meta http-equiv="Content-Style-Type" content="text/css"/>
    <meta http-equiv="Content-Language" content="fr"/>
    <title>projets:ecole:paquets:packaging_cas_particuliers - Documentation Ubuntu Francophone</title>
    <meta name="Description" content="Documentation francophone pour la distribution Ubuntu" lang="fr" />
    <meta name="language" content="fr-FR" />

    <!--[if IE 8]>
    <meta http-equiv="X-UA-Compatible" content="IE=8" />
    <![endif]-->
        <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2011-12-15T15:17:31+0100"/>
<meta name="keywords" content="paquet,programmation"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../../lib/exe/opensearch.php" title="Documentation Ubuntu Francophone"/>
<link rel="start" href="../../../index.html"/>
<link rel="contents" href="http://doc.ubuntu-fr.org/projets/ecole/paquets/packaging_cas_particuliers?do=index" title="Plan du site"/>
<link rel="alternate" type="application/rss+xml" title="Derniers changements" href="../../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Namespace actuel" href="http://doc.ubuntu-fr.org/feed.php?mode=list&amp;ns=projets:ecole:paquets"/>
<link rel="alternate" type="text/html" title="HTML brut" href="http://doc.ubuntu-fr.org/_export/xhtml/projets/ecole/paquets/packaging_cas_particuliers"/>
<link rel="alternate" type="text/plain" title="Wiki balise" href="http://doc.ubuntu-fr.org/_export/raw/projets/ecole/paquets/packaging_cas_particuliers"/>
<link rel="canonical" href="packaging_cas_particuliers"/>
<link rel="stylesheet" type="text/css" href="../../../lib/exe/css.php?t=ubuntu-2010&amp;tseed=4af22dedc19f28c99fa67afabbb173df"/>
<script type="text/javascript">/*<![CDATA[*/var NS='projets:ecole:paquets';var JSINFO = {"id":"projets:ecole:paquets:packaging_cas_particuliers","namespace":"projets:ecole:paquets"};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../../lib/exe/js.php?tseed=4af22dedc19f28c99fa67afabbb173df"></script>
    <link rel="shortcut icon" href="http://www-static.ubuntu-fr.org/theme2010/images/commun/ubuntu/icone.png" type="image/x-icon" />
    <link rel="apple-touch-icon" href="http://www-static.ubuntu-fr.org/theme2010/images/commun/ubuntu/touch-ico.png" />

    <link rel="stylesheet" media="screen" type="text/css" title="Design Ubuntu-fr" href="http://www-static.ubuntu-fr.org/theme2010/css/doc.css" />
    <link rel="stylesheet" media="screen" type="text/css" title="Design Ubuntu-fr" href="http://www-static.ubuntu-fr.org/theme2010/css/doc-ubuntu.css" />
    <link rel="stylesheet" media="print" type="text/css" title="Design Ubuntu-fr" href="http://www-static.ubuntu-fr.org/theme2010/css/doc-print.css" />

    <script type="text/javascript">
      var menu_hidden;
      var static_url = "UFR_STATIC";
    </script>
    <script src="http://www-static.ubuntu-fr.org/theme2010/js/menu.js" type="text/javascript"></script>
    <script src="http://www-static.ubuntu-fr.org/theme2010/js/common.js" type="text/javascript"></script>
  </head>
  <body>

    <div id="accessibar">
      <a href="packaging_cas_particuliers#main" tabindex="1">Contenu</a> | <a href="packaging_cas_particuliers#qsearch__in" tabindex="2">Rechercher</a> | <a href="packaging_cas_particuliers#navigation" tabindex="3">Menus</a>
    </div>

    <div id="page">

      <div id="header">

        <div id="logo">
          <h1>Ubuntu-fr</h1>
          <a href="../../../index.html" title="Accueil de la documentation">Communauté francophone d'utilisateurs d'Ubuntu</a>
        </div>

        <form action="http://ubuntu-fr.org/recherche" accept-charset="utf-8" id="search" onsubmit="if (document.getElementById('qsearch__in').value == 'Recherche rapide....') {document.getElementById('qsearch__in').value = '';}">
          <fieldset>
            <label for="qsearch__in">Recherche : </label><input type="text" value="Recherche rapide...." id="qsearch__in" accesskey="f" name="sk_q" alt="[F]" size="34" tabindex="4" />
            <label for="tsearch_field">Chercher dans : </label><select name="sk_engine" tabindex="5" id="tsearch_field" title="Chercher dans">
              <option value="all">Site</option>
              <option selected="selected" value="doc">Documentation</option>
              <option value="forum">Forum</option>
              <option value="planet">Planet</option>
            </select>
            <input type="submit" value="ok" class="button" alt="Lancer la recherche" tabindex="5" />
          </fieldset>
        </form>
        <!--[if lte IE 7]><div class="clear"></div><![endif]-->

        <form action="packaging_cas_particuliers" accept-charset="utf-8" id="login_top" method="post">
          <fieldset>
            <label for="u_field">Identifiant : </label><input type="text" value="Identifiant" name="u" id="u_field" size="9" /><label for="p_field">Mot de passe : </label><input type="password" value="Mot de passe" name="p" id="p_field" size="9" alt="Mot de passe" /><input type="submit" value="connexion" id="connect" /> / <a href="http://forum.ubuntu-fr.org/register.php">inscription</a>
          </fieldset>
        </form>
 

      </div>

      <div id="navbar">
          <h2 id="pagetitle"><a href="packaging_cas_particuliers" >projets:ecole:paquets:packaging_cas_particuliers</a></h2>
      </div>

      
      <div id="main" class="dokuwiki">

        <div id="hidemenu" title="Masquer le menu"></div>

        <div id="pagerror"></div>
                <!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table des matières</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="packaging_cas_particuliers#pre-requis">Pré-requis</a></div></li>
<li class="level1"><div class="li"><a href="packaging_cas_particuliers#empaqueter_un_paquet_ne_necessitant_pas_de_compilation">Empaqueter un paquet ne nécessitant pas de compilation</a></div></li>
<li class="level1"><div class="li"><a href="packaging_cas_particuliers#mettre_a_jour_un_paquet_grace_a_debianwatch">Mettre à jour un paquet grâce à debian/watch</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="packaging_cas_particuliers#precisions_sur_le_fichier_debianwatch">Précisions sur le fichier &#039;&#039;debian/watch&#039;&#039;</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="packaging_cas_particuliers#empaqueter_un_logiciel_en_python">Empaqueter un logiciel en Python</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="packaging_cas_particuliers#pycompat">pycompat</a></div></li>
<li class="level2"><div class="li"><a href="packaging_cas_particuliers#control">control</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="packaging_cas_particuliers#patcher_des_sources">Patcher des sources</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="packaging_cas_particuliers#paquet_utilisant_debhelper">Paquet utilisant Debhelper</a></div></li>
<li class="level2"><div class="li"><a href="packaging_cas_particuliers#paquet_utilisant_cdbs">Paquet utilisant CDBS</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="packaging_cas_particuliers#liens">Liens</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->
<div class="tags"><span>
	<a href="../../../paquet" class="wikilink1" title="paquet" rel="tag">paquet</a>,
	<a href="../../../programmation" class="wikilink1" title="programmation" rel="tag">programmation</a>
</span></div>
<hr />

<h1 class="sectionedit1" id="cas_particuliers_d_empaquetage">Cas particuliers d&#039;empaquetage</h1>
<div class="level1">

<p>
<em>Cette page est le compte-rendu de la session classroom organisée par  <a href="http://doc.ubuntu-fr.org/utilisateurs/gloubiboulga" class="wikilink2" title="utilisateurs:gloubiboulga" rel="nofollow">gpocentek</a> le 17 mai 2007 sur le canal <abbr title="Internet Relay Chat">IRC</abbr> #ubuntu-fr-classroom.</em>
</p>

<p>
Dans ce cours, nous verrons :
</p>
<ul>
<li class="level1"><div class="li"> logiciels ne nécessitant pas de compilation</div>
</li>
<li class="level1"><div class="li"> mise à jour de paquets à partir de <code>debian/watch</code></div>
</li>
<li class="level1"><div class="li"> paquets avec python</div>
</li>
<li class="level1"><div class="li"> patcher des sources</div>
</li>
</ul>

</div>

<h2 class="sectionedit2" id="pre-requis">Pré-requis</h2>
<div class="level2">

<p>
Pour suivre ce cours, vous devez connaître les bases du packaging avec <a href="../../../tutoriel/creer_un_paquet" class="wikilink1" title="tutoriel:creer_un_paquet">debhelper</a> et <a href="http://doc.ubuntu-fr.org/projets/paquets/creer_un_paquet_avec_cdbs" class="wikilink1" title="projets:paquets:creer_un_paquet_avec_cdbs">cdbs</a>. Nous ne reviendrons donc pas sur ce qui a été vu dans les sessions précédentes sauf sur le fichier <code>debian/rules</code>.
</p>

<p>
<p><div class="notehelp">
<strong>Petit rappel sur le fichier debian/rules</strong><br/>

Le fichier <em>debian/rules</em> est le script (un Makefile) qui permet de construire le paquet. Même si la plupart du temps il passe par une étape de compilation des sources, ce n&#039;est pas une nécessité. Si le logiciel que vous empaquetez n&#039;a pas besoin d&#039;être compilé, vous n&#039;avez pas besoin que le debian/rules ne compile quelque chose. C&#039;est le cas pour un script bash, ou pour un programme python par exemple.
</p>

<p>
Le but de ce fichier est en fait d&#039;installer les fichiers du logiciel dans <code><strong>debian/paquet</strong></code>. Par exemple, si vous récupérez sur Internet un script <code><strong>foo.sh</strong></code>,  il suffit de copier ce fichier dans <code><strong>debian/foo/usr/bin/</strong></code> pour créer le paquet.

</div></p>
</p>

</div>

<h2 class="sectionedit3" id="empaqueter_un_paquet_ne_necessitant_pas_de_compilation">Empaqueter un paquet ne nécessitant pas de compilation</h2>
<div class="level2">

<p>
Tout d&#039;abord, créez un répertoire propre (<code>~/packaging/classroom</code> par exemple) pour éviter les soucis, placez-vous dedans et récupérez l&#039;archive suivante :
</p>
<pre class="code">wget http://gauvain.pocentek.net/u-classroom/2007-05-17/packages/u-script.tar.gz
tar xvf u-script.tar.gz</pre>

<p>
Entrer dans le dossier &quot;u-script/&quot; puis exécutez :
</p>
<pre class="code">dpkg-source -x *dsc</pre>

<p>
Entrez dans le dossier source (venant d&#039;être crée) qui contient le dossier <strong>debian/</strong> pour le paquet, et le script <strong>u-script.sh</strong>. Il n&#039;y a rien d&#039;autre, en particulier pas de <em>Makefile</em> ou autre donc cela va être au packageur de gérer l&#039;installation (en respectant les standards).
</p>

<p>
Le dossier <strong>debian</strong> contient :
</p>
<pre class="file">changelog  compat  control  copyright  dirs  install  rules  u-classroom  watch</pre>

<p>
Les fichiers qui vont nous intéresser sont <em>dirs</em>, <em>install</em>, <em>rules</em>, <em>u-classroom</em> et <em>watch</em>.
</p>

<p>
Le but est donc :
</p>
<ul>
<li class="level1"><div class="li"> d&#039;installer le script source dans <strong>/usr/share/u-classroom/</strong></div>
</li>
<li class="level1"><div class="li"> d&#039;installer <em>debian/u-classroom</em> (qui est un wrapper) dans <strong>/usr/bin</strong></div>
</li>
</ul>

<p>
<p><div class="notehelp">A quoi sert un <strong>wrapper</strong> :<br/>

Dans le cadre de ce cours, cela ne sert pas à grand chose mais pour beaucoup de script, le script doit être dans le même dossier que les données ce qui signifie l&#039;installer dans &quot;<strong>/usr/share/&lt;paquet&gt;</strong> avec les images ou autre.<br/>

Dans ce cas, le script n&#039;est pas directement accessible puisqu&#039;il n&#039;est pas placé dans <strong>/usr/bin</strong>. Le wrapper sert juste d&#039;intermédiaire entre le script original installé ou il faut et &quot;l&#039;interface utilisateur&quot; (i.e. lancement du script facilement en console)

</div></p>
</p>

<p>
<strong>Comment installer ces 2 fichiers ?</strong><br/>

Les fichiers <em>debian/dirs</em> et <em>debian/install</em> servent à cela et ils sont respectivement utilisés par <em>dh_installdirs</em> et <em>dh_install</em>.
</p>

<p>
<strong>Le fichier <em>debian/rules</em> :</strong><br/>

Nous pouvons déjà remarquer qu&#039;il n&#039;y a pas de cible <code>&quot;configure:&quot;</code>. En effet, c&#039;est inutile puisqu&#039;il n&#039;y a rien à configurer.<br/>

Il y a une cible <code>&quot;build:&quot;</code>, qui ne fait rien (rien à compiler) mais elle <em class="u">doit</em> être là (respect de la debian policy).<br/>

Par contre la règle <code>&quot;install:&quot;</code> s&#039;occupe d&#039;installer les fichiers :
<em>dh_installdirs</em> va lire le fichier <em>debian/dirs</em> et créer les dossiers nécessaires dans &quot;debian/u-classroom/&quot; (dans notre cas &quot;usr/bin/&quot; et &quot;usr/share/u-classroom/&quot;).
</p>

<p>
Lancer le debuild du paquet pour construire le paquet source :
</p>
<pre class="code">debuild -us -uc</pre>

<p>
Fin de cette partie :)
</p>

</div>

<h2 class="sectionedit4" id="mettre_a_jour_un_paquet_grace_a_debianwatch">Mettre à jour un paquet grâce à debian/watch</h2>
<div class="level2">

<p>
Reprenez l&#039;exemple précédent.
</p>

<p>
Dans le dossier source (u-script-1.0/) Lancez :
</p>
<pre class="code">uscan</pre>

<p>
En regardant dans le répertoire parent
</p>
<pre class="code">ls ..</pre>

<p>
vous voyez que la version 0.2 a été téléchargée et l&#039;archive des sources est présente avec un lien vers <code>u-script_0.2.orig.tar.gz</code>.<br/>

Nous allons nous servir de cela pour mettre à jour le paquet.
</p>

<p>
Restez dans le répertoire source (u-script-1.0/) et lancez :
</p>
<pre class="code">uupdate ../u-script_0.2.orig.tar.gz</pre>

<p>
Puis placez vous de le répertoire nouvellement crée, comme le suggère le script
</p>
<pre class="code">cd ../u-script-0.2</pre>

<p>
Enfin, construisez le paquet source
</p>
<pre class="code">debuild -us -uc</pre>

<p>
Le paquet est mis à jour :)
</p>

<p>
<p><div class="noteimportant">
<strong>ATTENTION</strong>, <em>uupdate</em> n&#039;est pas une formule magique !<br/>

Tout est à revérifier pour une nouvelle version d&#039;un paquet : vérifier que la licence n&#039;a pas changé, que des fichiers n&#039;ont pas été ajoutés…

</div></p>
</p>

</div>

<h3 class="sectionedit5" id="precisions_sur_le_fichier_debianwatch">Précisions sur le fichier &#039;&#039;debian/watch&#039;&#039;</h3>
<div class="level3">

<p>
Il est composé de 2 lignes :
</p>
<pre class="file">version=3</pre>

<p>
qui doit toujours être à cette valeur, et
</p>
<pre class="file">http://gauvain.pocentek.net/u-classroom/2007-05-17/archive/u-script-(.*)\.tar\.gz</pre>

<p>
Le répertoire où se trouvent les sources est donc <strong><a href="http://gauvain.pocentek.net/u-classroom/2007-05-17/archive" class="urlextern" title="http://gauvain.pocentek.net/u-classroom/2007-05-17/archive"  rel="nofollow">http://gauvain.pocentek.net/u-classroom/2007-05-17/archive</a></strong> et
la fin de la ligne est une expression régulière qui laisse le choix pour la version. Les &#039;<strong>.</strong>&#039; dans les regexp sont des caractères particuliers donc ils doivent être &quot;échappés&quot; d&#039;où le &#039;<strong>\</strong>&#039; devant.
</p>

<p>
Pour plus d&#039;informations sur <strong>uscan</strong> et ses recettes magiques :
</p>
<pre class="code">man uscan</pre>

</div>

<h2 class="sectionedit6" id="empaqueter_un_logiciel_en_python">Empaqueter un logiciel en Python</h2>
<div class="level2">

<p>
En fait, empaqueter du python c&#039;est comme empaqueter n&#039;importe quoi mais il y a quelques règles à respecter : la fameuse <a href="http://www.debian.org/doc/packaging-manuals/python-policy/" class="urlextern" title="http://www.debian.org/doc/packaging-manuals/python-policy/"  rel="nofollow">Python Policy</a>.
</p>

<p>
Pour suivre ce cours, récupérez l&#039;archive suivante :
</p>
<pre class="code">wget http://gauvain.pocentek.net/u-classroom/2007-05-17/packages/pyhw.tar.gz</pre>

<p>
Il y a 4 versions du même paquet dans ce paquet source et nous allons commencer avec la version 1.<br/>

Pour cela :
</p>
<pre class="code">tar zxvf pyhw.tar.gz
cd pyhw/v1
dpkg-source -x *dsc</pre>

<p>
Tout va se passer dans les fichiers <em>control</em>, <em>rules</em> et <em>pycompat</em>.
</p>

</div>

<h3 class="sectionedit7" id="pycompat">pycompat</h3>
<div class="level3">

<p>
Le fichier <em>debian/pycompat</em> contient juste &quot;2&quot;, tout comme <em>debian/compat</em> contient &quot;5&quot;. Ceci est juste une indication de compatibilité.
</p>

</div>

<h3 class="sectionedit8" id="control">control</h3>
<div class="level3">

<p>
Pour ce qui concerne le fichier <em>debian/control</em>, c&#039;est un peu plus &quot;compliqué&quot;. Nous allons construire un module publique (module python) et nous allons avoir besoin des paquets <strong>python-dev</strong> et <strong>python-central</strong> pour construire le paquet. Il faut donc qu&#039;ils soient <a href="../../../tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">installés</a> sur votre système.
</p>

<p>
Ces deux dépendances n&#039;ont rien à voir avec les sources, c&#039;est vraiment propre au packaging avec Python.
</p>

<p>
C&#039;est pour cela (en simplifiant) qu&#039;elles sont listées dans <strong>Build-Depends-Indep</strong>.
</p>

<p>
<strong>XS-Python-Version: current</strong> permet de dire que l&#039;on construit ce module pour la version courante de python, c&#039;est à dire la version 2.5 depuis feisty.
</p>

<p>
<strong>XB-Python-Version: ${python:Versions}</strong> est un champ qui va être utilisé pour savoir avec quelle(s) version(s) de python va être compatible le paquet binaire.
</p>

<p>
<strong>Depends: ${python:Depends}</strong> permet de calculer les dépendances python (en incluant la version) et pycentral.
</p>

<p>
<p><div class="noteclassic">
<strong>python:Depends</strong> ne calcule pas tout (pas comme <strong>shlibs:Depends</strong> dans les paquets &quot;courants&quot;). Si votre paquet a besoin de <strong>python-gtk2</strong> (par exemple), il faudra l&#039;ajouter.

</div></p>
</p>

<p>
<strong>${python:Provides}</strong> : Dans notre exemple, cela ne sert à rien car notre paquet est <strong>arch: all</strong> (fonctionnel pour toutes les architectures) mais pour les modules privés de python (des .so), cela permet de définir des paquets virtuels.<br/>

Par exemple si le module est compatible python 2.4 et 2.5 nous obtiendrons Provides: <strong>python2.4-foo</strong> et <strong>python2.5-foo</strong>. L&#039;utilisateur pourra utiliser ces paquets virtuels comme n&#039;importe quel autre paquet.
</p>

<p>
Essayons maintenant de compiler le paquet (<a href="../../../tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">installez les paquets</a> <strong>python-dev python-central</strong> si nécessaire) :
</p>
<pre class="code">cd pyhw-1.0
debuild -us -uc</pre>

<p>
Nous obtiendrons une erreur :
</p>
<pre class="file">install: ne peut créer le répertoire `/usr/lib/python2.4/site-packages/HelloWorld&#039;: Permission non accordée</pre>

<p>
Le problème se situe dans le Makefile. Ouvrez ce fichier pour comprendre pourquoi. Vous voyez alors :<br/>

</p>
<pre class="file">install -d /usr/lib/python2.4/site-packages/HelloWorld</pre>

<p>
qui permet de créer un dossier mais <em>/usr/lib/python2.4/site-packages/HelloWorld</em> est inaccessible puisque nous ne sommes pas &quot;root&quot; et nous essayons de créer le dossier dans <em>debian/python-helloworld</em>…
</p>

<p>
Cela ne peut pas marcher et il faudra donc modifier le Makefile pour utiliser <strong>$(DESTDIR)/usr/lib/python2.4/site-packages/HelloWorld</strong> (où DESTDIR sera en fait <strong>debian/python-helloworld</strong>).
</p>

<p>
Comme tout bon packageur, vous savez qu&#039;il <em class="u">ne faut pas modifier les sources</em> de upstream. Nous allons donc <strong>patcher</strong> le Makefile…
</p>

</div>

<h2 class="sectionedit9" id="patcher_des_sources">Patcher des sources</h2>
<div class="level2">

</div>

<h3 class="sectionedit10" id="paquet_utilisant_debhelper">Paquet utilisant Debhelper</h3>
<div class="level3">

<p>
Nous venons de voir ci-dessus qu&#039;il était nécessaire de patcher le <em>Makefile</em> (et non modifier directement le fichier) et pour cela nous allons utiliser la v2 du paquet pyhw précédemment téléchargé :
</p>
<pre class="code">cd pyhw/v2 &amp;&amp; dpkg-source -x *.dsc</pre>

<p>
Dans le dossier <strong>debian</strong>, nous avons un dossier <strong>patches</strong> qui contient le patch <strong>01-makefile.dpatch</strong> et le fichier <strong>00list</strong>, qui est en fait la liste des patches à appliquer.
</p>

<p>
On utilise ici <strong>dpatch</strong> comme système de patch.
</p>

<p>
Le fichier <strong>debian/rules</strong> contient :
</p>
<pre class="file"># Include dpatch stuff.
include /usr/share/dpatch/dpatch.make</pre>

<p>
Ceci permet d&#039;inclure des règles toute faites qui automatisent le &quot;patchage/dépatchage&quot;.
</p>

<p>
Bien sûr, le paquet <strong>dpatch</strong> doit être <a href="../../../tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">installé</a> sur votre système.
</p>

<p>
Pour la cible <code><strong>build:</strong></code> on ajoute <strong>patch</strong> et <strong>unpatch</strong> pour la cible <code><strong>clean :</strong></code>, de façon à patcher les sources avant la compilation/installation et remettre les sources en l&#039;état après la construction du paquet source.
</p>

<p>
<p><div class="noteimportant">Si dans le <strong>debian/rules</strong> il y a une cible <code><strong>configure:</strong></code>, c&#039;est là qu&#039;il faudra appliquer <strong>patch</strong>.
</div></p>
</p>

<p>
Maintenant que vous savez appliquer les patches, voyons comment en créer !
</p>

<p>
Pour ce faire, nous allons repartir de zéro, et supprimer le patch déja présent dans le paquet :
</p>
<pre class="code">rm debian/patches/*</pre>

<p>
Pour créer un patch, il existe un outil très pratique: <code>dpatch-edit-patch</code>
</p>

<p>
Exécuter la commande suivant pour créer le patch :
</p>
<pre class="code">dpatch-edit-patch 01-makefile</pre>

<p>
<p><div class="notetip">
Quand il y a plusieurs patchs, ils sont appliqués dans l&#039;ordre alphabétique.<br/>

Commencer leur nom par un chiffre permet de savoir dans quel ordre ils seront appliqués. Lorsque l&#039;on se retrouve avec 15-20 patches, c&#039;est assez pratique.
</p>

<p>
le nom du patch est arbitraire. Ici nous nommons le patch <strong>01-makefile</strong> car c&#039;est le premier patch crée (à appliquer) et qu&#039;il agit sur le Makefile…

</div></p>
</p>

<p>
Nous nous retrouvons dans un <strong>nouveau shell</strong>.
</p>

<p>
Faites alors les modifications voulues, c&#039;est à dire ajoutez <strong>$(DESTDIR)</strong> dans le <em>Makefile</em>, ce qui donne :
</p>
<pre class="file">install -d $(DESTDIR)/usr/lib/python2.4/site-packages/HelloWorld
install -m 644 src/*py $(DESTDIR)/usr/lib/python2.4/site-packages/HelloWorld/</pre>

<p>
Enregistrez le fichier, puis lorsque la modification pour ce patch est terminée, tapez :
</p>
<pre class="code">exit 0</pre>

<p>
pour quitter le shell &quot;spécial&quot; et revenir à votre shell habituel.
</p>

<p>
Vous pouvez vérifier le contenu de <strong>debian/patches</strong> et vous y trouverez le patch <strong>01-makefile</strong> qui vient d&#039;être crée.
</p>

<p>
Il ne reste plus qu&#039;à <a href="../../../tutoriel/comment_editer_un_fichier" class="wikilink1" title="tutoriel:comment_editer_un_fichier">créer un fichier</a> <strong>debian/patches/00list</strong> qui contient la liste des patches à appliquer. Le contenu sera alors ici :
</p>
<pre class="file">01-makefile</pre>

<p>
Vous venez de patcher le makefile :)
</p>

<p>
Vous pouvez ensuite construire le paquet source :
</p>
<pre class="code">debuild -us -uc</pre>

<p>
Un Warning apparaîtra, nous reviendrons dessus plus bas : 
</p>
<pre class="file">W: python-helloworld: script-not-executable
./usr/share/pycentral/python-helloworld/site-packages/HelloWorld/HelloWorld.py</pre>

<p>
En lançant la commande
</p>
<pre class="code">dpkg -f *deb</pre>

<p>
vous verrez que pycentral a correctement remplacé les dépendances par les paquets appropriés :<br/>

Le <em>Makefile</em> installait dans <strong>/usr/lib/python2.4</strong> et au final le script <em>HelloWorld.py</em> se trouvera dans <strong>/usr/share/pycentral/python-helloworld/site-packages/HelloWorld/</strong>.
</p>

<p>
<strong>Python-central</strong> a donc complètement géré les problèmes de version de python (Depends: python, python-central (&gt;= 0.5.8)).
</p>

</div>

<h3 class="sectionedit11" id="paquet_utilisant_cdbs">Paquet utilisant CDBS</h3>
<div class="level3">

<p>
Nous allons passer directement à la version 4 de notre paquet <strong>pyhw</strong> (la v3 étant la même que la 2 mais version cdbs)
</p>
<pre class="code">cd pyhw/v4 &amp;&amp; dpkg-source -x *.dsc</pre>

<p>
Dans <strong>debian/patches</strong>, le fichier <strong>00list</strong> a disparu, et les extensions des patchs sont <strong>.patch</strong>, et non plus <strong>.dpatch</strong> (cdbs peut gérer n&#039;importe quelle extension mais c&#039;est &#039;patch&#039; par défaut).
</p>

<p>
Le fichier <strong>debian/rules</strong> contient la ligne :
</p>
<pre class="file">include /usr/share/cdbs/1/rules/simple-patchsys.mk</pre>

<p>
qui sert à inclure tout le système de patch de CDBS qui traitera tous fichier avec extension .patch du répertoire <strong>debian/patches</strong>.
</p>

<p>
Nous allons refaire le 2ème patch du paquet. Celui-ci corrigera le <em>Warning</em> que nous avons eu plus haut.
</p>

<p>
Supprimer donc le fichier <strong>debian/patches/02-shebang.patch</strong> et exécutez :
</p>
<pre class="code">cdbs-edit-patch 02-shebang</pre>

<p>
Ce <em>Warning</em> est assez courant avec tous les scripts et les modules python sont pas destinés à être exécutés et donc le shebang (#!/usr/bin/env python) n&#039;a pas à sa place ici.
</p>

<p>
Il faut donc supprimer la première ligne du fichier <strong>src/HelloWorld.py</strong>
</p>

<p>
Une fois la modification effectuée, tapez
</p>
<pre class="code">exit 0</pre>

<p>
pour quitter cdbs-edit-patch.
</p>

<p>
Votre patch est créé.
</p>

</div>

<h2 class="sectionedit12" id="liens">Liens</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="https://wiki.ubuntu.com/MOTU/School/PatchingSources" class="urlextern" title="https://wiki.ubuntu.com/MOTU/School/PatchingSources"  rel="nofollow">(en) Patching Ubuntu packages (session donnée par Martin Pitt aka pitti qui est l&#039;auteur de {cdbs,dpatch}-edit-patch)</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://wiki.debian.org/DebianPython/NewPolicy" class="urlextern" title="http://wiki.debian.org/DebianPython/NewPolicy"  rel="nofollow">(en) Debian Python NewPolicy</a></div>
</li>
</ul>
<hr />

<p>
 <em>Contributeurs: <a href="http://doc.ubuntu-fr.org/utilisateurs/ptitdav69" class="wikilink2" title="utilisateurs:ptitdav69" rel="nofollow">ptitdav69</a>, <a href="http://doc.ubuntu-fr.org/utilisateurs/enchained" class="wikilink1" title="utilisateurs:enchained">_Enchained</a></em>
</p>

</div>

<!-- cachefile /srv/www/doc.ubuntu-fr.org/htdocs/data/cache/a/aa243735baef152a653754a507b9cc5b.xhtml used -->

        <br style="clear:both;" />
        <div id="pageinfo">
            <!--  |  | -->
            <!-- ?tpl_pageinfo()? -->
            <br />
            Le contenu de ce wiki est sous licence : <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" rel="license" target="_blank">CC BY-SA v3.0</a>
        </div> 
      </div>

      
      <div id="navigation">

        <ul>
          <li class="menu"><a href="http://www.ubuntu-fr.org" class="title" id="menu-accueil"><span>Accueil</span></a></li>
          <li class="menu" id="active">
            <a href="../../../index.html"  class="title" id="menu-doc"><span>Documentation</span></a>
            <ul>
              <li id="navWiki" class="cat">
                <h2>Actions</h2>
                <ul>
                  <li><a href="http://doc.ubuntu-fr.org/projets/ecole/paquets/packaging_cas_particuliers?do=index"  class="action index" accesskey="x" rel="nofollow" title="Plan du site [X]">Plan du site</a></li>
                  <li><a href="http://doc.ubuntu-fr.org/projets/ecole/paquets/packaging_cas_particuliers?do=edit&amp;rev=0"  class="action source" accesskey="v" rel="nofollow" title="Afficher le texte source [V]">Afficher le texte source</a></li>
                  <li><a href="http://doc.ubuntu-fr.org/projets/ecole/paquets/packaging_cas_particuliers?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]">Anciennes révisions</a></li>
                  <li></li>
                  <li><a href="http://doc.ubuntu-fr.org/projets/ecole/paquets/packaging_cas_particuliers?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Derniers changements [R]">Derniers changements</a></li>
                  <li><a href="http://doc.ubuntu-fr.org/projets/ecole/paquets/packaging_cas_particuliers?do=backlink"  class="action backlink" rel="nofollow" title="Liens vers cette page">Liens vers cette page</a></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </li>
              <li id="navDivers" class="cat">
                <h2>Divers</h2>
                <ul>
                  <li><bdi><a href="../../../wiki/participer_wiki" class="wikilink1" title="wiki:participer_wiki">Participer à la documentation</a></bdi></li>
                  <li><bdi><a href="../../../documentation_hors_ligne" class="wikilink1" title="documentation_hors_ligne">Documentation hors ligne</a></bdi></li>
                  <li><a href="http://www.ubuntu-fr.org/telechargement" title="T&eacute;l&eacute;charger Ubuntu">T&eacute;l&eacute;charger Ubuntu</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li class="menu"><a href="http://forum.ubuntu-fr.org"  class="title" id="menu-forum"><span>Forum</span></a></li>
          <li class="menu"><a href="http://planet.ubuntu-fr.org"  class="title" id="menu-planet"><span>Planet</span></a></li>
        </ul>

      </div>
      <div id="references-ufr">
        <ul id="legal-ufr">
          <li><a href="http://www.ubuntu-fr.org/contacts">Contact</a></li>
        </ul>

        <ul id="sponsors-ufr">
          <li><a href="http://www.dokuwiki.org/dokuwiki" id="dokuwiki">Propulsé par Dokuwiki</a></li>
        </ul>
      </div>

    </div>
    <!-- $Id$ -->

    <!-- Piwik Image Tracker -->
    <!-- img src="http://piwik.infra.ubuntu-fr.org/piwik.php?idsite=2&amp;rec=1" style="border:0" alt="" /-->
    <!-- End Piwik -->

  </body>
</html>
