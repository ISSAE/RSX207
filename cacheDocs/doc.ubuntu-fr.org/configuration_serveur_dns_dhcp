<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr" dir="ltr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Script-Type" content="text/javascript"/>
    <meta http-equiv="Content-Style-Type" content="text/css"/>
    <meta http-equiv="Content-Language" content="fr"/>
    <title>configuration_serveur_dns_dhcp - Documentation Ubuntu Francophone</title>
    <meta name="Description" content="Documentation francophone pour la distribution Ubuntu" lang="fr" />
    <meta name="language" content="fr-FR" />

    <!--[if IE 8]>
    <meta http-equiv="X-UA-Compatible" content="IE=8" />
    <![endif]-->
        <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2014-10-16T22:59:42+0200"/>
<meta name="keywords" content="serveur,reseau,dns"/>
<link rel="search" type="application/opensearchdescription+xml" href="lib/exe/opensearch.php" title="Documentation Ubuntu Francophone"/>
<link rel="start" href="index.html"/>
<link rel="contents" href="http://doc.ubuntu-fr.org/configuration_serveur_dns_dhcp?do=index" title="Plan du site"/>
<link rel="alternate" type="application/rss+xml" title="Derniers changements" href="feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Namespace actuel" href="feed.php?mode=list&amp;ns="/>
<link rel="edit" title="Modifier cette page" href="http://doc.ubuntu-fr.org/configuration_serveur_dns_dhcp?do=edit"/>
<link rel="alternate" type="text/html" title="HTML brut" href="http://doc.ubuntu-fr.org/_export/xhtml/configuration_serveur_dns_dhcp"/>
<link rel="alternate" type="text/plain" title="Wiki balise" href="http://doc.ubuntu-fr.org/_export/raw/configuration_serveur_dns_dhcp"/>
<link rel="canonical" href="configuration_serveur_dns_dhcp"/>
<link rel="stylesheet" type="text/css" href="lib/exe/css.php?t=ubuntu-2010&amp;tseed=4af22dedc19f28c99fa67afabbb173df"/>
<script type="text/javascript">/*<![CDATA[*/var NS='';var JSINFO = {"id":"configuration_serveur_dns_dhcp","namespace":""};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="lib/exe/js.php?tseed=4af22dedc19f28c99fa67afabbb173df"></script>
    <link rel="shortcut icon" href="http://www-static.ubuntu-fr.org/theme2010/images/commun/ubuntu/icone.png" type="image/x-icon" />
    <link rel="apple-touch-icon" href="http://www-static.ubuntu-fr.org/theme2010/images/commun/ubuntu/touch-ico.png" />

    <link rel="stylesheet" media="screen" type="text/css" title="Design Ubuntu-fr" href="http://www-static.ubuntu-fr.org/theme2010/css/doc.css" />
    <link rel="stylesheet" media="screen" type="text/css" title="Design Ubuntu-fr" href="http://www-static.ubuntu-fr.org/theme2010/css/doc-ubuntu.css" />
    <link rel="stylesheet" media="print" type="text/css" title="Design Ubuntu-fr" href="http://www-static.ubuntu-fr.org/theme2010/css/doc-print.css" />

    <script type="text/javascript">
      var menu_hidden;
      var static_url = "UFR_STATIC";
    </script>
    <script src="http://www-static.ubuntu-fr.org/theme2010/js/menu.js" type="text/javascript"></script>
    <script src="http://www-static.ubuntu-fr.org/theme2010/js/common.js" type="text/javascript"></script>
  </head>
  <body>

    <div id="accessibar">
      <a href="configuration_serveur_dns_dhcp#main" tabindex="1">Contenu</a> | <a href="configuration_serveur_dns_dhcp#qsearch__in" tabindex="2">Rechercher</a> | <a href="configuration_serveur_dns_dhcp#navigation" tabindex="3">Menus</a>
    </div>

    <div id="page">

      <div id="header">

        <div id="logo">
          <h1>Ubuntu-fr</h1>
          <a href="index.html" title="Accueil de la documentation">Communauté francophone d'utilisateurs d'Ubuntu</a>
        </div>

        <form action="http://ubuntu-fr.org/recherche" accept-charset="utf-8" id="search" onsubmit="if (document.getElementById('qsearch__in').value == 'Recherche rapide....') {document.getElementById('qsearch__in').value = '';}">
          <fieldset>
            <label for="qsearch__in">Recherche : </label><input type="text" value="Recherche rapide...." id="qsearch__in" accesskey="f" name="sk_q" alt="[F]" size="34" tabindex="4" />
            <label for="tsearch_field">Chercher dans : </label><select name="sk_engine" tabindex="5" id="tsearch_field" title="Chercher dans">
              <option value="all">Site</option>
              <option selected="selected" value="doc">Documentation</option>
              <option value="forum">Forum</option>
              <option value="planet">Planet</option>
            </select>
            <input type="submit" value="ok" class="button" alt="Lancer la recherche" tabindex="5" />
          </fieldset>
        </form>
        <!--[if lte IE 7]><div class="clear"></div><![endif]-->

        <form action="configuration_serveur_dns_dhcp" accept-charset="utf-8" id="login_top" method="post">
          <fieldset>
            <label for="u_field">Identifiant : </label><input type="text" value="Identifiant" name="u" id="u_field" size="9" /><label for="p_field">Mot de passe : </label><input type="password" value="Mot de passe" name="p" id="p_field" size="9" alt="Mot de passe" /><input type="submit" value="connexion" id="connect" /> / <a href="http://forum.ubuntu-fr.org/register.php">inscription</a>
          </fieldset>
        </form>
 

      </div>

      <div id="navbar">
          <h2 id="pagetitle"><a href="configuration_serveur_dns_dhcp" >configuration_serveur_dns_dhcp</a></h2>
      </div>

      
      <div id="main" class="dokuwiki">

        <div id="hidemenu" title="Masquer le menu"></div>

        <div id="pagerror"></div>
                <!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table des matières</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="configuration_serveur_dns_dhcp#installation">Installation</a></div></li>
<li class="level1"><div class="li"><a href="configuration_serveur_dns_dhcp#configuration">Configuration</a></div></li>
<li class="level1"><div class="li"><a href="configuration_serveur_dns_dhcp#application_de_la_nouvelle_configuration">Application de la nouvelle configuration</a></div></li>
<li class="level1"><div class="li"><a href="configuration_serveur_dns_dhcp#plus_d_info_sur_le_fichieretcdnsmasqconf">Plus d&#039;info sur le fichier : /etc/dnsmasq.conf</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="configuration_serveur_dns_dhcp#exemple_de_fichier_de_configuration">Exemple de fichier de configuration</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="configuration_serveur_dns_dhcp#comment_fixer_une_adresse_ip_a_un_client">Comment fixer une adresse ip à un client</a></div></li>
<li class="level1"><div class="li"><a href="configuration_serveur_dns_dhcp#liens_et_ressources_complementaires">Liens et ressources complémentaires</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->
<div class="tags"><span>
	<a href="serveur" class="wikilink1" title="serveur" rel="tag">serveur</a>,
	<a href="reseau" class="wikilink1" title="reseau" rel="tag">réseau</a>,
	<a href="dns" class="wikilink1" title="dns" rel="tag">dns</a>
</span></div>
<hr />

<h1 class="sectionedit1" id="comment_configurer_un_serveur_leger_dns_et_dhcp_alias_dnsmasq">Comment configurer un serveur léger dns et dhcp alias Dnsmasq ?</h1>
<div class="level1">

<p>
DnsMasq est un petit serveur <abbr title="Domain Name System">DNS</abbr> (cache <abbr title="Domain Name System">DNS</abbr>) qui intègre un serveur <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr>. Peu gourmand en ressources et très simple à configurer, il est bien adapté à une installation sur une solution embarquée telle qu’un routeur ou point d’accès wifi (sous OpenWRT par exemple ; - )
</p>

<p>
Pour la résolution des noms, il se base sur les <abbr title="Domain Name System">DNS</abbr> déclarés dans la configuration réseau (/etc/resolv.conf) ou sur le fichier /etc/hosts. Ce qui est bien pratique pour configurer une petite zone lan : il suffit d’éditer le fichier /etc/hosts comme nous le ferions pour une seule machine.
</p>

<p>
Côté serveur <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr>, il nous faut faire un minimum de conf… Cela se passe dans le fichier /etc/dnsmasq.conf
</p>

<p>
A minima, nous devrions configurer la plage dhcp, l’adresse d’un serveur <abbr title="Domain Name System">DNS</abbr> et une route par défaut (gateway).
</p>

</div>
<div class='secedit editbutton_section editbutton_1'><form class="button btn_secedit" method="post" action="configuration_serveur_dns_dhcp"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1413493182" /><input type="hidden" name="summary" value="[Comment configurer un serveur léger dns et dhcp alias Dnsmasq ?] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="38-923" /><input type="submit" value="Modifier" class="button" title="Comment configurer un serveur léger dns et dhcp alias Dnsmasq ?" /></div></form></div>
<h2 class="sectionedit2" id="installation">Installation</h2>
<div class="level2">

<p>
On écrit dans un terminal :
</p>
<pre class="file">sudo apt-get install dnsmasq</pre>

<p>
Ou on clique ici : <a href="apt://dnsmasq" class="interwiki iw_apt" title="apt://dnsmasq">dnsmasq</a>
</p>

</div>
<div class='secedit editbutton_section editbutton_2'><form class="button btn_secedit" method="post" action="configuration_serveur_dns_dhcp"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1413493182" /><input type="hidden" name="summary" value="[Installation] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="924-1060" /><input type="submit" value="Modifier" class="button" title="Installation" /></div></form></div>
<h2 class="sectionedit3" id="configuration">Configuration</h2>
<div class="level2">

<p>
Pour le configurer on édite le fichier : <a href="tutoriel/comment_editer_un_fichier" class="wikilink1" title="tutoriel:comment_editer_un_fichier">/etc/dnsmasq.conf</a>
</p>

<p>
Un exemple de dnsmasq pour un simple réseau :
</p>
<pre class="file">domain-needed
bogus-priv
filterwin2k
 
localise-queries
local=/lan/
domain=local.lan
expand-hosts
no-negcache
resolv-file=/tmp/resolv.conf.auto
 
dhcp-authoritative
dhcp-leasefile=/tmp/dhcp.leases
 
# use /etc/ethers for static hosts; same format as --dhcp-host
read-ethers
 
# Plage DHCP
dhcp-range=192.168.1.100,192.168.1.150,12h
# Netmask
dhcp-option=1,255.255.255.0
# Route
dhcp-option=3,192.168.1.1</pre>

<p>
On édite le fichier <a href="tutoriel/comment_editer_un_fichier" class="wikilink1" title="tutoriel:comment_editer_un_fichier">/etc/resolv.conf</a>
</p>
<pre class="file"># Le nom de domain local (n&#039;existe pas sur internet)
domain local.lan
# Où les clients doivent chercher les pc sur le réseau local
search local.lan
# Serveur dns primaire fourni par mon provideur
nameserver 195.238.2.21
# Serveur dns secondaire fourni par mon provideur
nameserver 195.238.2.22</pre>

<p>
On édite le fichier <a href="tutoriel/comment_editer_un_fichier" class="wikilink1" title="tutoriel:comment_editer_un_fichier">/etc/hosts</a>
</p>
<pre class="file">127.0.0.1       localhost
127.0.1.1       client-desktop
192.168.1.1     mail
192.168.1.1     mail.local.lan</pre>

<p>
Dans l&#039;exemple ci-dessus, l&#039;ordinateur sur le réseau local 192.168.1.1 aura comme nom dns mail et mail.local.lan.
Pas besoin d&#039;ajouter tous les ordinateurs, ceux ayant fait une demande dhcp auront leur nom dns directement configuré.
</p>

</div>
<div class='secedit editbutton_section editbutton_3'><form class="button btn_secedit" method="post" action="configuration_serveur_dns_dhcp"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1413493182" /><input type="hidden" name="summary" value="[Configuration] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="1061-2486" /><input type="submit" value="Modifier" class="button" title="Configuration" /></div></form></div>
<h2 class="sectionedit4" id="application_de_la_nouvelle_configuration">Application de la nouvelle configuration</h2>
<div class="level2">

<p>
On tape dans un terminal :
</p>
<pre class="file">sudo /etc/init.d/dnsmasq restart</pre>

</div>
<div class='secedit editbutton_section editbutton_4'><form class="button btn_secedit" method="post" action="configuration_serveur_dns_dhcp"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1413493182" /><input type="hidden" name="summary" value="[Application de la nouvelle configuration] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="2487-2617" /><input type="submit" value="Modifier" class="button" title="Application de la nouvelle configuration" /></div></form></div>
<h2 class="sectionedit5" id="plus_d_info_sur_le_fichieretcdnsmasqconf">Plus d&#039;info sur le fichier : /etc/dnsmasq.conf</h2>
<div class="level2">

<p>
Quelques explications sur les options utilisées. Il en existe bien d’autres, je vous invite à consulter le man pour approfondir le sujet… Ce qui suit en est largement inspiré…
</p>

<p>
<strong>domain-needed</strong> : Ne transmet pas les requêtes ne contenant pas un nom de domaine complet. Par exemple,une requête pour machine ne sera pas transmise aux serveurs <abbr title="Domain Name System">DNS</abbr> de votre <abbr title="Fournisseur d&#039;Accès à Internet">FAI</abbr>, alors qu’une requête pour machine.domain.com le sera.
</p>

<p>
<strong>bogus-priv</strong> : Fausse résolution inverse pour les réseaux privés. Toutes les requêtes <abbr title="Domain Name System">DNS</abbr> inverses pour des adresses IP privées (ie 192.168.x.x, etc…) qui ne sont pas trouvées dans /etc/hosts ou dans le fichier de baux <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> se voient retournées une réponse “pas de tel domaine” (”no such domain”) au lieu d’être transmises aux serveurs de nom amont (”upstream server”).
</p>

<p>
<strong>filter-win2k</strong> : Les dernières versions de windows font des requêtes <abbr title="Domain Name System">DNS</abbr> périodiques auxquelles non seulement les serveurs <abbr title="Domain Name System">DNS</abbr> publics ne peuvent donner de réponse, mais qui, de surcroît, peuvent poser des problèmes en déclenchant des connexions intempestives pour des liens réseaux avec des connexions “à la demande”. Fournir cette option active le filtrage des requêtes de ce type. Les requêtes bloquées sont les requêtes pour les entrées de type SOA ou SRV, ainsi que les requêtes de type ANY avec des noms possédant des caractères sous-lignés (requêtes pour des serveurs <abbr title="Lightweight Directory Access Protocol">LDAP</abbr>).
</p>

<p>
<strong>localise-query</strong> : Retourne des réponses aux requêtes <abbr title="Domain Name System">DNS</abbr> dépendantes de l’interface sur laquelle la requête a été reçue, à partir du fichier /etc/hosts. Si un nom dans /etc/hosts a plus d’une adresse associée avec lui, et qu’une des adresses au moins est dans le même sous-réseau que l’interface sur laquelle la requête a été reçue, alors ne retourne que la(les) adresse(s) du sous-réseau considéré. Cela permet d’avoir dans /etc/hosts un serveur avec de multiples adresses, une pour chacune de ses interfaces, et de fournir aux hôtes l’adresse correcte (basée sur le réseau auquel ils sont attachés). Cette possibilité est actuellement limitée à IPv4.
</p>

<p>
<strong>domain</strong> : Spécifie le domaine utilisé pour étendre la recherche de noms sans domaine. Utilisé également pour attribuer un domaine de recherche au clients <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr>.
</p>

<p>
<strong>expand-hosts</strong> : Ajoute le nom de domaine aux noms simples (ne contenant pas de point dans le nom) contenus dans le fichier /etc/hosts, de la même façon que pour le service <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr>.
</p>

<p>
<strong>no-negcache</strong> : Désactive le “cache négatif”. Le “cache négatif” permet à Dnsmasq de se souvenir des réponses de type “no such domain” fournies par les serveurs <abbr title="Domain Name System">DNS</abbr> en amont et de fournir les réponses sans avoir à re-transmettre les requêtes aux serveurs amont.
</p>

<p>
<strong>interface=eth0</strong> : Indique quel carte réseaux est a l&#039;écoute des requetes <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr>.
</p>

<p>
<strong>resolv-file</strong> : Lis les adresses des serveurs de nom amont dans le fichier de nom &lt;fichier&gt;, au lieu du fichier /etc/resolv.conf. Pour le format de ce fichier, voir dans le manuel pour resolv.conf(5) les entrées correspondant aux serveurs de noms (nameserver). Dnsmasq peut lire plusieurs fichiers de type resolv.conf, le premier fichier spécifié remplace le fichier par défaut, le contenu des suivants est rajouté dans la liste des fichiers à consulter. Seul le fichier ayant la dernière date de modification sera chargé en mémoire.
</p>

<p>
<strong>dhcp-autoritative</strong> : Cette option doit être donnée lorsque Dnsmasq est le seul serveur <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> sur le réseau. Cela change le comportement par défaut qui est celui d’un strict respect des <abbr title="Request for Comments">RFC</abbr>, afin que les requêtes <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> pour des baux inconnus par des hôtes inconnus ne soient pas ignorées. Cela permet à de nouveaux hôtes d’obtenir des baux sans tenir compte de fastidieuses temporisations (”timeout”). Cela permet également à Dnsmasq de reconstruire sa base de donnée contenant les baux sans que les clients n’aient besoin de redemander un bail, si celle-ci est perdue.
</p>

<p>
<strong>dhcp-leasefile</strong> : Utilise le fichier dont le chemin est fourni pour stocker les informations de baux <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr>. Si cette option est fournie mais qu’aucune option de type dhcp-range n’est donnée, alors un comportement de type Dnsmasq version 1 est activé. Le fichier fourni est supposé être un fichier de baux <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> de type ISC DHCPD et est parcouru à la recherche de baux contenant des noms d’hôtes. Les noms trouvés sont rajoutés au <abbr title="Domain Name System">DNS</abbr>. Cette fonctionalité peut être exclue de Dnsmasq à la compilation, auquel cas une erreur sera produite. Il est à noter que l’intégration avec un fichier de baux au format ISC est une fonctionalité obsolète. Elle ne devrait pas être utilisée dans les nouvelles installations et sera retirée dans une future version.
</p>

<p>
<strong>read-ethers</strong> : Lis les informations d’hôtes <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> dans le fichier /etc/ethers. Le format de /etc/ethers est une adresse matérielle suivie, soit par un nom d’hôte, soit par une adresse IP sous la forme de 4 chiffres séparés par des points. Lorsque lu par Dnsmasq, ces lignes ont exactement le même effet que l’option dhcp-host contenant les mêmes informations. /etc/ethers est relu à la réception d’un signal SIGHUP par Dnsmasq.
</p>

<p>
<strong>dhcp-range=adresse de début,adresse de fin,durée de bail par défaut</strong> : Active le serveur <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr>. Les adresses seront données dans la plage comprise entre <em>adresse de début</em> et <em>adresse de fin</em> et à partir des adresses définies statiquement dans l’option dhcp-host.<abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> sur plus d’un réseau. Pour des réseaux directement connectés (c’est-à-dire des réseaux dans lesquels la machine sur laquelle tourne Dnsmasq possède une interface), le masque de réseau est optionnel. Il est par contre requis pour les réseaux pour lesquels le service <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> se fait via un relais <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> (”relay agent”).Si une durée de bail est donnée, alors les baux seront donnés pour cette durée. La durée de bail est donnée en secondes, en minutes (exemple : 45m), en heures (exemple : 1h) ou être la chaine de caractère “infinite” pour une durée indéterminée. Cette option peut être répétée, avec différentes adresses, pour activer le service. 
</p>

<p>
<strong>dhcp-option=[&lt;identifiant_de_réseau&gt;,[&lt;identifiant_de_réseau&gt;,]][vendor:[&lt;classe_vendeur&gt;],][&lt;opt&gt;|option:&lt;nom d&#039;option&gt;],[&lt;valeur&gt;[,&lt;valeur&gt;]]</strong> : Spécifie des options différentes ou supplémentaires pour des clients <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr>. Par défaut, Dnsmasq envoie un ensemble standard d’options aux clients <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> : le masque de réseau et l’adresse de broadcast sont les mêmes que pour l’hôte sur lequel tourne Dnsmasq, et le serveur <abbr title="Domain Name System">DNS</abbr> ainsi que la route par défaut prennent comme valeur l’adresse de la machine sur laquelle tourne Dnsmasq. Si une option de nom de domaine a été définie, son contenu est transmis. Cette option de configuration permet de changer toutes ces valeurs par défaut, ou de spécifier d’autres options. L’option <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> à transmettre peut être fournie sous forme d’un nombre décimal ou sous la forme “option:&lt;nom d’option&gt;”. Les nombres correspondants aux options sont définis dans la RFC2132 et suivants. Les noms d’options connus par Dnsmasq peuvent être obtenus via “Dnsmasq –help dhcp”. Par exemple, pour définir la route par défaut à 192.168.4.4, il est possible de faire –dhcp-option=3,192.168.4.4–dhcp-option = option:router, 192.168.4.4 ou encore, pour positionner l’adresse du serveur–dhcp-option = 42,192.168.0.4 ou –dhcp-option = option:ntp-server, 192.168.0.4 L’adresse 0.0.0.0 prends ici le sens “d’adresse de la machine sur laquelle tourne Dnsmasq”. Les types de données autorisées sont des adresses IP sous la forme de 4 chiffres séparés par des points, un nombre décimal, une liste de caractères hexadécimaux séparés par des 2 points, ou une chaîne de caractères. Si des identifiants de réseaux sont fournis, alors cette option n’est envoyée qu’aux réseaux dont tous les identifiants coïncident.
</p>

<p>
Un traitement spécial est effectué sur les chaînes de caractères fournies pour l’option 119, conformément à la <abbr title="Request for Comments">RFC</abbr> 3397. Les chaînes de caractères ou les adresses IP sous forme de 4 chiffres séparés par des points donnés en arguments de l’option 120 sont traités conforméments à la <abbr title="Request for Comments">RFC</abbr> 3361. Les adresses IP sous forme de 4 chiffres séparés par des points suivies par une barre montante “/”, puis une taille de masque sont encodés conforméments à la <abbr title="Request for Comments">RFC</abbr> 3442.
</p>

<p>
Attention : aucun test n’étant fait pour vérifier que des données d’un type adéquat sont envoyées pour un numéro d’option donné, il est tout à fait possible de persuader Dnsmasq de générer des paquets <abbr title="Dynamic Host Configuration Protocol">DHCP</abbr> illégaux par une utilisation incorrecte de cette option. Lorsque la valeur est un nombre décimal, Dnsmasq doit déterminer la taille des données. Cela est fait en examinant le numéro de l’option et/ou la valeur, mais peut-être évité en rajoutant un suffixe d’une lettre comme suit : b = un octet, s = 2 octets, i = 4 octets. Cela sert essentiellement pour des options encapsulées de classes de vendeurs (voir plus bas), pour lesquelles Dnsmasq ne peut déterminer la taille de la valeur. Les données d’options consistant uniquement de points et de décimaux sont interprétées par Dnsmasq comme des adresses IP, et envoyées comme telles. Pour forcer l’envoi sous forme de chaîne de caractère, il est nécessaire d’utiliser des guillemets doubles. Par exemple, l’utilisation de l’option 66 pour fournir une adresse IP sous la forme d’une chaîne de caractères comme nom de serveur TFTP, il est nécessaire de faire comme suit : –dhcp-option=66,1.2.3.4
</p>

<p>
Les options encapsulées de classes de vendeurs peuvent-être aussi spécifiées en utilisant –dhcp-option : par exemple –dhcp-option=vendor:PXEClient,1,0.0.0.0 envoie l’option encapsulée de classe de vendeur “mftp-address=0.0.0.0″ à n’importe quel client dont la classe de vendeur correspond à “PXEClient”. La correspondance pour les classes de vendeur s’effectue sur des sous-chaînes de caractères (voir –dhcp-vendorclass pour plus de détails). Si une option de classe de vendeur (numéro 60) est envoyée par Dnsmasq, alors cela est utilisé pour sélectionner les options encapsulées, de préférence à toute option envoyée par le client. Il est possible d’omettre complètement une classe de vendeur : –dhcp-option=vendor:,1,0.0.0.0 Dans ce cas l’option encapsulée est toujours envoyée. L’adresse 0.0.0.0 n’est pas traitée de manière particulière lorsque fournie dans une option encapsulée de classe de vendeur.
</p>

<p>
<strong>dhcp-option=3,192.168.1.1</strong> : Indique la passerelle, ici 192.168.1.1, obligatoire quand la passerelle n&#039;est pas le serveur dnsmasq car par défaut c&#039;est l&#039;adresse ip du serveur dnsmasq qui est fournie.
</p>

<p>
<strong>dhcp-option=6,192.168.7.2,192.168.70.1</strong> Indique un serveur dns primaire et secondaire autre que l&#039;ordinateur serveur dnsmasq, je déconseille de l&#039;employer car notre but est justement d&#039;utiliser notre serveur comme serveur dns.
</p>

<p>
<strong>dhcp-option=19,0</strong> : Désactive l&#039;IP forwarding 19,0 ou active l&#039;IP Forwarding 19,1.Util sous les routers.
</p>

<p>
<strong>dhcp-option=44,192.168.1.200</strong> : Indique qui est le server wins (netbios) sur le réseau.
</p>

<p>
<strong>dhcp-option=45,192.168.1.200</strong> :Indique qui possède en mémoire le datagram du réseau netbios (le contenu du voisinage réseau sous windows)
</p>

<p>
<strong>dhcp-option=46,8</strong> : Le type de node à utliser pour le <abbr title="Transmission Control Protocol">TCP</abbr>/IP sur NetBIOS. Si vous utilisez samba comme serveur wins, laissez-le à 8.
</p>

<p>
<strong>dhcp-option=47</strong> : Active le Scope <abbr title="Transmission Control Protocol">TCP</abbr>/IP sur NetBios. Si vous utilisez samba comme serveur wins.
</p>

</div>
<div class='secedit editbutton_section editbutton_5'><form class="button btn_secedit" method="post" action="configuration_serveur_dns_dhcp"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1413493182" /><input type="hidden" name="summary" value="[Plus d'info sur le fichier : /etc/dnsmasq.conf] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="2618-14351" /><input type="submit" value="Modifier" class="button" title="Plus d'info sur le fichier : /etc/dnsmasq.conf" /></div></form></div>
<h3 class="sectionedit6" id="exemple_de_fichier_de_configuration">Exemple de fichier de configuration</h3>
<div class="level3">

<p>
Voici le fichier de configuration que j&#039;utilise :
</p>
<pre class="file">
 Configuration file for dnsmasq.
#
# pour éviter de fournir du trafic DHCP/DNS inutile du coté internet
##domain-needed
bogus-priv
filter-win2k
# pour permettre à dnsmasq de suivre vos changements d&#039;IP:
# commentez cette ligne si vous avez une IP qui change
no-poll
# pour limiter l&#039;écoute de requêtes DHCP du coté réseau local
interface=eth0
# nom de votre domaine pour dnsmasq
domain=zonelibre.lan
dhcp-authoritative
dhcp-leasefile=/tmp/dhcp.leases
# activez le serveur DHCP:
dhcp-option=3,192.168.1.1
dhcp-option=19,0
dhcp-range=192.168.10.100,192.168.10.150,255.255.255.0,48h
dhcp-option=44,192.168.1.200
dhcp-option=45,192.168.1.200
dhcp-option=46,8
dhcp-option=47</pre>

</div>
<div class='secedit editbutton_section editbutton_6'><form class="button btn_secedit" method="post" action="configuration_serveur_dns_dhcp"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1413493182" /><input type="hidden" name="summary" value="[Exemple de fichier de configuration] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="14352-15144" /><input type="submit" value="Modifier" class="button" title="Exemple de fichier de configuration" /></div></form></div>
<h2 class="sectionedit7" id="comment_fixer_une_adresse_ip_a_un_client">Comment fixer une adresse ip à un client</h2>
<div class="level2">

<p>
C&#039;est simple, on ajoute dans <a href="tutoriel/comment_editer_un_fichier" class="wikilink1" title="tutoriel:comment_editer_un_fichier">/etc/dnsmasq.conf</a>
</p>
<pre class="file">dhcp-host=00:16:d4:f5:5d:64,192.168.1.2</pre>

<p>
Dans le cas présent, je fixe l&#039;adresse ip 192.168.1.2 pour l&#039;ordinateur ayant la mac adresse 00:16:d4:f5:5d:64. Par souci de simplicité, j&#039;attribue toujours les adresses ip fixes en dehors de mon dhcp-range.
</p>

</div>
<div class='secedit editbutton_section editbutton_7'><form class="button btn_secedit" method="post" action="configuration_serveur_dns_dhcp"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1413493182" /><input type="hidden" name="summary" value="[Comment fixer une adresse ip à un client] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="15145-15554" /><input type="submit" value="Modifier" class="button" title="Comment fixer une adresse ip à un client" /></div></form></div>
<h2 class="sectionedit8" id="liens_et_ressources_complementaires">Liens et ressources complémentaires</h2>
<div class="level2">

<p>
Cet article est une copie et une adaptation de : <a href="http://www.jopa.fr/index.php/2008/10/30/dnsmasq-dns-cache-et-dhcp/" class="urlextern" title="http://www.jopa.fr/index.php/2008/10/30/dnsmasq-dns-cache-et-dhcp/"  rel="nofollow">http://www.jopa.fr/index.php/2008/10/30/dnsmasq-dns-cache-et-dhcp/</a>
</p>

<p>
Explication très détaillée des dhcp-options en anglais : <a href="http://www.networksorcery.com/enp/protocol/bootp/options.htm" class="urlextern" title="http://www.networksorcery.com/enp/protocol/bootp/options.htm"  rel="nofollow">http://www.networksorcery.com/enp/protocol/bootp/options.htm</a>
</p>

<p>
Site officiel de DnsMasq : <a href="http://www.thekelleys.org.uk/dnsmasq/doc.html" class="urlextern" title="http://www.thekelleys.org.uk/dnsmasq/doc.html"  rel="nofollow">http://www.thekelleys.org.uk/dnsmasq/doc.html</a>
</p>
<hr />

<p>
<em>Contributeurs : Rédigée et maintenue par <a href="http://doc.ubuntu-fr.org/utilisateurs/redlemon" class="wikilink1" title="utilisateurs:redlemon">RedLemon</a></em>
</p>

</div>
<div class='secedit editbutton_section editbutton_8'><form class="button btn_secedit" method="post" action="configuration_serveur_dns_dhcp"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1413493182" /><input type="hidden" name="summary" value="[Liens et ressources complémentaires] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="15555-" /><input type="submit" value="Modifier" class="button" title="Liens et ressources complémentaires" /></div></form></div>
<!-- cachefile /srv/www/doc.ubuntu-fr.org/htdocs/data/cache/3/33d8c6909005f4fd3fb84bb0dec68497.xhtml used -->

        <br style="clear:both;" />
        <div id="pageinfo">
            <!--  |  | -->
            <!-- ?tpl_pageinfo()? -->
            <br />
            Le contenu de ce wiki est sous licence : <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" rel="license" target="_blank">CC BY-SA v3.0</a>
        </div> 
      </div>

      
      <div id="navigation">

        <ul>
          <li class="menu"><a href="http://www.ubuntu-fr.org" class="title" id="menu-accueil"><span>Accueil</span></a></li>
          <li class="menu" id="active">
            <a href="index.html"  class="title" id="menu-doc"><span>Documentation</span></a>
            <ul>
              <li id="navWiki" class="cat">
                <h2>Actions</h2>
                <ul>
                  <li><a href="http://doc.ubuntu-fr.org/configuration_serveur_dns_dhcp?do=index"  class="action index" accesskey="x" rel="nofollow" title="Plan du site [X]">Plan du site</a></li>
                  <li><a href="http://doc.ubuntu-fr.org/configuration_serveur_dns_dhcp?do=edit&amp;rev=0"  class="action edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]">Modifier cette page</a></li>
                  <li><a href="http://doc.ubuntu-fr.org/configuration_serveur_dns_dhcp?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]">Anciennes révisions</a></li>
                  <li></li>
                  <li><a href="http://doc.ubuntu-fr.org/configuration_serveur_dns_dhcp?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Derniers changements [R]">Derniers changements</a></li>
                  <li><a href="http://doc.ubuntu-fr.org/configuration_serveur_dns_dhcp?do=backlink"  class="action backlink" rel="nofollow" title="Liens vers cette page">Liens vers cette page</a></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </li>
              <li id="navDivers" class="cat">
                <h2>Divers</h2>
                <ul>
                  <li><bdi><a href="wiki/participer_wiki" class="wikilink1" title="wiki:participer_wiki">Participer à la documentation</a></bdi></li>
                  <li><bdi><a href="documentation_hors_ligne" class="wikilink1" title="documentation_hors_ligne">Documentation hors ligne</a></bdi></li>
                  <li><a href="http://www.ubuntu-fr.org/telechargement" title="T&eacute;l&eacute;charger Ubuntu">T&eacute;l&eacute;charger Ubuntu</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li class="menu"><a href="http://forum.ubuntu-fr.org"  class="title" id="menu-forum"><span>Forum</span></a></li>
          <li class="menu"><a href="http://planet.ubuntu-fr.org"  class="title" id="menu-planet"><span>Planet</span></a></li>
        </ul>

      </div>
      <div id="references-ufr">
        <ul id="legal-ufr">
          <li><a href="http://www.ubuntu-fr.org/contacts">Contact</a></li>
        </ul>

        <ul id="sponsors-ufr">
          <li><a href="http://www.dokuwiki.org/dokuwiki" id="dokuwiki">Propulsé par Dokuwiki</a></li>
        </ul>
      </div>

    </div>
    <!-- $Id$ -->

    <!-- Piwik Image Tracker -->
    <!-- img src="http://piwik.infra.ubuntu-fr.org/piwik.php?idsite=2&amp;rec=1" style="border:0" alt="" /-->
    <!-- End Piwik -->

  </body>
</html>
