<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr" dir="ltr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Script-Type" content="text/javascript"/>
    <meta http-equiv="Content-Style-Type" content="text/css"/>
    <meta http-equiv="Content-Language" content="fr"/>
    <title>rubyonrails - Documentation Ubuntu Francophone</title>
    <meta name="Description" content="Documentation francophone pour la distribution Ubuntu" lang="fr" />
    <meta name="language" content="fr-FR" />

    <!--[if IE 8]>
    <meta http-equiv="X-UA-Compatible" content="IE=8" />
    <![endif]-->
        <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2014-01-20T17:03:06+0100"/>
<meta name="keywords" content="hardy,maverick,programmation,brouillon"/>
<link rel="search" type="application/opensearchdescription+xml" href="lib/exe/opensearch.php" title="Documentation Ubuntu Francophone"/>
<link rel="start" href="index.html"/>
<link rel="contents" href="http://doc.ubuntu-fr.org/rubyonrails?do=index" title="Plan du site"/>
<link rel="alternate" type="application/rss+xml" title="Derniers changements" href="feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Namespace actuel" href="feed.php?mode=list&amp;ns="/>
<link rel="edit" title="Modifier cette page" href="http://doc.ubuntu-fr.org/rubyonrails?do=edit"/>
<link rel="alternate" type="text/html" title="HTML brut" href="http://doc.ubuntu-fr.org/_export/xhtml/rubyonrails"/>
<link rel="alternate" type="text/plain" title="Wiki balise" href="http://doc.ubuntu-fr.org/_export/raw/rubyonrails"/>
<link rel="canonical" href="rubyonrails"/>
<link rel="stylesheet" type="text/css" href="lib/exe/css.php?t=ubuntu-2010&amp;tseed=4af22dedc19f28c99fa67afabbb173df"/>
<script type="text/javascript">/*<![CDATA[*/var NS='';var JSINFO = {"id":"rubyonrails","namespace":""};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="lib/exe/js.php?tseed=4af22dedc19f28c99fa67afabbb173df"></script>
    <link rel="shortcut icon" href="http://www-static.ubuntu-fr.org/theme2010/images/commun/ubuntu/icone.png" type="image/x-icon" />
    <link rel="apple-touch-icon" href="http://www-static.ubuntu-fr.org/theme2010/images/commun/ubuntu/touch-ico.png" />

    <link rel="stylesheet" media="screen" type="text/css" title="Design Ubuntu-fr" href="http://www-static.ubuntu-fr.org/theme2010/css/doc.css" />
    <link rel="stylesheet" media="screen" type="text/css" title="Design Ubuntu-fr" href="http://www-static.ubuntu-fr.org/theme2010/css/doc-ubuntu.css" />
    <link rel="stylesheet" media="print" type="text/css" title="Design Ubuntu-fr" href="http://www-static.ubuntu-fr.org/theme2010/css/doc-print.css" />

    <script type="text/javascript">
      var menu_hidden;
      var static_url = "UFR_STATIC";
    </script>
    <script src="http://www-static.ubuntu-fr.org/theme2010/js/menu.js" type="text/javascript"></script>
    <script src="http://www-static.ubuntu-fr.org/theme2010/js/common.js" type="text/javascript"></script>
  </head>
  <body>

    <div id="accessibar">
      <a href="rubyonrails#main" tabindex="1">Contenu</a> | <a href="rubyonrails#qsearch__in" tabindex="2">Rechercher</a> | <a href="rubyonrails#navigation" tabindex="3">Menus</a>
    </div>

    <div id="page">

      <div id="header">

        <div id="logo">
          <h1>Ubuntu-fr</h1>
          <a href="index.html" title="Accueil de la documentation">Communauté francophone d'utilisateurs d'Ubuntu</a>
        </div>

        <form action="http://ubuntu-fr.org/recherche" accept-charset="utf-8" id="search" onsubmit="if (document.getElementById('qsearch__in').value == 'Recherche rapide....') {document.getElementById('qsearch__in').value = '';}">
          <fieldset>
            <label for="qsearch__in">Recherche : </label><input type="text" value="Recherche rapide...." id="qsearch__in" accesskey="f" name="sk_q" alt="[F]" size="34" tabindex="4" />
            <label for="tsearch_field">Chercher dans : </label><select name="sk_engine" tabindex="5" id="tsearch_field" title="Chercher dans">
              <option value="all">Site</option>
              <option selected="selected" value="doc">Documentation</option>
              <option value="forum">Forum</option>
              <option value="planet">Planet</option>
            </select>
            <input type="submit" value="ok" class="button" alt="Lancer la recherche" tabindex="5" />
          </fieldset>
        </form>
        <!--[if lte IE 7]><div class="clear"></div><![endif]-->

        <form action="rubyonrails" accept-charset="utf-8" id="login_top" method="post">
          <fieldset>
            <label for="u_field">Identifiant : </label><input type="text" value="Identifiant" name="u" id="u_field" size="9" /><label for="p_field">Mot de passe : </label><input type="password" value="Mot de passe" name="p" id="p_field" size="9" alt="Mot de passe" /><input type="submit" value="connexion" id="connect" /> / <a href="http://forum.ubuntu-fr.org/register.php">inscription</a>
          </fieldset>
        </form>
 

      </div>

      <div id="navbar">
          <h2 id="pagetitle"><a href="rubyonrails" >rubyonrails</a></h2>
      </div>

      
      <div id="main" class="dokuwiki">

        <div id="hidemenu" title="Masquer le menu"></div>

        <div id="pagerror"></div>
                <div class="notetag">Selon les <a href="tags">tags</a> présents sur cette page, celle-ci est ancienne et ne contient plus d'informations sur une des  <a href="versions">versions supportées d'Ubuntu</a>.<br />
Cette page est en cours de rédaction.<br />
<a href="wiki/participer_wiki">Apportez votre aide…</a>
</div>
<!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table des matières</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="rubyonrails#installation_complete_de_ruby_193_et_rails_30_via_rvm_maverick_meerkat">Installation complète de Ruby 1.9.3 et Rails 3.0 via RVM (Maverick Meerkat)</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="rubyonrails#ruby_environment_version_manager_rvm">Ruby enVironment (Version) Manager (RVM)</a></div></li>
<li class="level2"><div class="li"><a href="rubyonrails#installation_de_ruby_192">Installation de Ruby 1.9.2</a></div></li>
<li class="level2"><div class="li"><a href="rubyonrails#installation_de_rails_30">Installation de Rails 3.0</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="rubyonrails#installation_complete_karmic_koala">Installation complète (Karmic Koala)</a></div></li>
<li class="level1"><div class="li"><a href="rubyonrails#installation_standard">Installation standard</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="rubyonrails#installation_de_ruby">Installation de Ruby</a></div></li>
<li class="level2"><div class="li"><a href="rubyonrails#mise_a_jour_de_rubygems">Mise à jour de RubyGems</a></div></li>
<li class="level2"><div class="li"><a href="rubyonrails#installation_de_rails_et_ses_dependances_avec_rubygems">Installation de Rails et ses dépendances (avec RubyGems)</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="rubyonrails#creez_votre_premiere_application_rails">Créez votre première application Rails</a></div></li>
<li class="level1"><div class="li"><a href="rubyonrails#installations_supplementaires">Installations supplémentaires</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="rubyonrails#mongrel">Mongrel</a></div></li>
<li class="level2"><div class="li"><a href="rubyonrails#mongrel_cluster_et_apache_22">Mongrel_cluster et apache 2.2</a></div></li>
<li class="level2"><div class="li"><a href="rubyonrails#mysql">MySQL</a></div></li>
<li class="level2"><div class="li"><a href="rubyonrails#postgres">Postgres</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="rubyonrails#configuration_avancee_de_apache_fcgi">Configuration avancée de Apache + FCGI</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="rubyonrails#pre-requis1">Pré-requis</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="rubyonrails#choix_du_mode_de_fonctionnement_de_l_application">Choix du mode de fonctionnement de l&#039;application</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="rubyonrails#serveur_virtuel">Serveur virtuel</a></div></li>
<li class="level2"><div class="li"><a href="rubyonrails#repertoire_en_alias_sous_la_racine_du_serveur">Répertoire en Alias sous la racine du serveur</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="rubyonrails#problemes_rencontres">Problèmes rencontrés</a></div></li>
<li class="level1"><div class="li"><a href="rubyonrails#liens">Liens</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->
<div class="tags"><span>
	<a href="hardy" class="wikilink1" title="hardy" rel="tag">Hardy</a>,
	<a href="maverick" class="wikilink1" title="maverick" rel="tag">Maverick</a>,
	<a href="programmation" class="wikilink1" title="programmation" rel="tag">programmation</a>,
	<a href="brouillon" class="wikilink1" title="brouillon" rel="tag">BROUILLON</a>
</span></div>
<hr />

<p>
<p><div class="noteclassic">Attention <strong>BROUILLON</strong> ! Certaines parties de cette page sont obsolètes, pour une installation sur Karmic, voir directement la section <em>Installation complète (Karmic Koala)</em>.
</p>

<p>
Pour l&#039;installation de Ruby 1.9.2 et de Ruby On Rails 3.0, voir directement la section <em>Installation complète (Maverick Meerkat)</em>
</div></p>
</p>

<p>
<p><div class="notewarning">L&#039;installation de RVM devrait se faire pour un utilisateur uniquement et donc sans sudo devant, <a href="https://rvm.beginrescueend.com/rvm/install/" class="urlextern" title="https://rvm.beginrescueend.com/rvm/install/"  rel="nofollow">comme expliqué dans la doc officielle</a>. Il est déjà dangereux de télécharger et installer un bash en une seule commande, le faire avec un sudo devant est juste une pratique à bannir. Merci de compléter et de mettre les avertissements nécessaires. — YoBoY - Administrateur de la Documentation Francophone
</div></p>
</p>

<h1 class="sectionedit1" id="ruby_on_rails">Ruby On Rails</h1>
<div class="level1">

<p>
Rails est un framework de développement d&#039;applications web basé sur le concept <a href="http://fr.wikipedia.org/wiki/Mod%C3%A8le-Vue-Contr%C3%B4leur" class="urlextern" title="http://fr.wikipedia.org/wiki/Mod%C3%A8le-Vue-Contr%C3%B4leur"  rel="nofollow">Modèle-Vue-Controleur</a> (MVC).
</p>
<ul>
<li class="level1"><div class="li"> <strong>Ruby</strong> - Ruby 1.9.3 est la version recommandée pour l&#039;utilisation de Rails. Ruby 1.9.1, 1.8.7, 1.8.4 et 1.8.2 conviennent aussi, mais pas la version 1.8.3.</div>
</li>
<li class="level1"><div class="li"> <strong>RubyGems</strong> - RubyGems est le gestionnaire standard de paquets Ruby.  Similaire à apt-get, mais est utilisé pour installer les librairies et applications en Ruby. Les Gems sont en quelque sorte comme les paquets .deb (les gems sont la meilleure façon d&#039;installer Rails et ses dépendances)</div>
</li>
<li class="level1"><div class="li"> <strong>Rails</strong> - Avec <strong>RubyGems</strong> installé, vous pouvez installer Rails et ses dépendances.</div>
</li>
<li class="level1"><div class="li"> <strong>Rails 3.0</strong> - La dernière version de Rails n&#039;est pas disponible dans les dépôts. Vous pouvez cependant l&#039;installer via RVM.</div>
</li>
</ul>

</div>
<div class='secedit editbutton_section editbutton_1'><form class="button btn_secedit" method="post" action="rubyonrails"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1390233786" /><input type="hidden" name="summary" value="[Ruby On Rails] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="862-1758" /><input type="submit" value="Modifier" class="button" title="Ruby On Rails" /></div></form></div>
<h2 class="sectionedit2" id="installation_complete_de_ruby_193_et_rails_30_via_rvm_maverick_meerkat">Installation complète de Ruby 1.9.3 et Rails 3.0 via RVM (Maverick Meerkat)</h2>
<div class="level2">

<p>
<p><div class="noteclassic">Ruby On Rails 3.0 ne supporte pas Ruby 1.9.1
</div></p>
</p>

<p>
Si vous souhaitez installer Ruby 1.9.3 et Rails 3.0, vous ne pouvez pas le faire via les dépôts officiels. Il va donc vous falloir les installer à la main.
</p>

</div>
<div class='secedit editbutton_section editbutton_2'><form class="button btn_secedit" method="post" action="rubyonrails"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1390233786" /><input type="hidden" name="summary" value="[Installation complète de Ruby 1.9.3 et Rails 3.0 via RVM (Maverick Meerkat)] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="1759-2065" /><input type="submit" value="Modifier" class="button" title="Installation complète de Ruby 1.9.3 et Rails 3.0 via RVM (Maverick Meerkat)" /></div></form></div>
<h3 class="sectionedit3" id="ruby_environment_version_manager_rvm">Ruby enVironment (Version) Manager (RVM)</h3>
<div class="level3">

<p>
RVM vous permet de gérer manuellement les versions de Ruby. 
</p>

</div>

<h4 id="pre-requis">Pré-requis</h4>
<div class="level4">

<p>
Installer les dépendances :
</p>
<pre class="code">sudo apt-get install curl git-core build-essential zlib1g-dev libssl-dev libreadline6-dev gem libyaml-dev</pre>

</div>

<h4 id="installation">Installation</h4>
<div class="level4">

<p>
La commande suivante récupère et installe RVM :
</p>
<pre class="code">bash &lt; &lt;(curl -s https://raw.github.com/wayneeseguin/rvm/master/binscripts/rvm-installer)</pre>

<p>
Ou celle ci qui suis un redirecteur
</p>
<pre class="code">curl -L get.rvm.io | bash -s stable</pre>

<p>
<p><div class="noteclassic">Le « sudo » est à proscrire en dehors d&#039;une <a href="http://rvm.beginrescueend.com/deployment/system-wide/" class="urlextern" title="http://rvm.beginrescueend.com/deployment/system-wide/"  rel="nofollow">installation multi-utilisateurs (serveur)</a>. Pour plus d&#039;informations sur cette commande, rendez-vous sur la <a href="http://rvm.beginrescueend.com/rvm/install/" class="urlextern" title="http://rvm.beginrescueend.com/rvm/install/"  rel="nofollow">page officielle de RVM (en anglais)</a>. Il existe d&#039;autres méthodes pour installer RVM, mais que celles-ci nécessitent des modifications plus complexes de votre système.
</div></p>
</p>

<p>
Les binaires sont installés dans $HOME/.rvm, la fonction suivante permet de les rendre accessibles via le terminal :
</p>
<pre class="code">echo &#039;[[ -s &quot;$HOME/.rvm/scripts/rvm&quot; ]] &amp;&amp; . &quot;$HOME/.rvm/scripts/rvm&quot; # Load RVM function&#039; &gt;&gt; ~/.bashrc</pre>

<p>
Pour actualiser la configuration, fermer et rouvrir le terminal ou exécuter :
</p>
<pre class="code">source ~/.bashrc</pre>

<p>
En single-user (sans sudo), <strong>l&#039;installation de RVM est terminée : passez directement à Installation de Ruby</strong>.
</p>

</div>

<h4 id="finalisation_multi-utilisateur_avec_sudo">Finalisation multi-utilisateur (avec sudo)</h4>
<div class="level4">

<p>
<p><div class="noteclassic">Inutile si l&#039;on s&#039;est contenté d&#039;une installation <em>single-user</em> (sans sudo).
</div></p>
Une fois l&#039;installation terminée, il faut ajouter votre compte dans le groupe <em>rvm</em> :
</p>
<pre class="code">sudo adduser &lt;utilisateur&gt; rvm</pre>

</div>

<h4 id="test">Test</h4>
<div class="level4">

<p>
Pour vérifier l&#039;installation, exécutez :
</p>
<pre class="code">rvm info</pre>

<p>
<p><div class="noteclassic">
Si vous obtenez :
</p>
<pre class="code">Commande &#039;rvm&#039; non trouvée</pre>

<p>
Vérifiez s&#039;il n&#039;est pas écrit :
</p>
<pre class="code">Installation of RVM to /usr/local/rvm/ is complete.</pre>

<p>
Si c&#039;est le cas, vous pouvez corriger comme cela :
</p>
<pre class="code">ln -s /usr/local/rvm/bin/rvm /usr/bin/</pre>

<p>

</div></p>
</p>

</div>
<div class='secedit editbutton_section editbutton_3'><form class="button btn_secedit" method="post" action="rubyonrails"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1390233786" /><input type="hidden" name="summary" value="[Ruby enVironment (Version) Manager (RVM)] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="2066-4152" /><input type="submit" value="Modifier" class="button" title="Ruby enVironment (Version) Manager (RVM)" /></div></form></div>
<h3 class="sectionedit4" id="installation_de_ruby_192">Installation de Ruby 1.9.2</h3>
<div class="level3">

</div>

<h4 id="installation1">Installation</h4>
<div class="level4">

<p>
Tapez la commande suivante :
</p>
<pre class="code">sudo rvm install 1.9.2</pre>

<p>
Une fois le téléchargement fini, l&#039;installation débute toute seule et peut durer un certain temps, soyez donc patient !
</p>

<p>
Avec la commande ci-dessus, si vous obtenez cette erreur : 
</p>
<pre class="code">sudo: rvm: command not found</pre>

<p>
Il faut executer la commande : 
</p>
<pre class="code">rvm list known</pre>

<p>
Et choisir la version de ruby que vous souhaitez installer, en l&#039;occurence ici :
</p>
<pre class="code">rvm  install ruby-1.9.2-p180</pre>

<p>
Pour plus d&#039;informations pour l&#039;installation de Ruby avec RVM, vous pouvez vous rendre ici : <a href="https://rvm.beginrescueend.com/rubies/installing/" class="urlextern" title="https://rvm.beginrescueend.com/rubies/installing/"  rel="nofollow">https://rvm.beginrescueend.com/rubies/installing/</a>
</p>

<p>
<p><div class="notewarning">Sous <strong>Ubuntu 11.10</strong> et <strong>RVM 1.10.0</strong> (installation <em>single-user</em>)
</p>

<p>
Une erreur survient pendant la compilation de Ruby :
</p>
<pre class="code">gcc -I. -I../../.ext/include/x86_64-linux -I../.././include -I../.././ext/openssl -DRUBY_EXTCONF_H=\&quot;extconf.h\&quot;    -fPIC -O3 -ggdb -Wextra -Wno-unused-parameter -Wno-parentheses -Wpointer-arith -Wwrite-strings -Wno-missing-field-initializers -Wno-long-long  -fPIC  -o ossl_ssl.o -c ossl_ssl.c
ossl_ssl.c:110:1: erreur: ‘SSLv2_method’ undeclared here (not in a function)
ossl_ssl.c:111:1: erreur: ‘SSLv2_server_method’ undeclared here (not in a function)
ossl_ssl.c:112:1: erreur: ‘SSLv2_client_method’ undeclared here (not in a function)
make[1]: *** [ossl_ssl.o] Erreur 1
make[1]: quittant le répertoire « /home/&lt;user&gt;/.rvm/src/ruby-1.9.2-p180/ext/openssl »
make: *** [mkmain.sh] Erreur 1</pre>

<p>
<strong>La solution</strong>
</p>

<p>
<em>inspirée de cette page <a href="http://29a.ch/2011/10/28/rvm-on-ubuntu-11-10" class="urlextern" title="http://29a.ch/2011/10/28/rvm-on-ubuntu-11-10"  rel="nofollow">http://29a.ch/2011/10/28/rvm-on-ubuntu-11-10</a> (en anglais)</em>
</p>

<p>
Faire le ménage :
</p>
<pre class="code">rvm remove 1.9.2</pre>

<p>
Installer le paquet openssl de RVM :
</p>
<pre class="code">rvm pkg install openssl</pre>

<p>
Forcer l&#039;installation de Ruby avec le paquet openssl précédemment installé :
</p>
<pre class="code">rvm install 1.9.2 --with-openssl-dir=$rvm_path/usr</pre>

<p>

</div></p>
</p>

</div>

<h4 id="version_par_defaut">Version par défaut</h4>
<div class="level4">

<p>
Il vous faut indiquer la version de Ruby utilisée par défaut :
</p>
<pre class="code">sudo rvm --default ruby-1.9.2</pre>

</div>

<h4 id="rendre_ruby_accessible_dans_le_shell">Rendre Ruby accessible dans le shell</h4>
<div class="level4">

<p>
<p><div class="noteimportant">La partie qui suit est très importante (uniquement dans le cas d&#039;une installation <em>multi-utilisateur</em>) !
</div></p>
</p>

<p>
Avec votre éditeur de texte préféré, éditez le fichier situé <em>/home/&lt;user&gt;/.bashrc</em> puis faites les actions suivantes :
</p>
<ol>
<li class="level1"><div class="li"> Commentez la ligne : <pre class="code">[ -z &quot;$PS1&quot; ] &amp;&amp; return</pre>

<p>
 en mettant un # devant
</p>
</div>
</li>
<li class="level1"><div class="li"> Ajoutez à la place : <pre class="code">if [[ -n &quot;$PS1&quot; ]]; then</pre>
</div>
</li>
<li class="level1"><div class="li"> Ajoutez une nouvelle ligne, indentez d&#039;un &quot;cran&quot; de plus et mettez <pre class="code">[[ -s &quot;$HOME/.rvm/src/rvm/scripts/rvm&quot; ]] &amp;&amp; . &quot;$HOME/.rvm/src/rvm/scripts/rvm&quot;  # This loads RVM into a shell session.</pre>
</div>
</li>
<li class="level1"><div class="li"> Ajoutez une nouvelle ligne et mettez <pre class="code">fi</pre>
</div>
</li>
</ol>

<p>
Enregistrez le fichier, fermez les éventuels terminaux ouverts et ouvrez-en un nouveau. Pour tester si la modification a fonctionné, tapez :
</p>
<pre class="code">ruby -v</pre>

<p>
Il doit vous afficher quelque chose de semblable à :
</p>
<pre class="code">ruby 1.9.2p180 (2011-02-18 revision 30909) [x86_64-linux]</pre>

<p>
<p><div class="noteclassic">Vous devrez effectuer la manipulation d&#039;ajout dans le groupe <em>rvm</em> ainsi que de modification du fichier <em>.bashrc</em> pour chaque utilisateur devant avoir accès à rvm et ruby
</div></p>
</p>

<p>
<p><div class="noteclassic">
Comme pour rvm, si vous obtenez le message suivant :
</p>
<pre class="code">Le programme « ruby » n&#039;est pas installé.  Vous pouvez l&#039;installer en saisissant :
apt-get install ruby</pre>

<p>
Exécutez la commande suivante :
</p>
<pre class="code">sudo ln -s /usr/local/rvm/bin/ruby /usr/bin</pre>

<p>

</div></p>
</p>

</div>
<div class='secedit editbutton_section editbutton_4'><form class="button btn_secedit" method="post" action="rubyonrails"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1390233786" /><input type="hidden" name="summary" value="[Installation de Ruby 1.9.2] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="4153-7703" /><input type="submit" value="Modifier" class="button" title="Installation de Ruby 1.9.2" /></div></form></div>
<h3 class="sectionedit5" id="installation_de_rails_30">Installation de Rails 3.0</h3>
<div class="level3">

</div>

<h4 id="installation2">Installation</h4>
<div class="level4">

<p>
Installez Rails 3.0 :
</p>
<pre class="code">sudo gem install rails</pre>

<p>
Le système va se charger d&#039;installer Rails ainsi que ses dépendances. Votre terminal peut ne pas afficher d&#039;information durant un laps de temps, ne vous inquiétez pas et soyez une fois de plus patient.
</p>

<p>
<p><div class="noteclassic">(Optionnel) Vous pouvez en profiter pour installer le gem <em>mysql</em> (remplacez simplement &quot;rails&quot; par &quot;mysql&quot;)
</div></p>
</p>

</div>

<h4 id="test1">Test</h4>
<div class="level4">

<p>
Vous pouvez maintenant accéder à Rails.
Pour tester si tout s&#039;est bien passé, tapez la ligne suivante dans un terminal (il faut fermer le terminal en cours et en ouvrir un autre). Elle aura pour effet de créer un nouveau projet Rails au chemin indiqué.
</p>
<pre class="code">rails new /chemin/du/projet/nomDuProjet -d mysql</pre>

<p>
<p><div class="noteclassic"><em>-d mysql</em> signifie que je vais utiliser une connexion à MySQL. Cette option est totalement optionnelle.
</div></p>
</p>

<p>
Vous devez avoir une liste de fichiers créés qui doit s&#039;afficher, semblable à celle-ci : 
</p>
<pre class="code">create  
      create  README
      create  Rakefile
      create  config.ru
      create  .gitignore
      create  Gemfile
      create  app
      create  app/helpers/application_helper.rb
      create  app/controllers/application_controller.rb
      create  app/views/layouts/application.html.erb
...</pre>

<p>
Votre installation est terminée. Vous pouvez utiliser Ruby et Rails de façon classique.
</p>

</div>

<h4 id="integration_avec_apache_2">Intégration avec Apache 2</h4>
<div class="level4">

<p>
Rails 3.0 pose quelques soucis avec Mongrel. 
Par contre, l&#039;utilisation de passenger à la place se veut très simple et efficace :
<a href="http://www.nicosphere.net/configuration-dapache-avec-passenger-pour-rails-2215" class="urlextern" title="http://www.nicosphere.net/configuration-dapache-avec-passenger-pour-rails-2215"  rel="nofollow">http://www.nicosphere.net/configuration-dapache-avec-passenger-pour-rails-2215</a>
</p>

</div>
<div class='secedit editbutton_section editbutton_5'><form class="button btn_secedit" method="post" action="rubyonrails"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1390233786" /><input type="hidden" name="summary" value="[Installation de Rails 3.0] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="7704-9366" /><input type="submit" value="Modifier" class="button" title="Installation de Rails 3.0" /></div></form></div>
<h2 class="sectionedit6" id="installation_complete_karmic_koala">Installation complète (Karmic Koala)</h2>
<div class="level2">

<p>
<p><div class="noteclassic">Un gem c&#039;est un peu comme un paquet deb.<br/>

La version 1.9 de Ruby correspond à la version de test.
</div></p>
</p>

<p>
Pour installer Ruby et le framework Ruby on Rails, il faut installer les paquets <strong>ruby</strong>, <strong>ruby-dev</strong> et <strong>libopenssl-ruby</strong> :
</p>
<pre class="code">sudo apt-get install ruby ruby-dev libopenssl-ruby</pre>
<div class="table sectionedit7"><table class="inline">
	<tr class="row0">
		<th class="col0"> Ruby On Rails en un clic </th><th class="col1"><a href="apt://ruby,ruby-dev,libopenssl-ruby" class="media" title="apt://ruby,ruby-dev,libopenssl-ruby"  rel="nofollow"><img src="_media/apt.png" class="mediacenter" title="Installer en 1 clic." alt="Installer en 1 clic." /></a></th>
	</tr>
</table></div>

<p>
La version de RubyGems située dans les dépôts est trop ancienne pour installer le gem <strong>rails</strong>. Installons RubyGems manuellement :
</p>
<pre class="code">wget http://production.cf.rubygems.org/rubygems/rubygems-1.3.7.tgz
tar -xvf rubygems-1.3.7.tgz
sudo ruby rubygems-1.3.7/setup.rb
sudo ln -s /usr/bin/gem1.8 /usr/bin/gem</pre>

<p>
Mettez éventuellement RubyGems à jour :
</p>
<pre class="code">sudo gem update --system</pre>

<p>
Ensuite il faut mettre la ligne suivante dans <strong>~/.gemrc</strong> pour indiquer le chemin où installer les binaires et désactiver l&#039;installation des docs qui sont longues à installer :
</p>
<pre class="code">gem: --bindir /usr/local/bin --no-ri --no-rdoc</pre>

<p>
Puis installer la gem <strong>rails</strong> :
</p>
<pre class="code">sudo gem install rails</pre>

<p>
Pour pouvoir interfacer Ruby avec MySQL, il faut installer le paquet <strong>libmysqlclient-dev</strong>  :
</p>
<pre class="code">sudo apt-get install libmysqlclient-dev</pre>
<div class="table sectionedit8"><table class="inline">
	<tr class="row0">
		<th class="col0" colspan="2">Installation du gem mysql</th><td class="col2"><a href="apt://libmysqlclient-dev" class="media" title="apt://libmysqlclient-dev"  rel="nofollow"><img src="_media/apt.png" class="mediacenter" title="Installer le paquet." alt="Installer le paquet." /></a></td>
	</tr>
</table></div>

<p>
Ainsi que le gem <strong>mysql</strong> :
</p>
<pre class="code">sudo gem install mysql</pre>

</div>
<div class='secedit editbutton_section editbutton_6'><form class="button btn_secedit" method="post" action="rubyonrails"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1390233786" /><input type="hidden" name="summary" value="[Installation complète (Karmic Koala)] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="9367-10851" /><input type="submit" value="Modifier" class="button" title="Installation complète (Karmic Koala)" /></div></form></div>
<h2 class="sectionedit9" id="installation_standard">Installation standard</h2>
<div class="level2">

<p>
<p><div class="noteclassic">
Depuis Dapper, vous pouvez installer <strong>Rails</strong> depuis les dépôts, mais cette solution est connue pour causer des problèmes entre apt-get et le manager de paquets gem. Le mieux est d&#039;installer Rails par le biais des <strong>gems</strong>.

</div></p>
</p>

</div>
<div class='secedit editbutton_section editbutton_9'><form class="button btn_secedit" method="post" action="rubyonrails"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1390233786" /><input type="hidden" name="summary" value="[Installation standard] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="10852-11130" /><input type="submit" value="Modifier" class="button" title="Installation standard" /></div></form></div>
<h3 class="sectionedit10" id="installation_de_ruby">Installation de Ruby</h3>
<div class="level3">

<p>
<a href="tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">Installez les paquets</a> <strong>y rubygems</strong>
</p>

<p>
Sous <a href="hardy" class="wikilink1" title="hardy">hardy</a>, <a href="tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">installez les paquets</a> <strong>ruby-full libyaml-ruby libzlib-ruby rubygems</strong>
</p>

<p>
Sous <a href="intrepid" class="wikilink1" title="intrepid">intrepid</a>, il faut <a href="tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">installer les paquets</a> <strong>ruby-full libyaml-ruby libzlib-ruby rails</strong>, mais pas rubygem. Pour le récupérer, il faut télécharger l&#039;archive de la dernière version sur ce site : <a href="http://rubyforge.org/frs/?group_id=126" class="urlextern" title="http://rubyforge.org/frs/?group_id=126"  rel="nofollow">http://rubyforge.org/frs/?group_id=126</a>.
Après avoir extrait l&#039;archive, il faut rendre le fichier :  &quot;setup.rb&quot; exécutable et le lancer avec ruby ( la commande peut être &quot;ruby1.8&quot;, dans ce cas, vous pouvez faire un lien symbolique avec &quot;ruby&quot;. 
</p>
<pre class="code"> sudo ruby1.8 ./setup.rb</pre>

<p>
Fil de discussion à ce sujet : <a href="http://forum.ubuntu-fr.org/viewtopic.php?id=288407" class="urlextern" title="http://forum.ubuntu-fr.org/viewtopic.php?id=288407"  rel="nofollow">http://forum.ubuntu-fr.org/viewtopic.php?id=288407</a>
</p>

</div>
<div class='secedit editbutton_section editbutton_10'><form class="button btn_secedit" method="post" action="rubyonrails"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1390233786" /><input type="hidden" name="summary" value="[Installation de Ruby] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="11131-11981" /><input type="submit" value="Modifier" class="button" title="Installation de Ruby" /></div></form></div>
<h3 class="sectionedit11" id="mise_a_jour_de_rubygems">Mise à jour de RubyGems</h3>
<div class="level3">

<p>
<p><div class="notehelp">
Si vous êtes derrière un proxy, il faut d&#039;abord mettre la variable d&#039;environnement :
</p>
<pre class="code">export HTTP_PROXY=http://url_du_proxy:port_HTTP</pre>

<p>

</div></p>
</p>
<pre class="code">sudo gem update
sudo gem update --system</pre>

</div>
<div class='secedit editbutton_section editbutton_11'><form class="button btn_secedit" method="post" action="rubyonrails"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1390233786" /><input type="hidden" name="summary" value="[Mise à jour de RubyGems] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="11982-12245" /><input type="submit" value="Modifier" class="button" title="Mise à jour de RubyGems" /></div></form></div>
<h3 class="sectionedit12" id="installation_de_rails_et_ses_dependances_avec_rubygems">Installation de Rails et ses dépendances (avec RubyGems)</h3>
<div class="level3">
<pre class="code">sudo gem install rails --include-dependencies</pre>

<p>
ou pour la version courte :
</p>
<pre class="code">sudo gem install rails -y</pre>
<blockquote><div class="no">
Pas besoin d&#039;option (<em>–include-dependencies</em> ou <em>-y</em>) sous Hardy car elles sont mises par défaut.<br/>
<img src="lib/images/smileys/fixme.gif" class="icon" alt="FIXME" /> et pour Gutsy et précédentes ? toujours d&#039;actualité ?</div></blockquote>

<p>
<p><div class="notehelp">Si vous obtenez une erreur du type :
</p>
<pre class="file">uninitialized constant Gem::GemRunner</pre>

<p>
<a href="tutoriel/comment_editer_un_fichier" class="wikilink1" title="tutoriel:comment_editer_un_fichier">Éditer le fichier</a> <strong>/usr/bin/gem</strong> et ajoutez la ligne :
</p>
<pre class="file">require &#039;rubygems/gem_runner&#039;</pre>

<p>
 juste avant la ligne :
</p>
<pre class="file">require &#039;rubygems&#039;</pre>

<p>
puis relancez la commande voulue.

</div></p>
</p>

<p>
Vous pouvez dès lors installer les « gems » dont vous avez besoin.
</p>

<p>
<p><div class="noteclassic">
Suite à un gem update –system, vous pouvez rencontrer ce type d&#039;erreur, simplement parce que /usr/bin/gem est différent de /usr/bin/gem1.8.
J&#039;ai résolu le problème simplement en supprimant /usr/bin/gem et en faisant un lien symbolique vers /usr/bin/gem1.8 :
</p>
<pre class="file">sudo rm /usr/bin/gem
sudo ln -s /usr/bin/gem1.8 /usr/bin/gem</pre>

<p>

</div></p>
</p>

</div>
<div class='secedit editbutton_section editbutton_12'><form class="button btn_secedit" method="post" action="rubyonrails"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1390233786" /><input type="hidden" name="summary" value="[Installation de Rails et ses dépendances (avec RubyGems)] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="12246-13356" /><input type="submit" value="Modifier" class="button" title="Installation de Rails et ses dépendances (avec RubyGems)" /></div></form></div>
<h2 class="sectionedit13" id="creez_votre_premiere_application_rails">Créez votre première application Rails</h2>
<div class="level2">

<p>
Entrez la commande suivante :
</p>
<pre class="code">rails new /chemin/vers/la/nouvelle/application</pre>

<p>
Évidemment, remplacez <em>/chemin/vers/la/nouvelle/application</em> par le chemin vers lequel vous voulez stocker le code de votre application.<br/>

Par exemple ~/rails/maKillerApp
</p>

</div>
<div class='secedit editbutton_section editbutton_13'><form class="button btn_secedit" method="post" action="rubyonrails"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1390233786" /><input type="hidden" name="summary" value="[Créez votre première application Rails] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="13357-13664" /><input type="submit" value="Modifier" class="button" title="Créez votre première application Rails" /></div></form></div>
<h2 class="sectionedit14" id="installations_supplementaires">Installations supplémentaires</h2>
<div class="level2">

<p>
Rails est installé avec le serveur WebRick. Une fois votre application créée, vous pouvez la visualiser en vous plaçant dans le répertoire de l&#039;application et en tapant :
</p>
<pre class="code">rails server</pre>

<p>
Le serveur WebRick se lance alors et vous pouvez y accéder à l&#039;adresse <a href="http://localhost:3000" class="urlextern" title="http://localhost:3000"  rel="nofollow">http://localhost:3000</a>
</p>

<p>
Vous pouvez aussi installer et utiliser d&#039;autres serveurs…
</p>

</div>
<div class='secedit editbutton_section editbutton_14'><form class="button btn_secedit" method="post" action="rubyonrails"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1390233786" /><input type="hidden" name="summary" value="[Installations supplémentaires] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="13665-14057" /><input type="submit" value="Modifier" class="button" title="Installations supplémentaires" /></div></form></div>
<h3 class="sectionedit15" id="mongrel">Mongrel</h3>
<div class="level3">

<p>
Pour installer <a href="http://mongrel.rubyforge.org/" class="urlextern" title="http://mongrel.rubyforge.org/"  rel="nofollow">mongrel</a>, 
<a href="tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">installez les paquets</a> <strong>build-essential ruby1.8-dev</strong>, puis entrez la commande :
</p>
<pre class="code">sudo gem install mongrel</pre>

</div>
<div class='secedit editbutton_section editbutton_15'><form class="button btn_secedit" method="post" action="rubyonrails"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1390233786" /><input type="hidden" name="summary" value="[Mongrel] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="14058-14290" /><input type="submit" value="Modifier" class="button" title="Mongrel" /></div></form></div>
<h3 class="sectionedit16" id="mongrel_cluster_et_apache_22">Mongrel_cluster et apache 2.2</h3>
<div class="level3">

<p>
1 - installer mongrel :
</p>
<pre class="code">sudo gem install gem_plugin mongrel mongrel_cluster --include-dependencies</pre>

<p>
2 - créer le fichier de configuration de mongrel_cluster :
</p>
<pre class="code">sudo mongrel_rails cluster::configure -e production  -p 8000 -N 3 -c /var/www/monsite -C /var/www/monsite/config/mongrel_cluster.yml -a 127.0.0.1 --user www-data --group www-data</pre>

<p>
-e : indique le type d&#039;environnement du serveur, ici production<br/>

-p : indique le port de la première instance du serveur mongrel, ici 8000<br/>

-N : indique le nombre d&#039;instances à lancer, ici 3<br/>

-c : indique le chemin du site, ici /var/www/monsite<br/>

-C : indique où enregistrer le fichier de config que cette commande génère, ici /var/www/monsite/config<br/>

-a : indique à Rails découter l&#039;interface du réseau local 127.0.0.1<br/>

–user : indique l&#039;identité de l&#039;utilisateur avec lequel démarrer les processus mongrel, ici www-data<br/>

–group : indique l&#039;identité de le group avec lequel démarrer les processus mongrel, ici www-data<br/>

</p>

<p>
3 - créer un lien symbolique du fichier précédent vers /etc/mongrel_cluster :
</p>
<pre class="code">sudo ln -s /var/www/monsite/config/mongrel_cluster.yml  /etc/mongrel_cluster/monsite.yml</pre>

<p>
NOTE : au point 2 on aurait pu enregistrer directement le fichier de configuration du cluster dans /etc/mongrel_cluster, ce qui aurait évité d&#039;avoir à créer un lien symbolique, cela permet ici de garder la configuration du cluster dans le site lui-même (au choix)
</p>

<p>
4 - lancer le cluster mongrel :
</p>
<pre class="code">sudo mongrel_rails cluster::start -C /etc/mongrel_cluster/monsite.yml</pre>

<p>
5 - activer les modules apache correspondant :
</p>
<pre class="code">sudo a2enmod rewrite
sudo a2enmod proxy
sudo a2enmod proxy_balancer
sudo a2enmod proxy_http</pre>

<p>
6 - configurer apache :
</p>
<pre class="code">[[:tutoriel:comment_modifier_un_fichier|Éditez le fichier]] /etc/apache2/sites-available/default et modifiez la première ligne
NameVirtualHost *
&lt;VirtualHost *&gt;</pre>

<p>
puis
</p>
<pre class="code">[[:tutoriel:comment_modifier_un_fichier|Éditez le fichier]] /etc/apache2/sites-available/monsite et modifiez le fichier comme suit
&lt;VirtualHost *&gt;
	ServerName monsite
	ServerAdmin admin@monsite.fr
	
	DocumentRoot /var/www/public
	&lt;Directory /var/www/public/&gt;
		Options FollowSymLinks
    		AllowOverride none
		Order allow,deny
		allow from all
	&lt;/Directory&gt;

&lt;Proxy balancer://mongrel_cluster&gt;
	BalancerMember http://127.0.0.1:8000
	BalancerMember http://127.0.0.1:8001
	BalancerMember http://127.0.0.1:8002
&lt;/Proxy&gt;

RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} -f
RewriteRule (.*) $1 [L]

ProxyPass / Balancer://mongrel_cluster/
ProxyPassReverse / balancer://mongrel_cluster/

# Deflate
AddOutputFilterByType DEFLATE text/html text/plain text/xml application/xml application/xhtml+xml text/javascript text/css
BrowserMatch ^Mozilla/4 gzip-only-text/html
BrowserMatch ^Mozilla/4.0[678] no-gzip
BrowserMatch \bMSIE !no-gzip !gzip-only-text/html


# Possible values include: debug, info, notice, warn, error, crit,
# alert, emerg.
LogLevel warn

ErrorLog /var/log/apache2/monsite.log
CustomLog /var/log/apache2/access.log combined
ServerSignature Off

&lt;/VirtualHost&gt;</pre>

<p>
activer le serveur virtuel
</p>
<pre class="code">sudo a2ensite monsite</pre>

<p>
7 - modifier le mode proxy d&#039;apache par défaut :<br/>

par défaut le mode proxy est interdit à tout le monde, ce qui a pour effet que toute requête à Apache se solde par &quot;forbidden&quot;, il faut donner l&#039;autorisation de consulter les pages à tout le monde
</p>
<pre class="code">[[:tutoriel:comment_modifier_un_fichier|Éditez le fichier]] /etc/apache2/mods-available/proxy.conf</pre>

<p>
commenter les lignes qui interdisent la consultation et donner l&#039;autorisation à tout le monde
</p>
<pre class="code">              #Order deny,allow
              #Deny from all
              Order allow,deny
              Allow from all</pre>

<p>
8 - relancer apache
</p>
<pre class="code">sudo /etc/init.d/apache2 restart</pre>

<p>
<p><div class="noteimportant">En cas de &quot;mongrel_rails: command not found&quot; ⇒ créer un lien symbolique de /var/lib/gems/1.8/bin/mongrel_rails vers /usr/bin
</div></p>
</p>

</div>
<div class='secedit editbutton_section editbutton_16'><form class="button btn_secedit" method="post" action="rubyonrails"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1390233786" /><input type="hidden" name="summary" value="[Mongrel_cluster et apache 2.2] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="14291-18289" /><input type="submit" value="Modifier" class="button" title="Mongrel_cluster et apache 2.2" /></div></form></div>
<h3 class="sectionedit17" id="mysql">MySQL</h3>
<div class="level3">

<p>
Pour installer le gem mysql, 
<a href="tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">installez</a> le paquet <strong>libmysqlclient16-dev</strong> puis entrez la commande :
</p>
<pre class="code">sudo gem install mysql2 -v 0.2.7</pre>

</div>
<div class='secedit editbutton_section editbutton_17'><form class="button btn_secedit" method="post" action="rubyonrails"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1390233786" /><input type="hidden" name="summary" value="[MySQL] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="18290-18486" /><input type="submit" value="Modifier" class="button" title="MySQL" /></div></form></div>
<h3 class="sectionedit18" id="postgres">Postgres</h3>
<div class="level3">

<p>
Pour pouvoir utiliser postgres avec Rails, 
<a href="tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">installez</a> les paquets <strong>make</strong> (si cela n&#039;est pas déjà fait) et <strong>libpq-dev</strong> puis entrez la commande :
</p>
<pre class="code">sudo gem install postgres</pre>

</div>
<div class='secedit editbutton_section editbutton_18'><form class="button btn_secedit" method="post" action="rubyonrails"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1390233786" /><input type="hidden" name="summary" value="[Postgres] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="18487-18726" /><input type="submit" value="Modifier" class="button" title="Postgres" /></div></form></div>
<h2 class="sectionedit19" id="configuration_avancee_de_apache_fcgi">Configuration avancée de Apache + FCGI</h2>
<div class="level2">

<p>
Il est aisé de tester Ruby on Rails avec le serveur intégré WEBrick ou mongrel, mais pour ceux qui veulent intégrer Ruby on Rails dans un environnement Apache, voici les instructions.
</p>

<p>
<p><div class="noteimportant">L&#039;utilisation de fastcgi est fortement déconseillée et il convient maintenant d&#039;utiliser apache 2.2 et son mode proxy_balancer couplé à des serveurs mongrel en cluster (cf supra)
</div></p>
</p>

</div>
<div class='secedit editbutton_section editbutton_19'><form class="button btn_secedit" method="post" action="rubyonrails"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1390233786" /><input type="hidden" name="summary" value="[Configuration avancée de Apache + FCGI] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="18727-19174" /><input type="submit" value="Modifier" class="button" title="Configuration avancée de Apache + FCGI" /></div></form></div>
<h3 class="sectionedit20" id="pre-requis1">Pré-requis</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> Avoir Ruby on Rails installé et fonctionnel</div>
</li>
<li class="level1"><div class="li"> Votre application doit fonctionner en utilisant WEBrick ( <code>/chemin/vers/l/application/script/server</code> ).<br/>
Cela signifie que vous avez toutes les librairies et gems correctement installées.</div>
</li>
<li class="level1"><div class="li"> Avoir une installation d&#039;Apache fonctionnelle. (voir <a href="lamp" class="wikilink1" title="lamp">lamp</a> (Contentez vous d&#039;installer Apache et MySQL) si ce n&#039;est pas le cas).</div>
</li>
</ul>

<p>
Activez le mod_rewrite :
</p>
<pre class="code">sudo a2enmod rewrite</pre>

<p>
Installez le support de FCGI pour Apache et Ruby en <a href="tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">installant le paquet</a> <strong>libapache2-mod-fcgid</strong>.<br/>

Après l&#039;installation de mod_fcgid le module devrait être activé, sinon faites 
</p>
<pre class="code">sudo a2enmod fcgid</pre>

<p>
Vous pouvez <a href="tutoriel/comment_installer_un_paquet" class="wikilink1" title="tutoriel:comment_installer_un_paquet">installer</a> <strong>libfcgi-ruby1.8</strong> depuis les <a href="depots" class="wikilink1" title="depots">dépôts</a>, mais le meilleur moyen est de le faire en utilisant <strong>rubygems</strong> de cette façon :
</p>

<p>
Installez d&#039;abord les paquets <strong>build-essential ruby1.8-dev libfcgi-dev</strong> puis faites :
</p>
<pre class="code">sudo gem install fcgi</pre>

</div>
<div class='secedit editbutton_section editbutton_20'><form class="button btn_secedit" method="post" action="rubyonrails"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1390233786" /><input type="hidden" name="summary" value="[Pré-requis] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="19175-20191" /><input type="submit" value="Modifier" class="button" title="Pré-requis" /></div></form></div>
<h2 class="sectionedit21" id="choix_du_mode_de_fonctionnement_de_l_application">Choix du mode de fonctionnement de l&#039;application</h2>
<div class="level2">

<p>
Maintenant vous devez décider si votre application fonctionnera comme serveur virtuel de votre serveur web, ou si elle sera intégrée à la structure préexistante de votre serveur.
</p>

</div>
<div class='secedit editbutton_section editbutton_21'><form class="button btn_secedit" method="post" action="rubyonrails"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1390233786" /><input type="hidden" name="summary" value="[Choix du mode de fonctionnement de l'application] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="20192-20438" /><input type="submit" value="Modifier" class="button" title="Choix du mode de fonctionnement de l'application" /></div></form></div>
<h3 class="sectionedit22" id="serveur_virtuel">Serveur virtuel</h3>
<div class="level3">

<p>
Éditer un nouveau fichier <strong>/etc/apache2/sites-available/&lt;nom du serveur&gt;</strong> pour créer un hôte virtuel.
</p>

<p>
Le contenu du fichier devra être :
</p>
<pre class="file">&lt;VirtualHost *&gt;
        SetEnv RAILS_ENV development
        ServerName www.monsite.com
        DocumentRoot /chemin/vers/l/application/public
        &lt;Directory /chemin/vers/l/application/public/&gt;
                Options ExecCGI FollowSymLinks
                AddHandler fcgid-script .fcgi
                Order allow,deny
                Allow from all
                RewriteEngine On
                RewriteRule ^$ index.html [QSA]
                RewriteRule ^([^.]+)$ $1.html [QSA]
                RewriteCond %{REQUEST_FILENAME} !-f
                RewriteRule ^(.*)$ /dispatch.fcgi?$1 [QSA,L]
                AllowOverride None
        &lt;/Directory&gt;
        ServerSignature On
#       ErrorDocument 500 /500.html
        ErrorLog /var/log/apache2/www.monsite.com.error.log
        CustomLog /var/log/apache2/www.monsite.com.access.log combined
        LogLevel warn
&lt;/VirtualHost&gt;</pre>

<p>
Bien sûr, remplacez les valeurs par celles qui correspondent à votre installation. Soyez sûrs de bien mentionner le chemin vers le répertoire public de votre application Rails ( <code>/chemin/vers/l/application/public</code> ).
</p>

<p>
Pour les fichiers d&#039;accès et d&#039;erreurs, créez un répertoire ou mettez les où vous voulez.
</p>

<p>
Si tout est configuré de cette manière vous pouvez vous passez du fichier <code>.htaccess</code> dans le répertoire public de votre application. Mais il n&#039;est pas nécessaire d&#039;y toucher ou de le supprimer.
</p>

<p>
Si c&#039;est une installation locale et que vous ne prévoyez pas d&#039;avoir une entrée <abbr title="Domain Name System">DNS</abbr> pour votre serveur virtuel, vous pouvez ajouter &lt;nom du serveur&gt; dans votre fichier <strong>/etc/hosts</strong> à la ligne commençant par 127.0.0.1 (en séparant de ce qui est déjà écrit par un espace ou une tabulation).
</p>

<p>
Maintenant il faut activer le serveur virtuel :
</p>
<pre class="code">sudo a2ensite &lt;nom du serveur&gt;</pre>

<p>
Puis redémarrez le serveur Apache :
</p>
<pre class="code">sudo /etc/init.d/apache2 restart</pre>

<p>
Tout devrait fonctionner normalement.
</p>

<p>
Si vous avez ajouté <code>&lt;nom du serveur&gt;</code> à <strong>/etc/hosts</strong>, n&#039;oubliez pas que c&#039;est un changement local et que vous devrez faire la même chose sur chaque machine utilisant l&#039;application. Sur les autres machines le nom du serveur virtuel devra être précédé de l&#039;IP réelle du serveur et non de 127.0.0.1.
</p>

</div>

<h4 id="problemes">Problèmes</h4>
<div class="level4">

<p>
Cliquez sur le bouton « About your application&#039;s environment » de la page d&#039;accueil de votre application et consultez ce qui suit pour connaître la source du problème.
</p>

</div>

<h5 id="beaucoup_de_texte_commencant_parusrbinruby18">Beaucoup de texte, commençant par **#!/usr/bin/ruby1.8**...</h5>
<div class="level5">

<p>
Le handler CGI/FCGI n&#039;est pas configuré correctement.
</p>

<p>
Vérifiez que la configuration du serveur virtuel ne <strong>contient pas</strong> la directive <code>AllowOverride none</code>.
</p>

</div>

<h5 id="section404">404</h5>
<div class="level5">

<p>
Les règles de réécriture n&#039;ont pas d&#039;effet.
</p>

<p>
Vérifiez que la configuration du serveur virtuel ne <strong>contient pas</strong> la directive <code>AllowOverride none</code>.
</p>

</div>

<h5 id="application_error">Application Error</h5>
<div class="level5">

<p>
Apache n&#039;a pas les permissions correctes pour exécuter l&#039;application.
</p>

<p>
Les répertoires <strong>log</strong> et <strong>tmp</strong> de votre application doivent être  accessibles en écriture par le serveur Apache. Le meilleur moyen est de changer le propriétaire de ces répertoires en <strong>www-data</strong>. Les permissions devraient être lecture/écriture pour le propriétaire et lecture seule pour les autres (644) :
</p>
<pre class="code">chgrp www-data -R /chemin/vers/l/application/log
chgrp www-data -R /chemin/vers/l/application/tmp
chmod 644 -R /chemin/vers/l/application/tmp
chmod 644 -R /chemin/vers/l/application/log</pre>

</div>
<div class='secedit editbutton_section editbutton_22'><form class="button btn_secedit" method="post" action="rubyonrails"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1390233786" /><input type="hidden" name="summary" value="[Serveur virtuel] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="20439-24043" /><input type="submit" value="Modifier" class="button" title="Serveur virtuel" /></div></form></div>
<h3 class="sectionedit23" id="repertoire_en_alias_sous_la_racine_du_serveur">Répertoire en Alias sous la racine du serveur</h3>
<div class="level3">

<p>
<a href="tutoriel/comment_editer_un_fichier" class="wikilink1" title="tutoriel:comment_editer_un_fichier">Modifiez</a> le fichier existant sous <strong>/etc/apache2/sites-available/</strong>. Insérez ce qui suit juste avant la balise <code>&lt;/VirtualHost&gt;</code> dans le fichier :
</p>
<pre class="file">    Alias /&lt;alias&gt; &quot;&lt;chemin_vers_le_répertoire _public_de _l_application&gt;&quot;
    &lt;Directory &lt;chemin_vers_le_répertoire _public_de _l_application&gt;&gt;
        Options +FollowSymlinks +ExecCGI
        Order allow,deny
        Allow from all
        AddHandler fcgid-script .fcgi
        RewriteEngine On
        RewriteBase /&lt;alias&gt;
        RewriteRule ^$ index.html [QSA]
        RewriteRule ^([^.]+)$ $1.html [QSA]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteRule ^(.*)$ dispatch.fcgi [QSA,L]
        ErrorDocument 500 /500.html
    &lt;/Directory&gt;</pre>
<ul>
<li class="level1"><div class="li"> &lt;chemin_vers_le_répertoire _public_de_l_application&gt; est explicite (donc si votre application se situe dans `/var/www-rails/app`, ça devra être `/var/www-rails/app/public`).</div>
</li>
<li class="level1"><div class="li"> &lt;alias&gt; est le chemin relatif à la racine de votre serveur où vous vous &quot;situez&quot; votre application (ie. `Alias /xxx/yyy` signifie que votre application sera accessible par l&#039;url `<a href="http://votre_serveur_web/xxx/yyy" class="urlextern" title="http://votre_serveur_web/xxx/yyy"  rel="nofollow">http://votre_serveur_web/xxx/yyy</a>`).</div>
</li>
</ul>

<p>
Aucune modification du fichier <strong>/etc/hosts</strong> n&#039;est nécessaire.
</p>

<p>
Redémarrez votre serveur apache :
</p>
<pre class="code">sudo /etc/init.d/apache2 restart</pre>

<p>
et essayez votre application.
</p>

</div>
<div class='secedit editbutton_section editbutton_23'><form class="button btn_secedit" method="post" action="rubyonrails"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1390233786" /><input type="hidden" name="summary" value="[Répertoire en Alias sous la racine du serveur] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="24044-25435" /><input type="submit" value="Modifier" class="button" title="Répertoire en Alias sous la racine du serveur" /></div></form></div>
<h2 class="sectionedit24" id="problemes_rencontres">Problèmes rencontrés</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Après la commande :</div>
</li>
</ul>
<pre class="code">rake db:migrate</pre>

<p>
Si vous obtenez l&#039;erreur suivante :
</p>
<pre class="code">Please install the postgres adapter: `gem install activerecord-postgres-adapter` (no such file to load -- active_record/connection_adapters/postgres_adapter)</pre>

<p>
Il faut vérifier que vous avez bien <strong>postgresql</strong> dans votre fichier <strong>config/database.yml</strong> et non pas <strong>postgres</strong>. Pour pallier à ce problème, utilisez la commande suivante lors de la création de votre projet :
</p>
<pre class="code">rails mon_projet -d postgresql</pre>

<p>
Si vous obtenez l&#039;erreur suivante :
</p>
<pre class="code">Could not find gem &#039;sqlite3 (&gt;= 0)&#039; in any of the gem sources listed in your Gemfile.</pre>

<p>
Il faut saisir ça dans un terminal :
</p>
<pre class="code">  sudo apt-get install libsqlite3-dev
  bundle install</pre>

</div>
<div class='secedit editbutton_section editbutton_24'><form class="button btn_secedit" method="post" action="rubyonrails"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1390233786" /><input type="hidden" name="summary" value="[Problèmes rencontrés] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="25436-26252" /><input type="submit" value="Modifier" class="button" title="Problèmes rencontrés" /></div></form></div>
<h2 class="sectionedit25" id="liens">Liens</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="http://www.stoneageblog.com/articles/2006/11/20/ubuntu-edgy-eft-installer-rubyonrails-eclipse-radrails" class="urlextern" title="http://www.stoneageblog.com/articles/2006/11/20/ubuntu-edgy-eft-installer-rubyonrails-eclipse-radrails"  rel="nofollow">Installer Ruby On Rails et Radrails sous Ubuntu Edgy Eft</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://www.stoneageblog.com/articles/2007/01/11/debian-on-rails-apache-2-2-mysql-ruby-rails-php-mongrel-mongrel_cluster-subversion-trac-capistrano/" class="urlextern" title="http://www.stoneageblog.com/articles/2007/01/11/debian-on-rails-apache-2-2-mysql-ruby-rails-php-mongrel-mongrel_cluster-subversion-trac-capistrano/"  rel="nofollow">Serveur RubyOnRails avec Mongrel, Mongrel Cluster, Apache 2.2, Subversion, Trac et Capistrano</a> (Réalisé sous debian etch mais identique sous Ubuntu.</div>
</li>
<li class="level1"><div class="li"> <a href="http://www.stoneageblog.com/articles/2007/03/04/ma-premiere-application-ruby-on-rails/" class="urlextern" title="http://www.stoneageblog.com/articles/2007/03/04/ma-premiere-application-ruby-on-rails/"  rel="nofollow">Débuter avec Ruby On Rails : ma première application !</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://blog.escarworld.com/post/2010/10/12/Installation-Ruby-enterprise-edition-%28REE%29-Passenger-Nginx" class="urlextern" title="http://blog.escarworld.com/post/2010/10/12/Installation-Ruby-enterprise-edition-%28REE%29-Passenger-Nginx"  rel="nofollow">Installer ruby enterprise edition avec passenger et nginx.</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://guides.rubyonrails.org/getting_started.html" class="urlextern" title="http://guides.rubyonrails.org/getting_started.html"  rel="nofollow">Getting started pour ROR, à faire absolument</a></div>
</li>
</ul>
<hr />

<p>
tiré de <a href="https://help.ubuntu.com/community/RubyOnRails" class="urlextern" title="https://help.ubuntu.com/community/RubyOnRails"  rel="nofollow">https://help.ubuntu.com/community/RubyOnRails</a>
</p>

</div>
<div class='secedit editbutton_section editbutton_25'><form class="button btn_secedit" method="post" action="rubyonrails"><div class="no"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="1390233786" /><input type="hidden" name="summary" value="[Liens] " /><input type="hidden" name="target" value="section" /><input type="hidden" name="range" value="26253-" /><input type="submit" value="Modifier" class="button" title="Liens" /></div></form></div>
<!-- cachefile /srv/www/doc.ubuntu-fr.org/htdocs/data/cache/2/2c77418499eb8e43d01a35c6f16c96b9.xhtml used -->

        <br style="clear:both;" />
        <div id="pageinfo">
            <!--  |  | -->
            <!-- ?tpl_pageinfo()? -->
            <br />
            Le contenu de ce wiki est sous licence : <a href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr" rel="license" target="_blank">CC BY-SA v3.0</a>
        </div> 
      </div>

      
      <div id="navigation">

        <ul>
          <li class="menu"><a href="http://www.ubuntu-fr.org" class="title" id="menu-accueil"><span>Accueil</span></a></li>
          <li class="menu" id="active">
            <a href="index.html"  class="title" id="menu-doc"><span>Documentation</span></a>
            <ul>
              <li id="navWiki" class="cat">
                <h2>Actions</h2>
                <ul>
                  <li><a href="http://doc.ubuntu-fr.org/rubyonrails?do=index"  class="action index" accesskey="x" rel="nofollow" title="Plan du site [X]">Plan du site</a></li>
                  <li><a href="http://doc.ubuntu-fr.org/rubyonrails?do=edit&amp;rev=0"  class="action edit" accesskey="e" rel="nofollow" title="Modifier cette page [E]">Modifier cette page</a></li>
                  <li><a href="http://doc.ubuntu-fr.org/rubyonrails?do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Anciennes révisions [O]">Anciennes révisions</a></li>
                  <li></li>
                  <li><a href="http://doc.ubuntu-fr.org/rubyonrails?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Derniers changements [R]">Derniers changements</a></li>
                  <li><a href="http://doc.ubuntu-fr.org/rubyonrails?do=backlink"  class="action backlink" rel="nofollow" title="Liens vers cette page">Liens vers cette page</a></li>
                  <li></li>
                  <li></li>
                  <li></li>
                </ul>
              </li>
              <li id="navDivers" class="cat">
                <h2>Divers</h2>
                <ul>
                  <li><bdi><a href="wiki/participer_wiki" class="wikilink1" title="wiki:participer_wiki">Participer à la documentation</a></bdi></li>
                  <li><bdi><a href="documentation_hors_ligne" class="wikilink1" title="documentation_hors_ligne">Documentation hors ligne</a></bdi></li>
                  <li><a href="http://www.ubuntu-fr.org/telechargement" title="T&eacute;l&eacute;charger Ubuntu">T&eacute;l&eacute;charger Ubuntu</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li class="menu"><a href="http://forum.ubuntu-fr.org"  class="title" id="menu-forum"><span>Forum</span></a></li>
          <li class="menu"><a href="http://planet.ubuntu-fr.org"  class="title" id="menu-planet"><span>Planet</span></a></li>
        </ul>

      </div>
      <div id="references-ufr">
        <ul id="legal-ufr">
          <li><a href="http://www.ubuntu-fr.org/contacts">Contact</a></li>
        </ul>

        <ul id="sponsors-ufr">
          <li><a href="http://www.dokuwiki.org/dokuwiki" id="dokuwiki">Propulsé par Dokuwiki</a></li>
        </ul>
      </div>

    </div>
    <!-- $Id$ -->

    <!-- Piwik Image Tracker -->
    <!-- img src="http://piwik.infra.ubuntu-fr.org/piwik.php?idsite=2&amp;rec=1" style="border:0" alt="" /-->
    <!-- End Piwik -->

  </body>
</html>
